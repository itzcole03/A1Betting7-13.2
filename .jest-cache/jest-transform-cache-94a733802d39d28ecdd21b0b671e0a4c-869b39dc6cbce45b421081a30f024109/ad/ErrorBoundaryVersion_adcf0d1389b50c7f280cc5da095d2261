5d99be3021971197fa5900daa1ddfdae
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ErrorBoundaryVersion = void 0;
var _react = _interopRequireDefault(require("react"));
var _runtimeEventBuffer = require("../debug/runtimeEventBuffer");
var _jsxRuntime = require("react/jsx-runtime");
// Global correlation ID counter
let errorCorrelationCounter = 0;

/**
 * Enhanced Error boundary for API version-related failures and runtime errors.
 * Displays a user-friendly message and logs the error with correlation to diagnostic events.
 */
class ErrorBoundaryVersion extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false,
      error: null,
      correlationId: 0
    };
  }
  static getDerivedStateFromError(error) {
    errorCorrelationCounter++;
    return {
      hasError: true,
      error,
      correlationId: errorCorrelationCounter
    };
  }
  componentDidCatch(error, info) {
    const {
      correlationId
    } = this.state;
    const firstStackLine = error.stack?.split('\n')[1]?.trim() || 'No stack';
    const errorTrace = {
      id: correlationId,
      message: error.message,
      name: error.name,
      firstStackLine,
      componentStackPresent: !!info.componentStack,
      timeISO: new Date().toISOString()
    };

    // eslint-disable-next-line no-console
    console.error(`[RuntimeErrorTrace] ${JSON.stringify(errorTrace)}`);

    // Check for the specific "Cannot convert undefined or null to object" error
    if (error.message.includes('Cannot convert undefined or null to object')) {
      const nullAccessEvents = (0, _runtimeEventBuffer.getRecent)('NullObjectAccess', 5);
      if (nullAccessEvents.length > 0) {
        // eslint-disable-next-line no-console
        console.error('[NullObjectCorrelation] Recent null access events:', nullAccessEvents);
      }
    }

    // eslint-disable-next-line no-console
    console.error('[ErrorBoundaryVersion] Version-related error:', error, info);
  }
  render() {
    if (this.state.hasError) {
      return /*#__PURE__*/(0, _jsxRuntime.jsxs)("div", {
        style: {
          padding: 24,
          color: '#b91c1c',
          background: '#fef2f2',
          borderRadius: 8
        },
        children: [/*#__PURE__*/(0, _jsxRuntime.jsxs)("h2", {
          children: ["Runtime Error Detected (ID: ", this.state.correlationId, ")"]
        }), /*#__PURE__*/(0, _jsxRuntime.jsx)("p", {
          children: this.state.error?.message || 'A runtime error occurred. Please refresh or contact support.'
        }), /*#__PURE__*/(0, _jsxRuntime.jsxs)("details", {
          style: {
            marginTop: 16,
            fontSize: '0.9em',
            opacity: 0.8
          },
          children: [/*#__PURE__*/(0, _jsxRuntime.jsx)("summary", {
            children: "Technical Details"
          }), /*#__PURE__*/(0, _jsxRuntime.jsx)("pre", {
            style: {
              marginTop: 8,
              fontSize: '0.8em',
              overflow: 'auto'
            },
            children: this.state.error?.stack || 'No stack trace available'
          })]
        })]
      });
    }
    return this.props.children;
  }
}
exports.ErrorBoundaryVersion = ErrorBoundaryVersion;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9ydW50aW1lRXZlbnRCdWZmZXIiLCJfanN4UnVudGltZSIsImVycm9yQ29ycmVsYXRpb25Db3VudGVyIiwiRXJyb3JCb3VuZGFyeVZlcnNpb24iLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdGF0ZSIsImhhc0Vycm9yIiwiZXJyb3IiLCJjb3JyZWxhdGlvbklkIiwiZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yIiwiY29tcG9uZW50RGlkQ2F0Y2giLCJpbmZvIiwiZmlyc3RTdGFja0xpbmUiLCJzdGFjayIsInNwbGl0IiwidHJpbSIsImVycm9yVHJhY2UiLCJpZCIsIm1lc3NhZ2UiLCJuYW1lIiwiY29tcG9uZW50U3RhY2tQcmVzZW50IiwiY29tcG9uZW50U3RhY2siLCJ0aW1lSVNPIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiY29uc29sZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbmNsdWRlcyIsIm51bGxBY2Nlc3NFdmVudHMiLCJnZXRSZWNlbnQiLCJsZW5ndGgiLCJyZW5kZXIiLCJqc3hzIiwic3R5bGUiLCJwYWRkaW5nIiwiY29sb3IiLCJiYWNrZ3JvdW5kIiwiYm9yZGVyUmFkaXVzIiwiY2hpbGRyZW4iLCJqc3giLCJtYXJnaW5Ub3AiLCJmb250U2l6ZSIsIm9wYWNpdHkiLCJvdmVyZmxvdyIsImV4cG9ydHMiXSwic291cmNlcyI6WyJFcnJvckJvdW5kYXJ5VmVyc2lvbi50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgZ2V0UmVjZW50IH0gZnJvbSAnLi4vZGVidWcvcnVudGltZUV2ZW50QnVmZmVyJztcclxuXHJcbmludGVyZmFjZSBFcnJvckJvdW5kYXJ5VmVyc2lvblByb3BzIHtcclxuICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRXJyb3JCb3VuZGFyeVZlcnNpb25TdGF0ZSB7XHJcbiAgaGFzRXJyb3I6IGJvb2xlYW47XHJcbiAgZXJyb3I6IEVycm9yIHwgbnVsbDtcclxuICBjb3JyZWxhdGlvbklkOiBudW1iZXI7XHJcbn1cclxuXHJcbi8vIEdsb2JhbCBjb3JyZWxhdGlvbiBJRCBjb3VudGVyXHJcbmxldCBlcnJvckNvcnJlbGF0aW9uQ291bnRlciA9IDA7XHJcblxyXG4vKipcclxuICogRW5oYW5jZWQgRXJyb3IgYm91bmRhcnkgZm9yIEFQSSB2ZXJzaW9uLXJlbGF0ZWQgZmFpbHVyZXMgYW5kIHJ1bnRpbWUgZXJyb3JzLlxyXG4gKiBEaXNwbGF5cyBhIHVzZXItZnJpZW5kbHkgbWVzc2FnZSBhbmQgbG9ncyB0aGUgZXJyb3Igd2l0aCBjb3JyZWxhdGlvbiB0byBkaWFnbm9zdGljIGV2ZW50cy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBFcnJvckJvdW5kYXJ5VmVyc2lvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxcclxuICBFcnJvckJvdW5kYXJ5VmVyc2lvblByb3BzLFxyXG4gIEVycm9yQm91bmRhcnlWZXJzaW9uU3RhdGVcclxuPiB7XHJcbiAgY29uc3RydWN0b3IocHJvcHM6IEVycm9yQm91bmRhcnlWZXJzaW9uUHJvcHMpIHtcclxuICAgIHN1cGVyKHByb3BzKTtcclxuICAgIHRoaXMuc3RhdGUgPSB7IFxyXG4gICAgICBoYXNFcnJvcjogZmFsc2UsIFxyXG4gICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgY29ycmVsYXRpb25JZDogMCBcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yOiBFcnJvcikge1xyXG4gICAgZXJyb3JDb3JyZWxhdGlvbkNvdW50ZXIrKztcclxuICAgIHJldHVybiB7IFxyXG4gICAgICBoYXNFcnJvcjogdHJ1ZSwgXHJcbiAgICAgIGVycm9yLFxyXG4gICAgICBjb3JyZWxhdGlvbklkOiBlcnJvckNvcnJlbGF0aW9uQ291bnRlclxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZENhdGNoKGVycm9yOiBFcnJvciwgaW5mbzogUmVhY3QuRXJyb3JJbmZvKSB7XHJcbiAgICBjb25zdCB7IGNvcnJlbGF0aW9uSWQgfSA9IHRoaXMuc3RhdGU7XHJcbiAgICBjb25zdCBmaXJzdFN0YWNrTGluZSA9IGVycm9yLnN0YWNrPy5zcGxpdCgnXFxuJylbMV0/LnRyaW0oKSB8fCAnTm8gc3RhY2snO1xyXG4gICAgXHJcbiAgICBjb25zdCBlcnJvclRyYWNlID0ge1xyXG4gICAgICBpZDogY29ycmVsYXRpb25JZCxcclxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcclxuICAgICAgbmFtZTogZXJyb3IubmFtZSxcclxuICAgICAgZmlyc3RTdGFja0xpbmUsXHJcbiAgICAgIGNvbXBvbmVudFN0YWNrUHJlc2VudDogISFpbmZvLmNvbXBvbmVudFN0YWNrLFxyXG4gICAgICB0aW1lSVNPOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH07XHJcblxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcclxuICAgIGNvbnNvbGUuZXJyb3IoYFtSdW50aW1lRXJyb3JUcmFjZV0gJHtKU09OLnN0cmluZ2lmeShlcnJvclRyYWNlKX1gKTtcclxuXHJcbiAgICAvLyBDaGVjayBmb3IgdGhlIHNwZWNpZmljIFwiQ2Fubm90IGNvbnZlcnQgdW5kZWZpbmVkIG9yIG51bGwgdG8gb2JqZWN0XCIgZXJyb3JcclxuICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3QnKSkge1xyXG4gICAgICBjb25zdCBudWxsQWNjZXNzRXZlbnRzID0gZ2V0UmVjZW50KCdOdWxsT2JqZWN0QWNjZXNzJywgNSk7XHJcbiAgICAgIGlmIChudWxsQWNjZXNzRXZlbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tOdWxsT2JqZWN0Q29ycmVsYXRpb25dIFJlY2VudCBudWxsIGFjY2VzcyBldmVudHM6JywgbnVsbEFjY2Vzc0V2ZW50cyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxyXG4gICAgY29uc29sZS5lcnJvcignW0Vycm9yQm91bmRhcnlWZXJzaW9uXSBWZXJzaW9uLXJlbGF0ZWQgZXJyb3I6JywgZXJyb3IsIGluZm8pO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuaGFzRXJyb3IpIHtcclxuICAgICAgcmV0dXJuIChcclxuICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6IDI0LCBjb2xvcjogJyNiOTFjMWMnLCBiYWNrZ3JvdW5kOiAnI2ZlZjJmMicsIGJvcmRlclJhZGl1czogOCB9fT5cclxuICAgICAgICAgIDxoMj5SdW50aW1lIEVycm9yIERldGVjdGVkIChJRDoge3RoaXMuc3RhdGUuY29ycmVsYXRpb25JZH0pPC9oMj5cclxuICAgICAgICAgIDxwPlxyXG4gICAgICAgICAgICB7dGhpcy5zdGF0ZS5lcnJvcj8ubWVzc2FnZSB8fFxyXG4gICAgICAgICAgICAgICdBIHJ1bnRpbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSByZWZyZXNoIG9yIGNvbnRhY3Qgc3VwcG9ydC4nfVxyXG4gICAgICAgICAgPC9wPlxyXG4gICAgICAgICAgPGRldGFpbHMgc3R5bGU9e3sgbWFyZ2luVG9wOiAxNiwgZm9udFNpemU6ICcwLjllbScsIG9wYWNpdHk6IDAuOCB9fT5cclxuICAgICAgICAgICAgPHN1bW1hcnk+VGVjaG5pY2FsIERldGFpbHM8L3N1bW1hcnk+XHJcbiAgICAgICAgICAgIDxwcmUgc3R5bGU9e3sgbWFyZ2luVG9wOiA4LCBmb250U2l6ZTogJzAuOGVtJywgb3ZlcmZsb3c6ICdhdXRvJyB9fT5cclxuICAgICAgICAgICAgICB7dGhpcy5zdGF0ZS5lcnJvcj8uc3RhY2sgfHwgJ05vIHN0YWNrIHRyYWNlIGF2YWlsYWJsZSd9XHJcbiAgICAgICAgICAgIDwvcHJlPlxyXG4gICAgICAgICAgPC9kZXRhaWxzPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucHJvcHMuY2hpbGRyZW47XHJcbiAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLG1CQUFBLEdBQUFELE9BQUE7QUFBd0QsSUFBQUUsV0FBQSxHQUFBRixPQUFBO0FBWXhEO0FBQ0EsSUFBSUcsdUJBQXVCLEdBQUcsQ0FBQzs7QUFFL0I7QUFDQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQyxvQkFBb0IsU0FBU0MsY0FBSyxDQUFDQyxTQUFTLENBR3ZEO0VBQ0FDLFdBQVdBLENBQUNDLEtBQWdDLEVBQUU7SUFDNUMsS0FBSyxDQUFDQSxLQUFLLENBQUM7SUFDWixJQUFJLENBQUNDLEtBQUssR0FBRztNQUNYQyxRQUFRLEVBQUUsS0FBSztNQUNmQyxLQUFLLEVBQUUsSUFBSTtNQUNYQyxhQUFhLEVBQUU7SUFDakIsQ0FBQztFQUNIO0VBRUEsT0FBT0Msd0JBQXdCQSxDQUFDRixLQUFZLEVBQUU7SUFDNUNSLHVCQUF1QixFQUFFO0lBQ3pCLE9BQU87TUFDTE8sUUFBUSxFQUFFLElBQUk7TUFDZEMsS0FBSztNQUNMQyxhQUFhLEVBQUVUO0lBQ2pCLENBQUM7RUFDSDtFQUVBVyxpQkFBaUJBLENBQUNILEtBQVksRUFBRUksSUFBcUIsRUFBRTtJQUNyRCxNQUFNO01BQUVIO0lBQWMsQ0FBQyxHQUFHLElBQUksQ0FBQ0gsS0FBSztJQUNwQyxNQUFNTyxjQUFjLEdBQUdMLEtBQUssQ0FBQ00sS0FBSyxFQUFFQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxD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