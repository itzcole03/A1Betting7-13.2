7a7a31a8a7e013a5b9f08a47b6334322
"use strict";

_getJestObj().mock('axios');
_getJestObj().mock('../../../services/propOllamaService');
_getJestObj().mock('../../../services/backendDiscovery');

// Mock the exact path used by the component for propOllamaService

// [DEBUG] Top of test file
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _propOllamaService = require("../../../services/propOllamaService");
var _reactQuery = require("@tanstack/react-query");
var _react = require("@testing-library/react");
var _react2 = _interopRequireDefault(require("react"));
var _reactRouterDom = require("react-router-dom");
var _AppContext = require("../../../contexts/AppContext");
var _AuthContext = require("../../../contexts/AuthContext");
var _ThemeContext = require("../../../contexts/ThemeContext");
var _PropOllama = _interopRequireDefault(require("../PropOllama"));
var _jsxRuntime = require("react/jsx-runtime");
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
console.log('[DEBUG] Top of PropOllama.test.tsx');
console.log('[DEBUG] Imported propOllamaService in test:', _propOllamaService.propOllamaService);

// Mock matchMedia and scrollIntoView for jsdom and framer-motion requirements
const matchMediaMock = query => ({
  matches: false,
  media: query,
  onchange: null,
  addListener: jest.fn(),
  // deprecated
  removeListener: jest.fn(),
  // deprecated
  addEventListener: jest.fn(),
  removeEventListener: jest.fn(),
  dispatchEvent: jest.fn()
});
Object.defineProperty(HTMLDivElement.prototype, 'scrollIntoView', {
  value: jest.fn(),
  writable: true
});

// Assign matchMedia after function definition
window.matchMedia = matchMediaMock;
global.matchMedia = matchMediaMock;
if (!window.addEventListener) {
  window.addEventListener = jest.fn();
}
if (!document.addEventListener) {
  document.addEventListener = jest.fn();
}
if (!Element.prototype.addEventListener) {
  Element.prototype.addEventListener = jest.fn();
}
if (!Element.prototype.removeEventListener) {
  Element.prototype.removeEventListener = jest.fn();
}
window.alert = jest.fn();
if (!window.addEventListener) {
  window.addEventListener = jest.fn();
}
if (!document.addEventListener) {
  document.addEventListener = jest.fn();
}
if (!Element.prototype.addEventListener) {
  Element.prototype.addEventListener = jest.fn();
}
if (!Element.prototype.removeEventListener) {
  Element.prototype.removeEventListener = jest.fn();
}
window.alert = jest.fn();
const CompositeProvider = ({
  children
}) => /*#__PURE__*/(0, _jsxRuntime.jsx)(_reactQuery.QueryClientProvider, {
  client: new _reactQuery.QueryClient(),
  children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_AuthContext._AuthProvider, {
    children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_reactRouterDom.MemoryRouter, {
      children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_ThemeContext._ThemeProvider, {
        children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_AppContext._AppProvider, {
          children: children
        })
      })
    })
  })
});

// Mock fetch for all PropOllama endpoints
// Helper to match both relative and absolute URLs for PropOllama endpoints
const isPropOllamaEndpoint = (url, endpoint) => {
  // Accepts /api/propollama/endpoint and http://localhost:8000/api/propollama/endpoint (and 8001)
  return url.endsWith(`/api/propollama/${endpoint}`) || url === `/api/propollama/${endpoint}` || url === `http://localhost:8000/api/propollama/${endpoint}` || url === `http://localhost:8001/api/propollama/${endpoint}`;
};
afterEach(() => {
  jest.resetAllMocks();
});
afterEach(() => {
  jest.resetAllMocks();
});
test('displays health check status', async () => {
  (0, _react.render)(/*#__PURE__*/(0, _jsxRuntime.jsx)(CompositeProvider, {
    children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_PropOllama.default, {})
  }));
  // Use aria-label for robust querying
  const _healthBtn = _react.screen.getByRole('button', {
    name: /check propollama api health/i
  });
  _react.fireEvent.click(_healthBtn);
  await (0, _react.waitFor)(() => {
    expect(_react.screen.queryByText(/health check failed/i)).not.toBeInTheDocument();
  });
});
test('displays backend error message', async () => {
  (0, _react.render)(/*#__PURE__*/(0, _jsxRuntime.jsx)(CompositeProvider, {
    children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_PropOllama.default, {})
  }));
  const _input = _react.screen.getByLabelText(/type your message/i);
  _react.fireEvent.change(_input, {
    target: {
      value: 'error'
    }
  });
  _react.fireEvent.submit(_input.form);
  await (0, _react.waitFor)(() => {
    const alert = _react.screen.getByRole('alert');
    expect(alert).toHaveTextContent(/simulated error/i);
    expect(alert).toHaveTextContent(/traceback/i);
    expect(alert).toHaveTextContent(/http 500/i);
  });
});
test('displays AI response for valid message', async () => {
  (0, _react.render)(/*#__PURE__*/(0, _jsxRuntime.jsx)(CompositeProvider, {
    children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_PropOllama.default, {})
  }));
  // Wait for the model dropdown to be populated
  await (0, _react.waitFor)(() => {
    const modelSelect = _react.screen.getByLabelText(/model:/i);
    expect(modelSelect.options.length).toBeGreaterThan(0);
  });
  const _input = _react.screen.getByLabelText(/type your message/i);
  _react.fireEvent.change(_input, {
    target: {
      value: 'hello'
    }
  });
  _react.fireEvent.submit(_input.form);
  // Use getAllByText and filter for the actual AI message
  await (0, _react.waitFor)(() => {
    const aiResponses = _react.screen.getAllByText((content, node) => typeof content === 'string' && content.includes('AI response'), {
      exact: false
    });
    // Find the one that is inside a message bubble (has a parent with role="listitem" and aria-label="AI message")
    const aiMessage = aiResponses.find(node => {
      let el = node.parentElement;
      while (el) {
        if (el.getAttribute && el.getAttribute('aria-label') === 'AI message') {
          return true;
        }
        el = el.parentElement;
      }
      return false;
    });
    expect(aiMessage).toBeInTheDocument();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wT2xsYW1hU2VydmljZSIsIl9yZWFjdFF1ZXJ5IiwiX3JlYWN0IiwiX3JlYWN0MiIsIl9yZWFjdFJvdXRlckRvbSIsIl9BcHBDb250ZXh0IiwiX0F1dGhDb250ZXh0IiwiX1RoZW1lQ29udGV4dCIsIl9Qcm9wT2xsYW1hIiwiX2pzeFJ1bnRpbWUiLCJqZXN0IiwiY29uc29sZSIsImxvZyIsInByb3BPbGxhbWFTZXJ2aWNlIiwibWF0Y2hNZWRpYU1vY2siLCJxdWVyeSIsIm1hdGNoZXMiLCJtZWRpYSIsIm9uY2hhbmdlIiwiYWRkTGlzdGVuZXIiLCJmbiIsInJlbW92ZUxpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJkaXNwYXRjaEV2ZW50IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJIVE1MRGl2RWxlbWVudCIsInByb3RvdHlwZSIsInZhbHVlIiwid3JpdGFibGUiLCJ3aW5kb3ciLCJtYXRjaE1lZGlhIiwiZ2xvYmFsIiwiZG9jdW1lbnQiLCJFbGVtZW50IiwiYWxlcnQiLCJDb21wb3NpdGVQcm92aWRlciIsImNoaWxkcmVuIiwianN4IiwiUXVlcnlDbGllbnRQcm92aWRlciIsImNsaWVudCIsIlF1ZXJ5Q2xpZW50IiwiX0F1dGhQcm92aWRlciIsIk1lbW9yeVJvdXRlciIsIl9UaGVtZVByb3ZpZGVyIiwiX0FwcFByb3ZpZGVyIiwiaXNQcm9wT2xsYW1hRW5kcG9pbnQiLCJ1cmwiLCJlbmRwb2ludCIsImVuZHNXaXRoIiwiYWZ0ZXJFYWNoIiwicmVzZXRBbGxNb2NrcyIsInRlc3QiLCJyZW5kZXIiLCJkZWZhdWx0IiwiX2hlYWx0aEJ0biIsInNjcmVlbiIsImdldEJ5Um9sZSIsIm5hbWUiLCJmaXJlRXZlbnQiLCJjbGljayIsIndhaXRGb3IiLCJleHBlY3QiLCJxdWVyeUJ5VGV4dCIsIm5vdCIsInRvQmVJblRoZURvY3VtZW50IiwiX2lucHV0IiwiZ2V0QnlMYWJlbFRleHQiLCJjaGFuZ2UiLCJ0YXJnZXQiLCJzdWJtaXQiLCJmb3JtIiwidG9IYXZlVGV4dENvbnRlbnQiLCJtb2RlbFNlbGVjdCIsIm9wdGlvbnMiLCJsZW5ndGgiLCJ0b0JlR3JlYXRlclRoYW4iLCJhaVJlc3BvbnNlcyIsImdldEFsbEJ5VGV4dCIsImNvbnRlbnQiLCJub2RlIiwiaW5jbHVkZXMiLCJleGFjdCIsImFpTWVzc2FnZSIsImZpbmQiLCJlbCIsInBhcmVudEVsZW1lbnQiLCJnZXRBdHRyaWJ1dGUiXSwic291cmNlcyI6WyJQcm9wT2xsYW1hLnRlc3QudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImplc3QubW9jaygnYXhpb3MnKTtcclxuXHJcbmplc3QubW9jaygnLi4vLi4vLi4vc2VydmljZXMvcHJvcE9sbGFtYVNlcnZpY2UnKTtcclxuXHJcbmplc3QubW9jaygnLi4vLi4vLi4vc2VydmljZXMvYmFja2VuZERpc2NvdmVyeScpO1xyXG5cclxuLy8gTW9jayB0aGUgZXhhY3QgcGF0aCB1c2VkIGJ5IHRoZSBjb21wb25lbnQgZm9yIHByb3BPbGxhbWFTZXJ2aWNlXHJcblxyXG4vLyBbREVCVUddIFRvcCBvZiB0ZXN0IGZpbGVcclxuY29uc29sZS5sb2coJ1tERUJVR10gVG9wIG9mIFByb3BPbGxhbWEudGVzdC50c3gnKTtcclxuaW1wb3J0IHsgcHJvcE9sbGFtYVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wcm9wT2xsYW1hU2VydmljZSc7XHJcbmNvbnNvbGUubG9nKCdbREVCVUddIEltcG9ydGVkIHByb3BPbGxhbWFTZXJ2aWNlIGluIHRlc3Q6JywgcHJvcE9sbGFtYVNlcnZpY2UpO1xyXG5cclxuLy8gTW9jayBtYXRjaE1lZGlhIGFuZCBzY3JvbGxJbnRvVmlldyBmb3IganNkb20gYW5kIGZyYW1lci1tb3Rpb24gcmVxdWlyZW1lbnRzXHJcbmNvbnN0IG1hdGNoTWVkaWFNb2NrID0gKHF1ZXJ5OiBzdHJpbmcpID0+ICh7XHJcbiAgbWF0Y2hlczogZmFsc2UsXHJcbiAgbWVkaWE6IHF1ZXJ5LFxyXG4gIG9uY2hhbmdlOiBudWxsLFxyXG4gIGFkZExpc3RlbmVyOiBqZXN0LmZuKCksIC8vIGRlcHJlY2F0ZWRcclxuICByZW1vdmVMaXN0ZW5lcjogamVzdC5mbigpLCAvLyBkZXByZWNhdGVkXHJcbiAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcclxuICBkaXNwYXRjaEV2ZW50OiBqZXN0LmZuKCksXHJcbn0pO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoSFRNTERpdkVsZW1lbnQucHJvdG90eXBlLCAnc2Nyb2xsSW50b1ZpZXcnLCB7XHJcbiAgdmFsdWU6IGplc3QuZm4oKSxcclxuICB3cml0YWJsZTogdHJ1ZSxcclxufSk7XHJcblxyXG4vLyBBc3NpZ24gbWF0Y2hNZWRpYSBhZnRlciBmdW5jdGlvbiBkZWZpbml0aW9uXHJcbndpbmRvdy5tYXRjaE1lZGlhID0gbWF0Y2hNZWRpYU1vY2s7XHJcbmdsb2JhbC5tYXRjaE1lZGlhID0gbWF0Y2hNZWRpYU1vY2s7XHJcbmlmICghd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA9IGplc3QuZm4oKTtcclxufVxyXG5pZiAoIWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyID0gamVzdC5mbigpO1xyXG59XHJcbmlmICghRWxlbWVudC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcikge1xyXG4gIEVsZW1lbnQucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBqZXN0LmZuKCk7XHJcbn1cclxuaWYgKCFFbGVtZW50LnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyKSB7XHJcbiAgRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGplc3QuZm4oKTtcclxufVxyXG53aW5kb3cuYWxlcnQgPSBqZXN0LmZuKCk7XHJcbmlmICghd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA9IGplc3QuZm4oKTtcclxufVxyXG5pZiAoIWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyID0gamVzdC5mbigpO1xyXG59XHJcbmlmICghRWxlbWVudC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcikge1xyXG4gIEVsZW1lbnQucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBqZXN0LmZuKCk7XHJcbn1cclxuaWYgKCFFbGVtZW50LnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyKSB7XHJcbiAgRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGplc3QuZm4oKTtcclxufVxyXG53aW5kb3cuYWxlcnQgPSBqZXN0LmZuKCk7XHJcblxyXG5pbXBvcnQgeyBRdWVyeUNsaWVudCwgUXVlcnlDbGllbnRQcm92aWRlciB9IGZyb20gJ0B0YW5zdGFjay9yZWFjdC1xdWVyeSc7XHJcbmltcG9ydCB7IGZpcmVFdmVudCwgcmVuZGVyLCBzY3JlZW4sIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcclxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgTWVtb3J5Um91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XHJcbmltcG9ydCB7IF9BcHBQcm92aWRlciB9IGZyb20gJy4uLy4uLy4uL2NvbnRleHRzL0FwcENvbnRleHQnO1xyXG5pbXBvcnQgeyBfQXV0aFByb3ZpZGVyIH0gZnJvbSAnLi4vLi4vLi4vY29udGV4dHMvQXV0aENvbnRleHQnO1xyXG5pbXBvcnQgeyBfVGhlbWVQcm92aWRlciB9IGZyb20gJy4uLy4uLy4uL2NvbnRleHRzL1RoZW1lQ29udGV4dCc7XHJcbmltcG9ydCBQcm9wT2xsYW1hIGZyb20gJy4uL1Byb3BPbGxhbWEnO1xyXG5cclxuY29uc3QgQ29tcG9zaXRlUHJvdmlkZXI6IFJlYWN0LkZDPHsgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSB9PiA9ICh7IGNoaWxkcmVuIH0pID0+IChcclxuICA8UXVlcnlDbGllbnRQcm92aWRlciBjbGllbnQ9e25ldyBRdWVyeUNsaWVudCgpfT5cclxuICAgIDxfQXV0aFByb3ZpZGVyPlxyXG4gICAgICA8TWVtb3J5Um91dGVyPlxyXG4gICAgICAgIDxfVGhlbWVQcm92aWRlcj5cclxuICAgICAgICAgIDxfQXBwUHJvdmlkZXI+e2NoaWxkcmVufTwvX0FwcFByb3ZpZGVyPlxyXG4gICAgICAgIDwvX1RoZW1lUHJvdmlkZXI+XHJcbiAgICAgIDwvTWVtb3J5Um91dGVyPlxyXG4gICAgPC9fQXV0aFByb3ZpZGVyPlxyXG4gIDwvUXVlcnlDbGllbnRQcm92aWRlcj5cclxuKTtcclxuXHJcbi8vIE1vY2sgZmV0Y2ggZm9yIGFsbCBQcm9wT2xsYW1hIGVuZHBvaW50c1xyXG4vLyBIZWxwZXIgdG8gbWF0Y2ggYm90aCByZWxhdGl2ZSBhbmQgYWJzb2x1dGUgVVJMcyBmb3IgUHJvcE9sbGFtYSBlbmRwb2ludHNcclxuY29uc3QgaXNQcm9wT2xsYW1hRW5kcG9pbnQgPSAodXJsOiBzdHJpbmcsIGVuZHBvaW50OiBzdHJpbmcpID0+IHtcclxuICAvLyBBY2NlcHRzIC9hcGkvcHJvcG9sbGFtYS9lbmRwb2ludCBhbmQgaHR0cDovL2xvY2FsaG9zdDo4MDAwL2FwaS9wcm9wb2xsYW1hL2VuZHBvaW50IChhbmQgODAwMSlcclxuICByZXR1cm4gKFxyXG4gICAgdXJsLmVuZHNXaXRoKGAvYXBpL3Byb3BvbGxhbWEvJHtlbmRwb2ludH1gKSB8fFxyXG4gICAgdXJsID09PSBgL2FwaS9wcm9wb2xsYW1hLyR7ZW5kcG9pbnR9YCB8fFxyXG4gICAgdXJsID09PSBgaHR0cDovL2xvY2FsaG9zdDo4MDAwL2FwaS9wcm9wb2xsYW1hLyR7ZW5kcG9pbnR9YCB8fFxyXG4gICAgdXJsID09PSBgaHR0cDovL2xvY2FsaG9zdDo4MDAxL2FwaS9wcm9wb2xsYW1hLyR7ZW5kcG9pbnR9YFxyXG4gICk7XHJcbn07XHJcblxyXG5hZnRlckVhY2goKCkgPT4ge1xyXG4gIGplc3QucmVzZXRBbGxNb2NrcygpO1xyXG59KTtcclxuXHJcbmFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgamVzdC5yZXNldEFsbE1vY2tzKCk7XHJcbn0pO1xyXG5cclxudGVzdCgnZGlzcGxheXMgaGVhbHRoIGNoZWNrIHN0YXR1cycsIGFzeW5jICgpID0+IHtcclxuICByZW5kZXIoXHJcbiAgICA8Q29tcG9zaXRlUHJvdmlkZXI+XHJcbiAgICAgIDxQcm9wT2xsYW1hIC8+XHJcbiAgICA8L0NvbXBvc2l0ZVByb3ZpZGVyPlxyXG4gICk7XHJcbiAgLy8gVXNlIGFyaWEtbGFiZWwgZm9yIHJvYnVzdCBxdWVyeWluZ1xyXG4gIGNvbnN0IF9oZWFsdGhCdG4gPSBzY3JlZW4uZ2V0QnlSb2xlKCdidXR0b24nLCB7IG5hbWU6IC9jaGVjayBwcm9wb2xsYW1hIGFwaSBoZWFsdGgvaSB9KTtcclxuICBmaXJlRXZlbnQuY2xpY2soX2hlYWx0aEJ0bik7XHJcbiAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICBleHBlY3Qoc2NyZWVuLnF1ZXJ5QnlUZXh0KC9oZWFsdGggY2hlY2sgZmFpbGVkL2kpKS5ub3QudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9KTtcclxufSk7XHJcblxyXG50ZXN0KCdkaXNwbGF5cyBiYWNrZW5kIGVycm9yIG1lc3NhZ2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgcmVuZGVyKFxyXG4gICAgPENvbXBvc2l0ZVByb3ZpZGVyPlxyXG4gICAgICA8UHJvcE9sbGFtYSAvPlxyXG4gICAgPC9Db21wb3NpdGVQcm92aWRlcj5cclxuICApO1xyXG4gIGNvbnN0IF9pbnB1dCA9IHNjcmVlbi5nZXRCeUxhYmVsVGV4dCgvdHlwZSB5b3VyIG1lc3NhZ2UvaSkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICBmaXJlRXZlbnQuY2hhbmdlKF9pbnB1dCwgeyB0YXJnZXQ6IHsgdmFsdWU6ICdlcnJvcicgfSB9KTtcclxuICBmaXJlRXZlbnQuc3VibWl0KF9pbnB1dC5mb3JtISk7XHJcbiAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICBjb25zdCBhbGVydCA9IHNjcmVlbi5nZXRCeVJvbGUoJ2FsZXJ0Jyk7XHJcbiAgICBleHBlY3QoYWxlcnQpLnRvSGF2ZVRleHRDb250ZW50KC9zaW11bGF0ZWQgZXJyb3IvaSk7XHJcbiAgICBleHBlY3QoYWxlcnQpLnRvSGF2ZVRleHRDb250ZW50KC90cmFjZWJhY2svaSk7XHJcbiAgICBleHBlY3QoYWxlcnQpLnRvSGF2ZVRleHRDb250ZW50KC9odHRwIDUwMC9pKTtcclxuICB9KTtcclxufSk7XHJcblxyXG50ZXN0KCdkaXNwbGF5cyBBSSByZXNwb25zZSBmb3IgdmFsaWQgbWVzc2FnZScsIGFzeW5jICgpID0+IHtcclxuICByZW5kZXIoXHJcbiAgICA8Q29tcG9zaXRlUHJvdmlkZXI+XHJcbiAgICAgIDxQcm9wT2xsYW1hIC8+XHJcbiAgICA8L0NvbXBvc2l0ZVByb3ZpZGVyPlxyXG4gICk7XHJcbiAgLy8gV2FpdCBmb3IgdGhlIG1vZGVsIGRyb3Bkb3duIHRvIGJlIHBvcHVsYXRlZFxyXG4gIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kZWxTZWxlY3QgPSBzY3JlZW4uZ2V0QnlMYWJlbFRleHQoL21vZGVsOi9pKSBhcyBIVE1MU2VsZWN0RWxlbWVudDtcclxuICAgIGV4cGVjdChtb2RlbFNlbGVjdC5vcHRpb25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gIH0pO1xyXG4gIGNvbnN0IF9pbnB1dCA9IHNjcmVlbi5nZXRCeUxhYmVsVGV4dCgvdHlwZSB5b3VyIG1lc3NhZ2UvaSkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICBmaXJlRXZlbnQuY2hhbmdlKF9pbnB1dCwgeyB0YXJnZXQ6IHsgdmFsdWU6ICdoZWxsbycgfSB9KTtcclxuICBmaXJlRXZlbnQuc3VibWl0KF9pbnB1dC5mb3JtISk7XHJcbiAgLy8gVXNlIGdldEFsbEJ5VGV4dCBhbmQgZmlsdGVyIGZvciB0aGUgYWN0dWFsIEFJIG1lc3NhZ2VcclxuICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgIGNvbnN0IGFpUmVzcG9uc2VzID0gc2NyZWVuLmdldEFsbEJ5VGV4dChcclxuICAgICAgKGNvbnRlbnQsIG5vZGUpID0+IHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJyAmJiBjb250ZW50LmluY2x1ZGVzKCdBSSByZXNwb25zZScpLFxyXG4gICAgICB7IGV4YWN0OiBmYWxzZSB9XHJcbiAgICApO1xyXG4gICAgLy8gRmluZCB0aGUgb25lIHRoYXQgaXMgaW5zaWRlIGEgbWVzc2FnZSBidWJibGUgKGhhcyBhIHBhcmVudCB3aXRoIHJvbGU9XCJsaXN0aXRlbVwiIGFuZCBhcmlhLWxhYmVsPVwiQUkgbWVzc2FnZVwiKVxyXG4gICAgY29uc3QgYWlNZXNzYWdlID0gYWlSZXNwb25zZXMuZmluZChub2RlID0+IHtcclxuICAgICAgbGV0IGVsID0gbm9kZS5wYXJlbnRFbGVtZW50O1xyXG4gICAgICB3aGlsZSAoZWwpIHtcclxuICAgICAgICBpZiAoZWwuZ2V0QXR0cmlidXRlICYmIGVsLmdldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpID09PSAnQUkgbWVzc2FnZScpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbCA9IGVsLnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcbiAgICBleHBlY3QoYWlNZXNzYWdlKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxXQUFBLEdBQUtDLElBQUksQ0FBQyxPQUFPLENBQUM7QUFFbEJELFdBQUEsR0FBS0MsSUFBSSxDQUFDLHFDQUFxQyxD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