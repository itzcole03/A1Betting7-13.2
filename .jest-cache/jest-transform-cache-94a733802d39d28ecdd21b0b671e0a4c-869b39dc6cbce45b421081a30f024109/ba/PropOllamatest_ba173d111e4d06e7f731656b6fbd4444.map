{"version":3,"names":["_getJestObj","mock","_interopRequireDefault","require","_propOllamaService","_reactQuery","_react","_react2","_reactRouterDom","_AppContext","_AuthContext","_ThemeContext","_PropOllama","_jsxRuntime","jest","console","log","propOllamaService","matchMediaMock","query","matches","media","onchange","addListener","fn","removeListener","addEventListener","removeEventListener","dispatchEvent","Object","defineProperty","HTMLDivElement","prototype","value","writable","window","matchMedia","global","document","Element","alert","CompositeProvider","children","jsx","QueryClientProvider","client","QueryClient","_AuthProvider","MemoryRouter","_ThemeProvider","_AppProvider","isPropOllamaEndpoint","url","endpoint","endsWith","afterEach","resetAllMocks","test","render","default","_healthBtn","screen","getByRole","name","fireEvent","click","waitFor","expect","queryByText","not","toBeInTheDocument","_input","getByLabelText","change","target","submit","form","toHaveTextContent","modelSelect","options","length","toBeGreaterThan","aiResponses","getAllByText","content","node","includes","exact","aiMessage","find","el","parentElement","getAttribute"],"sources":["PropOllama.test.tsx"],"sourcesContent":["jest.mock('axios');\r\n\r\njest.mock('../../../services/propOllamaService');\r\n\r\njest.mock('../../../services/backendDiscovery');\r\n\r\n// Mock the exact path used by the component for propOllamaService\r\n\r\n// [DEBUG] Top of test file\r\nconsole.log('[DEBUG] Top of PropOllama.test.tsx');\r\nimport { propOllamaService } from '../../../services/propOllamaService';\r\nconsole.log('[DEBUG] Imported propOllamaService in test:', propOllamaService);\r\n\r\n// Mock matchMedia and scrollIntoView for jsdom and framer-motion requirements\r\nconst matchMediaMock = (query: string) => ({\r\n  matches: false,\r\n  media: query,\r\n  onchange: null,\r\n  addListener: jest.fn(), // deprecated\r\n  removeListener: jest.fn(), // deprecated\r\n  addEventListener: jest.fn(),\r\n  removeEventListener: jest.fn(),\r\n  dispatchEvent: jest.fn(),\r\n});\r\nObject.defineProperty(HTMLDivElement.prototype, 'scrollIntoView', {\r\n  value: jest.fn(),\r\n  writable: true,\r\n});\r\n\r\n// Assign matchMedia after function definition\r\nwindow.matchMedia = matchMediaMock;\r\nglobal.matchMedia = matchMediaMock;\r\nif (!window.addEventListener) {\r\n  window.addEventListener = jest.fn();\r\n}\r\nif (!document.addEventListener) {\r\n  document.addEventListener = jest.fn();\r\n}\r\nif (!Element.prototype.addEventListener) {\r\n  Element.prototype.addEventListener = jest.fn();\r\n}\r\nif (!Element.prototype.removeEventListener) {\r\n  Element.prototype.removeEventListener = jest.fn();\r\n}\r\nwindow.alert = jest.fn();\r\nif (!window.addEventListener) {\r\n  window.addEventListener = jest.fn();\r\n}\r\nif (!document.addEventListener) {\r\n  document.addEventListener = jest.fn();\r\n}\r\nif (!Element.prototype.addEventListener) {\r\n  Element.prototype.addEventListener = jest.fn();\r\n}\r\nif (!Element.prototype.removeEventListener) {\r\n  Element.prototype.removeEventListener = jest.fn();\r\n}\r\nwindow.alert = jest.fn();\r\n\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { fireEvent, render, screen, waitFor } from '@testing-library/react';\r\nimport React from 'react';\r\nimport { MemoryRouter } from 'react-router-dom';\r\nimport { _AppProvider } from '../../../contexts/AppContext';\r\nimport { _AuthProvider } from '../../../contexts/AuthContext';\r\nimport { _ThemeProvider } from '../../../contexts/ThemeContext';\r\nimport PropOllama from '../PropOllama';\r\n\r\nconst CompositeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <QueryClientProvider client={new QueryClient()}>\r\n    <_AuthProvider>\r\n      <MemoryRouter>\r\n        <_ThemeProvider>\r\n          <_AppProvider>{children}</_AppProvider>\r\n        </_ThemeProvider>\r\n      </MemoryRouter>\r\n    </_AuthProvider>\r\n  </QueryClientProvider>\r\n);\r\n\r\n// Mock fetch for all PropOllama endpoints\r\n// Helper to match both relative and absolute URLs for PropOllama endpoints\r\nconst isPropOllamaEndpoint = (url: string, endpoint: string) => {\r\n  // Accepts /api/propollama/endpoint and http://localhost:8000/api/propollama/endpoint (and 8001)\r\n  return (\r\n    url.endsWith(`/api/propollama/${endpoint}`) ||\r\n    url === `/api/propollama/${endpoint}` ||\r\n    url === `http://localhost:8000/api/propollama/${endpoint}` ||\r\n    url === `http://localhost:8001/api/propollama/${endpoint}`\r\n  );\r\n};\r\n\r\nafterEach(() => {\r\n  jest.resetAllMocks();\r\n});\r\n\r\nafterEach(() => {\r\n  jest.resetAllMocks();\r\n});\r\n\r\ntest('displays health check status', async () => {\r\n  render(\r\n    <CompositeProvider>\r\n      <PropOllama />\r\n    </CompositeProvider>\r\n  );\r\n  // Use aria-label for robust querying\r\n  const _healthBtn = screen.getByRole('button', { name: /check propollama api health/i });\r\n  fireEvent.click(_healthBtn);\r\n  await waitFor(() => {\r\n    expect(screen.queryByText(/health check failed/i)).not.toBeInTheDocument();\r\n  });\r\n});\r\n\r\ntest('displays backend error message', async () => {\r\n  render(\r\n    <CompositeProvider>\r\n      <PropOllama />\r\n    </CompositeProvider>\r\n  );\r\n  const _input = screen.getByLabelText(/type your message/i) as HTMLInputElement;\r\n  fireEvent.change(_input, { target: { value: 'error' } });\r\n  fireEvent.submit(_input.form!);\r\n  await waitFor(() => {\r\n    const alert = screen.getByRole('alert');\r\n    expect(alert).toHaveTextContent(/simulated error/i);\r\n    expect(alert).toHaveTextContent(/traceback/i);\r\n    expect(alert).toHaveTextContent(/http 500/i);\r\n  });\r\n});\r\n\r\ntest('displays AI response for valid message', async () => {\r\n  render(\r\n    <CompositeProvider>\r\n      <PropOllama />\r\n    </CompositeProvider>\r\n  );\r\n  // Wait for the model dropdown to be populated\r\n  await waitFor(() => {\r\n    const modelSelect = screen.getByLabelText(/model:/i) as HTMLSelectElement;\r\n    expect(modelSelect.options.length).toBeGreaterThan(0);\r\n  });\r\n  const _input = screen.getByLabelText(/type your message/i) as HTMLInputElement;\r\n  fireEvent.change(_input, { target: { value: 'hello' } });\r\n  fireEvent.submit(_input.form!);\r\n  // Use getAllByText and filter for the actual AI message\r\n  await waitFor(() => {\r\n    const aiResponses = screen.getAllByText(\r\n      (content, node) => typeof content === 'string' && content.includes('AI response'),\r\n      { exact: false }\r\n    );\r\n    // Find the one that is inside a message bubble (has a parent with role=\"listitem\" and aria-label=\"AI message\")\r\n    const aiMessage = aiResponses.find(node => {\r\n      let el = node.parentElement;\r\n      while (el) {\r\n        if (el.getAttribute && el.getAttribute('aria-label') === 'AI message') {\r\n          return true;\r\n        }\r\n        el = el.parentElement;\r\n      }\r\n      return false;\r\n    });\r\n    expect(aiMessage).toBeInTheDocument();\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}