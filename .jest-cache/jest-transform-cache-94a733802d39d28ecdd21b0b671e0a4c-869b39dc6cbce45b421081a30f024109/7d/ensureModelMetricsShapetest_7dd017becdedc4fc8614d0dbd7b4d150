183c5a8fa485a3a86b96807c2a7130d3
"use strict";

var _ensureModelMetricsShape = require("../ensureModelMetricsShape");
describe('ensureModelMetricsShape', () => {
  it('should handle empty object with full defaults', () => {
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)({});
    expect(result).toEqual({
      model: {
        name: 'Unknown Model',
        provider: 'Unknown Provider',
        optimization_level: 'Basic'
      },
      performance: {
        throughput_rps: 0,
        avg_latency_ms: 0,
        p95_latency_ms: 0,
        success_rate: 0
      },
      usage: {
        total_requests: 0,
        input_tokens: 0,
        output_tokens: 0,
        total_tokens: 0
      },
      originFlags: {
        partialPayload: true
      }
    });
  });
  it('should map legacy optimization_level fields', () => {
    const legacyData = {
      optimizationLevel: 'Advanced',
      opt_level: 'Phase 3',
      modelName: 'Test Model',
      provider: 'OpenAI',
      system_info: {
        optimization_level: 'Phase 4 Enhanced'
      }
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(legacyData);

    // Should use first found value (optimizationLevel)
    expect(result.model.optimization_level).toBe('Advanced');
    expect(result.model.name).toBe('Test Model');
    expect(result.model.provider).toBe('OpenAI');
    expect(result.originFlags?.mappedLegacy).toBe(true);
  });
  it('should prefer canonical structure over legacy', () => {
    const mixedData = {
      model: {
        name: 'Canonical Model',
        provider: 'Canonical Provider',
        optimization_level: 'Canonical Level'
      },
      // Legacy fields should be ignored
      modelName: 'Legacy Model',
      provider: 'Legacy Provider',
      optimizationLevel: 'Legacy Level',
      performance: {
        throughput_rps: 100,
        avg_latency_ms: 50
      }
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(mixedData);
    expect(result.model.name).toBe('Canonical Model');
    expect(result.model.provider).toBe('Canonical Provider');
    expect(result.model.optimization_level).toBe('Canonical Level');
    expect(result.performance.throughput_rps).toBe(100);
    expect(result.originFlags?.mappedLegacy).toBeFalsy();
  });
  it('should coerce string numbers to numbers', () => {
    const stringData = {
      model: {
        name: 'String Model',
        provider: 'Test',
        optimization_level: 'Basic'
      },
      performance: {
        throughput_rps: '123.45',
        avg_latency_ms: '67.89',
        success_rate: '0.95'
      },
      usage: {
        total_requests: '1000',
        input_tokens: '500',
        output_tokens: '300'
      }
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(stringData);
    expect(result.performance.throughput_rps).toBe(123.45);
    expect(result.performance.avg_latency_ms).toBe(67.89);
    expect(result.performance.success_rate).toBe(0.95);
    expect(result.usage.total_requests).toBe(1000);
    expect(result.usage.total_tokens).toBe(800); // Derived sum
  });
  it('should mark partial payload when sections missing', () => {
    const partialData = {
      model: {
        name: 'Partial Model',
        optimization_level: 'Basic'
      },
      // Missing performance and usage sections
      some_other_field: 'value'
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(partialData);
    expect(result.originFlags?.partialPayload).toBe(true);
    // Should still have safe defaults for missing sections
    expect(result.performance.throughput_rps).toBe(0);
    expect(result.usage.total_requests).toBe(0);
  });
  it('should handle multiple legacy optimization variants', () => {
    const legacyData = {
      opt_level: 'Phase 2',
      optimization_mode: 'Fast',
      optimizationTier: 'High',
      modelName: 'Multi-Legacy Model'
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(legacyData);

    // Should use first match in legacy path order
    expect(result.model.optimization_level).toBe('Phase 2');
    expect(result.model.name).toBe('Multi-Legacy Model');
    expect(result.originFlags?.mappedLegacy).toBe(true);
  });
  it('should derive total_tokens from input + output', () => {
    const tokenData = {
      model: {
        name: 'Token Model',
        provider: 'Test',
        optimization_level: 'Basic'
      },
      performance: {
        throughput_rps: 10,
        avg_latency_ms: 100,
        p95_latency_ms: 200,
        success_rate: 0.9
      },
      usage: {
        total_requests: 100,
        input_tokens: 150,
        output_tokens: 75
        // total_tokens missing - should be derived
      }
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(tokenData);
    expect(result.usage.total_tokens).toBe(225); // 150 + 75
  });
  it('should derive success_rate from success_requests/total_requests', () => {
    const successData = {
      model: {
        name: 'Success Model',
        provider: 'Test',
        optimization_level: 'Basic'
      },
      performance: {
        throughput_rps: 10,
        avg_latency_ms: 100,
        p95_latency_ms: 200
      },
      // Missing success_rate in performance section
      success_requests: 85,
      total_requests: 100,
      usage: {
        total_requests: 100,
        input_tokens: 0,
        output_tokens: 0,
        total_tokens: 0
      }
    };
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(successData);
    expect(result.performance.success_rate).toBe(0.85);
    expect(result.originFlags?.mappedLegacy).toBe(true);
  });
  it('should handle null input gracefully', () => {
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)(null);
    expect(result.model.name).toBe('Unknown Model');
    expect(result.model.optimization_level).toBe('Basic');
    expect(result.originFlags?.partialPayload).toBe(true);
  });
  it('should handle non-object input gracefully', () => {
    const result = (0, _ensureModelMetricsShape.ensureModelMetricsShape)('invalid input');
    expect(result.model.name).toBe('Unknown Model');
    expect(result.performance.throughput_rps).toBe(0);
    expect(result.usage.total_requests).toBe(0);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZW5zdXJlTW9kZWxNZXRyaWNzU2hhcGUiLCJyZXF1aXJlIiwiZGVzY3JpYmUiLCJpdCIsInJlc3VsdCIsImVuc3VyZU1vZGVsTWV0cmljc1NoYXBlIiwiZXhwZWN0IiwidG9FcXVhbCIsIm1vZGVsIiwibmFtZSIsInByb3ZpZGVyIiwib3B0aW1pemF0aW9uX2xldmVsIiwicGVyZm9ybWFuY2UiLCJ0aHJvdWdocHV0X3JwcyIsImF2Z19sYXRlbmN5X21zIiwicDk1X2xhdGVuY3lfbXMiLCJzdWNjZXNzX3JhdGUiLCJ1c2FnZSIsInRvdGFsX3JlcXVlc3RzIiwiaW5wdXRfdG9rZW5zIiwib3V0cHV0X3Rva2VucyIsInRvdGFsX3Rva2VucyIsIm9yaWdpbkZsYWdzIiwicGFydGlhbFBheWxvYWQiLCJsZWdhY3lEYXRhIiwib3B0aW1pemF0aW9uTGV2ZWwiLCJvcHRfbGV2ZWwiLCJtb2RlbE5hbWUiLCJzeXN0ZW1faW5mbyIsInRvQmUiLCJtYXBwZWRMZWdhY3kiLCJtaXhlZERhdGEiLCJ0b0JlRmFsc3kiLCJzdHJpbmdEYXRhIiwicGFydGlhbERhdGEiLCJzb21lX290aGVyX2ZpZWxkIiwib3B0aW1pemF0aW9uX21vZGUiLCJvcHRpbWl6YXRpb25UaWVyIiwidG9rZW5EYXRhIiwic3VjY2Vzc0RhdGEiLCJzdWNjZXNzX3JlcXVlc3RzIl0sInNvdXJjZXMiOlsiZW5zdXJlTW9kZWxNZXRyaWNzU2hhcGUudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlbnN1cmVNb2RlbE1ldHJpY3NTaGFwZSB9IGZyb20gJy4uL2Vuc3VyZU1vZGVsTWV0cmljc1NoYXBlJztcclxuXHJcbmRlc2NyaWJlKCdlbnN1cmVNb2RlbE1ldHJpY3NTaGFwZScsICgpID0+IHtcclxuICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBvYmplY3Qgd2l0aCBmdWxsIGRlZmF1bHRzJywgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gZW5zdXJlTW9kZWxNZXRyaWNzU2hhcGUoe30pO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcclxuICAgICAgbW9kZWw6IHtcclxuICAgICAgICBuYW1lOiAnVW5rbm93biBNb2RlbCcsXHJcbiAgICAgICAgcHJvdmlkZXI6ICdVbmtub3duIFByb3ZpZGVyJywgXHJcbiAgICAgICAgb3B0aW1pemF0aW9uX2xldmVsOiAnQmFzaWMnXHJcbiAgICAgIH0sXHJcbiAgICAgIHBlcmZvcm1hbmNlOiB7XHJcbiAgICAgICAgdGhyb3VnaHB1dF9ycHM6IDAsXHJcbiAgICAgICAgYXZnX2xhdGVuY3lfbXM6IDAsXHJcbiAgICAgICAgcDk1X2xhdGVuY3lfbXM6IDAsXHJcbiAgICAgICAgc3VjY2Vzc19yYXRlOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHVzYWdlOiB7XHJcbiAgICAgICAgdG90YWxfcmVxdWVzdHM6IDAsXHJcbiAgICAgICAgaW5wdXRfdG9rZW5zOiAwLFxyXG4gICAgICAgIG91dHB1dF90b2tlbnM6IDAsXHJcbiAgICAgICAgdG90YWxfdG9rZW5zOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIG9yaWdpbkZsYWdzOiB7XHJcbiAgICAgICAgcGFydGlhbFBheWxvYWQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgbWFwIGxlZ2FjeSBvcHRpbWl6YXRpb25fbGV2ZWwgZmllbGRzJywgKCkgPT4ge1xyXG4gICAgY29uc3QgbGVnYWN5RGF0YSA9IHtcclxuICAgICAgb3B0aW1pemF0aW9uTGV2ZWw6ICdBZHZhbmNlZCcsXHJcbiAgICAgIG9wdF9sZXZlbDogJ1BoYXNlIDMnLFxyXG4gICAgICBtb2RlbE5hbWU6ICdUZXN0IE1vZGVsJyxcclxuICAgICAgcHJvdmlkZXI6ICdPcGVuQUknLFxyXG4gICAgICBzeXN0ZW1faW5mbzoge1xyXG4gICAgICAgIG9wdGltaXphdGlvbl9sZXZlbDogJ1BoYXNlIDQgRW5oYW5jZWQnXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gZW5zdXJlTW9kZWxNZXRyaWNzU2hhcGUobGVnYWN5RGF0YSk7XHJcbiAgICBcclxuICAgIC8vIFNob3VsZCB1c2UgZmlyc3QgZm91bmQgdmFsdWUgKG9wdGltaXphdGlvbkxldmVsKVxyXG4gICAgZXhwZWN0KHJlc3VsdC5tb2RlbC5vcHRpbWl6YXRpb25fbGV2ZWwpLnRvQmUoJ0FkdmFuY2VkJyk7XHJcbiAgICBleHBlY3QocmVzdWx0Lm1vZGVsLm5hbWUpLnRvQmUoJ1Rlc3QgTW9kZWwnKTtcclxuICAgIGV4cGVjdChyZXN1bHQubW9kZWwucHJvdmlkZXIpLnRvQmUoJ09wZW5BSScpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5vcmlnaW5GbGFncz8ubWFwcGVkTGVnYWN5KS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIHByZWZlciBjYW5vbmljYWwgc3RydWN0dXJlIG92ZXIgbGVnYWN5JywgKCkgPT4ge1xyXG4gICAgY29uc3QgbWl4ZWREYXRhID0ge1xyXG4gICAgICBtb2RlbDoge1xyXG4gICAgICAgIG5hbWU6ICdDYW5vbmljYWwgTW9kZWwnLFxyXG4gICAgICAgIHByb3ZpZGVyOiAnQ2Fub25pY2FsIFByb3ZpZGVyJyxcclxuICAgICAgICBvcHRpbWl6YXRpb25fbGV2ZWw6ICdDYW5vbmljYWwgTGV2ZWwnXHJcbiAgICAgIH0sXHJcbiAgICAgIC8vIExlZ2FjeSBmaWVsZHMgc2hvdWxkIGJlIGlnbm9yZWRcclxuICAgICAgbW9kZWxOYW1lOiAnTGVnYWN5IE1vZGVsJyxcclxuICAgICAgcHJvdmlkZXI6ICdMZWdhY3kgUHJvdmlkZXInLFxyXG4gICAgICBvcHRpbWl6YXRpb25MZXZlbDogJ0xlZ2FjeSBMZXZlbCcsXHJcbiAgICAgIHBlcmZvcm1hbmNlOiB7XHJcbiAgICAgICAgdGhyb3VnaHB1dF9ycHM6IDEwMCxcclxuICAgICAgICBhdmdfbGF0ZW5jeV9tczogNTBcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBlbnN1cmVNb2RlbE1ldHJpY3NTaGFwZShtaXhlZERhdGEpO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzdWx0Lm1vZGVsLm5hbWUpLnRvQmUoJ0Nhbm9uaWNhbCBNb2RlbCcpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5tb2RlbC5wcm92aWRlcikudG9CZSgnQ2Fub25pY2FsIFByb3ZpZGVyJyk7XHJcbiAgICBleHBlY3QocmVzdWx0Lm1vZGVsLm9wdGltaXphdGlvbl9sZXZlbCkudG9CZSgnQ2Fub25pY2FsIExldmVsJyk7XHJcbiAgICBleHBlY3QocmVzdWx0LnBlcmZvcm1hbmNlLnRocm91Z2hwdXRfcnBzKS50b0JlKDEwMCk7XHJcbiAgICBleHBlY3QocmVzdWx0Lm9yaWdpbkZsYWdzPy5tYXBwZWRMZWdhY3kpLnRvQmVGYWxzeSgpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGNvZXJjZSBzdHJpbmcgbnVtYmVycyB0byBudW1iZXJzJywgKCkgPT4ge1xyXG4gICAgY29uc3Qgc3RyaW5nRGF0YSA9IHtcclxuICAgICAgbW9kZWw6IHtcclxuICAgICAgICBuYW1lOiAnU3RyaW5nIE1vZGVsJyxcclxuICAgICAgICBwcm92aWRlcjogJ1Rlc3QnLFxyXG4gICAgICAgIG9wdGltaXphdGlvbl9sZXZlbDogJ0Jhc2ljJ1xyXG4gICAgICB9LFxyXG4gICAgICBwZXJmb3JtYW5jZToge1xyXG4gICAgICAgIHRocm91Z2hwdXRfcnBzOiAnMTIzLjQ1JyxcclxuICAgICAgICBhdmdfbGF0ZW5jeV9tczogJzY3Ljg5JyxcclxuICAgICAgICBzdWNjZXNzX3JhdGU6ICcwLjk1J1xyXG4gICAgICB9LFxyXG4gICAgICB1c2FnZToge1xyXG4gICAgICAgIHRvdGFsX3JlcXVlc3RzOiAnMTAwMCcsXHJcbiAgICAgICAgaW5wdXRfdG9rZW5zOiAnNTAwJyxcclxuICAgICAgICBvdXRwdXRfdG9rZW5zOiAnMzAwJ1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGVuc3VyZU1vZGVsTWV0cmljc1NoYXBlKHN0cmluZ0RhdGEpO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzdWx0LnBlcmZvcm1hbmNlLnRocm91Z2hwdXRfcnBzKS50b0JlKDEyMy40NSk7XHJcbiAgICBleHBlY3QocmVzdWx0LnBlcmZvcm1hbmNlLmF2Z19sYXRlbmN5X21zKS50b0JlKDY3Ljg5KTtcclxuICAgIGV4cGVjdChyZXN1bHQucGVyZm9ybWFuY2Uuc3VjY2Vzc19yYXRlKS50b0JlKDAuOTUpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC51c2FnZS50b3RhbF9yZXF1ZXN0cykudG9CZSgxMDAwKTtcclxuICAgIGV4cGVjdChyZXN1bHQudXNhZ2UudG90YWxfdG9rZW5zKS50b0JlKDgwMCk7IC8vIERlcml2ZWQgc3VtXHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgbWFyayBwYXJ0aWFsIHBheWxvYWQgd2hlbiBzZWN0aW9ucyBtaXNzaW5nJywgKCkgPT4ge1xyXG4gICAgY29uc3QgcGFydGlhbERhdGEgPSB7XHJcbiAgICAgIG1vZGVsOiB7XHJcbiAgICAgICAgbmFtZTogJ1BhcnRpYWwgTW9kZWwnLFxyXG4gICAgICAgIG9wdGltaXphdGlvbl9sZXZlbDogJ0Jhc2ljJ1xyXG4gICAgICB9LFxyXG4gICAgICAvLyBNaXNzaW5nIHBlcmZvcm1hbmNlIGFuZCB1c2FnZSBzZWN0aW9uc1xyXG4gICAgICBzb21lX290aGVyX2ZpZWxkOiAndmFsdWUnXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGVuc3VyZU1vZGVsTWV0cmljc1NoYXBlKHBhcnRpYWxEYXRhKTtcclxuICAgIFxyXG4gICAgZXhwZWN0KHJlc3VsdC5vcmlnaW5GbGFncz8ucGFydGlhbFBheWxvYWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAvLyBTaG91bGQgc3RpbGwgaGF2ZSBzYWZlIGRlZmF1bHRzIGZvciBtaXNzaW5nIHNlY3Rpb25zXHJcbiAgICBleHBlY3QocmVzdWx0LnBlcmZvcm1hbmNlLnRocm91Z2hwdXRfcnBzKS50b0JlKDApO1xyXG4gICAgZXhwZWN0KHJlc3VsdC51c2FnZS50b3RhbF9yZXF1ZXN0cykudG9CZSgwKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgbXVsdGlwbGUgbGVnYWN5IG9wdGltaXphdGlvbiB2YXJpYW50cycsICgpID0+IHtcclxuICAgIGNvbnN0IGxlZ2FjeURhdGEgPSB7XHJcbiAgICAgIG9wdF9sZXZlbDogJ1BoYXNlIDInLFxyXG4gICAgICBvcHRpbWl6YXRpb25fbW9kZTogJ0Zhc3QnLCBcclxuICAgICAgb3B0aW1pemF0aW9uVGllcjogJ0hpZ2gnLFxyXG4gICAgICBtb2RlbE5hbWU6ICdNdWx0aS1MZWdhY3kgTW9kZWwnXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGVuc3VyZU1vZGVsTWV0cmljc1NoYXBlKGxlZ2FjeURhdGEpO1xyXG4gICAgXHJcbiAgICAvLyBTaG91bGQgdXNlIGZpcnN0IG1hdGNoIGluIGxlZ2FjeSBwYXRoIG9yZGVyXHJcbiAgICBleHBlY3QocmVzdWx0Lm1vZGVsLm9wdGltaXphdGlvbl9sZXZlbCkudG9CZSgnUGhhc2UgMicpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5tb2RlbC5uYW1lKS50b0JlKCdNdWx0aS1MZWdhY3kgTW9kZWwnKTtcclxuICAgIGV4cGVjdChyZXN1bHQub3JpZ2luRmxhZ3M/Lm1hcHBlZExlZ2FjeSkudG9CZSh0cnVlKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBkZXJpdmUgdG90YWxfdG9rZW5zIGZyb20gaW5wdXQgKyBvdXRwdXQnLCAoKSA9PiB7XHJcbiAgICBjb25zdCB0b2tlbkRhdGEgPSB7XHJcbiAgICAgIG1vZGVsOiB7IG5hbWU6ICdUb2tlbiBNb2RlbCcsIHByb3ZpZGVyOiAnVGVzdCcsIG9wdGltaXphdGlvbl9sZXZlbDogJ0Jhc2ljJyB9LFxyXG4gICAgICBwZXJmb3JtYW5jZTogeyB0aHJvdWdocHV0X3JwczogMTAsIGF2Z19sYXRlbmN5X21zOiAxMDAsIHA5NV9sYXRlbmN5X21zOiAyMDAsIHN1Y2Nlc3NfcmF0ZTogMC45IH0sXHJcbiAgICAgIHVzYWdlOiB7XHJcbiAgICAgICAgdG90YWxfcmVxdWVzdHM6IDEwMCxcclxuICAgICAgICBpbnB1dF90b2tlbnM6IDE1MCxcclxuICAgICAgICBvdXRwdXRfdG9rZW5zOiA3NSxcclxuICAgICAgICAvLyB0b3RhbF90b2tlbnMgbWlzc2luZyAtIHNob3VsZCBiZSBkZXJpdmVkXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gZW5zdXJlTW9kZWxNZXRyaWNzU2hhcGUodG9rZW5EYXRhKTtcclxuICAgIFxyXG4gICAgZXhwZWN0KHJlc3VsdC51c2FnZS50b3RhbF90b2tlbnMpLnRvQmUoMjI1KTsgLy8gMTUwICsgNzVcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBkZXJpdmUgc3VjY2Vzc19yYXRlIGZyb20gc3VjY2Vzc19yZXF1ZXN0cy90b3RhbF9yZXF1ZXN0cycsICgpID0+IHtcclxuICAgIGNvbnN0IHN1Y2Nlc3NEYXRhID0ge1xyXG4gICAgICBtb2RlbDogeyBuYW1lOiAnU3VjY2VzcyBNb2RlbCcsIHByb3ZpZGVyOiAnVGVzdCcsIG9wdGltaXphdGlvbl9sZXZlbDogJ0Jhc2ljJyB9LFxyXG4gICAgICBwZXJmb3JtYW5jZTogeyB0aHJvdWdocHV0X3JwczogMTAsIGF2Z19sYXRlbmN5X21zOiAxMDAsIHA5NV9sYXRlbmN5X21zOiAyMDAgfSxcclxuICAgICAgLy8gTWlzc2luZyBzdWNjZXNzX3JhdGUgaW4gcGVyZm9ybWFuY2Ugc2VjdGlvblxyXG4gICAgICBzdWNjZXNzX3JlcXVlc3RzOiA4NSxcclxuICAgICAgdG90YWxfcmVxdWVzdHM6IDEwMCxcclxuICAgICAgdXNhZ2U6IHsgdG90YWxfcmVxdWVzdHM6IDEwMCwgaW5wdXRfdG9rZW5zOiAwLCBvdXRwdXRfdG9rZW5zOiAwLCB0b3RhbF90b2tlbnM6IDAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBlbnN1cmVNb2RlbE1ldHJpY3NTaGFwZShzdWNjZXNzRGF0YSk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXN1bHQucGVyZm9ybWFuY2Uuc3VjY2Vzc19yYXRlKS50b0JlKDAuODUpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5vcmlnaW5GbGFncz8ubWFwcGVkTGVnYWN5KS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGhhbmRsZSBudWxsIGlucHV0IGdyYWNlZnVsbHknLCAoKSA9PiB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBlbnN1cmVNb2RlbE1ldHJpY3NTaGFwZShudWxsKTtcclxuICAgIFxyXG4gICAgZXhwZWN0KHJlc3VsdC5tb2RlbC5uYW1lKS50b0JlKCdVbmtub3duIE1vZGVsJyk7XHJcbiAgICBleHBlY3QocmVzdWx0Lm1vZGVsLm9wdGltaXphdGlvbl9sZXZlbCkudG9CZSgnQmFzaWMnKTtcclxuICAgIGV4cGVjdChyZXN1bHQub3JpZ2luRmxhZ3M/LnBhcnRpYWxQYXlsb2FkKS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGhhbmRsZSBub24tb2JqZWN0IGlucHV0IGdyYWNlZnVsbHknLCAoKSA9PiB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBlbnN1cmVNb2RlbE1ldHJpY3NTaGFwZSgnaW52YWxpZCBpbnB1dCcpO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzdWx0Lm1vZGVsLm5hbWUpLnRvQmUoJ1Vua25vd24gTW9kZWwnKTtcclxuICAgIGV4cGVjdChyZXN1bHQucGVyZm9ybWFuY2UudGhyb3VnaHB1dF9ycHMpLnRvQmUoMCk7XHJcbiAgICBleHBlY3QocmVzdWx0LnVzYWdlLnRvdGFsX3JlcXVlc3RzKS50b0JlKDApO1xyXG4gIH0pO1xyXG59KTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsd0JBQUEsR0FBQUMsT0FBQTtBQUVBQyxRQUFRLENBQUMseUJBQXlCLEVB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