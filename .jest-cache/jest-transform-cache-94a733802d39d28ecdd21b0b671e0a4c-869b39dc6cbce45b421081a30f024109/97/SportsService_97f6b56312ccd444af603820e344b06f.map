{"version":3,"names":["_HttpClient","require","logApiEvent","event","details","isTest","process","env","NODE_ENV","window","console","warn","detectSportsApiVersion","v2resp","httpFetch","method","logLabel","ok","debug","status","isTest2","error","Error","message","includes","name","isTest3","isTest4","v1resp","activateSport","sport","headers","body","JSON","stringify","version","data","json","requestId","get","version_used","catch","err","newly_loaded","isTestFinal","checkApiVersionCompatibility"],"sources":["SportsService.ts"],"sourcesContent":["// SportsService.ts - v2 sports activation and related endpoints\r\nimport { httpFetch } from './HttpClient';\r\n\r\nexport interface ActivateSportResponse {\r\n  status: string; // e.g. 'success'\r\n  message?: string;\r\n  error_code?: string;\r\n  current_version?: string;\r\n  migration_guide?: string;\r\n  version_used?: string;\r\n  newly_loaded?: boolean;\r\n  load_time?: number;\r\n}\r\n\r\n/**\r\n * Logs API versioning and migration events for diagnostics.\r\n */\r\nfunction logApiEvent(event: string, details: Record<string, unknown>) {\r\n  const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n  if (isTest) return;\r\n  if (typeof window !== 'undefined' && window.console) {\r\n    // eslint-disable-next-line no-console\r\n    console.warn(`[SportsService] ${event}:`, details);\r\n  }\r\n}\r\n\r\n/**\r\n * Checks which sports activation API version is available.\r\n * Returns 'v2', 'v1', or 'none'.\r\n */\r\nexport async function detectSportsApiVersion(): Promise<'v2' | 'v1' | 'none'> {\r\n  // Try v2 endpoint with OPTIONS (safe, no side effects)\r\n  try {\r\n    const v2resp = await httpFetch('/api/v2/sports/activate', {\r\n      method: 'OPTIONS',\r\n      logLabel: 'SportsService',\r\n    });\r\n    if (v2resp.ok) {\r\n      // Successful preflight indicates v2 is available and CORS is properly configured\r\n      const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest) {\r\n        // eslint-disable-next-line no-console\r\n        console.debug('[SportsService] v2 API detected via OPTIONS preflight');\r\n      }\r\n      return 'v2';\r\n    } else if (v2resp.status === 405) {\r\n      // 405 can indicate endpoint exists but OPTIONS not explicitly handled  \r\n      const isTest2 = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest2) {\r\n        // eslint-disable-next-line no-console\r\n        console.debug('[SportsService] v2 API detected via 405 (method not allowed for OPTIONS)');\r\n      }\r\n      return 'v2';\r\n    }\r\n  } catch (error) {\r\n    // Handle network errors gracefully\r\n    if (error instanceof Error && (error.message.includes('Failed to fetch') || error.name === 'TypeError')) {\r\n      const isTest3 = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest3) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[SportsService] Backend unavailable, falling back to demo mode');\r\n      }\r\n      return 'none';\r\n    }\r\n    const isTest4 = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n    if (!isTest4) {\r\n      // eslint-disable-next-line no-console\r\n      console.debug('[SportsService] v2 OPTIONS check failed:', error);\r\n    }\r\n  }\r\n  // Try v1 endpoint\r\n  try {\r\n    const v1resp = await httpFetch('/api/sports/activate/MLB', {\r\n      method: 'OPTIONS',\r\n      logLabel: 'SportsService',\r\n    });\r\n    if (v1resp.ok || v1resp.status === 405) {\r\n      return 'v1';\r\n    }\r\n  } catch (error) {\r\n    // Handle network errors gracefully\r\n    if (error instanceof Error && (error.message.includes('Failed to fetch') || error.name === 'TypeError')) {\r\n      const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[SportsService] Backend unavailable, falling back to demo mode');\r\n      }\r\n      return 'none';\r\n    }\r\n  }\r\n  return 'none';\r\n}\r\n\r\n/**\r\n * Activates a sport using the best available API version.\r\n * Tries v2, falls back to v1 with warning and logs deprecated usage.\r\n * Returns demo mode response if backend unavailable instead of throwing.\r\n */\r\nexport async function activateSport(sport: string): Promise<ActivateSportResponse> {\r\n  // Try v2 first\r\n  try {\r\n    const v2resp = await httpFetch(`/api/v2/sports/activate`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ sport }),\r\n      logLabel: 'SportsService',\r\n      version: 'v2',\r\n    });\r\n    if (v2resp.ok) {\r\n      const data = await v2resp.json();\r\n      logApiEvent('v2 activation success', {\r\n        sport,\r\n        requestId: v2resp.headers.get('X-Request-ID'),\r\n      });\r\n      return { ...data, version_used: 'v2' };\r\n    } else if (v2resp.status === 404 || v2resp.status === 410) {\r\n      logApiEvent('v2 endpoint unavailable', {\r\n        status: v2resp.status,\r\n        sport,\r\n        requestId: v2resp.headers.get('X-Request-ID'),\r\n      });\r\n      // Fall through to v1\r\n    } else {\r\n      const data = await v2resp.json().catch(() => ({}));\r\n      throw new Error(\r\n        data?.message || `Failed to activate sport (v2): ${sport} (status ${v2resp.status})`\r\n      );\r\n    }\r\n  } catch (err) {\r\n    // Handle network errors gracefully\r\n    if (err instanceof Error && (err.message.includes('Failed to fetch') || err.name === 'TypeError')) {\r\n      const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[SportsService] Backend unavailable, returning demo mode activation');\r\n      }\r\n      return {\r\n        status: 'success',\r\n        message: `${sport} activated in demo mode`,\r\n        version_used: 'demo',\r\n        newly_loaded: true,\r\n      };\r\n    }\r\n    logApiEvent('v2 activation error', { error: (err as Error).message, sport });\r\n    // Fall through to v1\r\n  }\r\n  // Try v1 as fallback\r\n  try {\r\n    const v1resp = await httpFetch(`/api/sports/activate/${sport}`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      logLabel: 'SportsService',\r\n      version: 'v1',\r\n    });\r\n    if (v1resp.ok) {\r\n      const data = await v1resp.json();\r\n      logApiEvent('deprecated v1 endpoint used', {\r\n        sport,\r\n        requestId: v1resp.headers.get('X-Request-ID'),\r\n      });\r\n      return { ...data, version_used: 'v1' };\r\n    } else {\r\n      const data = await v1resp.json().catch(() => ({}));\r\n      throw new Error(\r\n        data?.message || `Failed to activate sport (v1): ${sport} (status ${v1resp.status})`\r\n      );\r\n    }\r\n  } catch (err) {\r\n    // Handle network errors gracefully\r\n    if (err instanceof Error && (err.message.includes('Failed to fetch') || err.name === 'TypeError')) {\r\n      const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[SportsService] Backend unavailable, returning demo mode activation');\r\n      }\r\n      return {\r\n        status: 'success',\r\n        message: `${sport} activated in demo mode`,\r\n        version_used: 'demo',\r\n        newly_loaded: true,\r\n      };\r\n    }\r\n    logApiEvent('v1 activation error', { error: (err as Error).message, sport });\r\n    // Return demo mode instead of throwing\r\n    const isTestFinal = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n    if (!isTestFinal) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(`[SportsService] All activation attempts failed for ${sport}, falling back to demo mode`);\r\n    }\r\n    return {\r\n      status: 'success',\r\n      message: `${sport} activated in demo mode (backend unavailable)`,\r\n      version_used: 'demo',\r\n      newly_loaded: true,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Checks API version compatibility at app startup. Logs and falls back to demo mode if no backend available.\r\n */\r\nexport async function checkApiVersionCompatibility() {\r\n  try {\r\n    const version = await detectSportsApiVersion();\r\n    if (version === 'none') {\r\n      logApiEvent('no compatible sports activation API found - using demo mode', {});\r\n      const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n      if (!isTest) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[SportsService] Backend unavailable, application will run in demo mode');\r\n      }\r\n      return 'demo'; // Return demo mode instead of throwing\r\n    }\r\n    if (version === 'v1') {\r\n      logApiEvent('using deprecated v1 sports activation API', {});\r\n    }\r\n    return version;\r\n  } catch (error) {\r\n    const isTest = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\r\n    if (!isTest) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[SportsService] API compatibility check failed, falling back to demo mode:', error);\r\n    }\r\n    return 'demo';\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}