{"version":3,"names":["_react","_interopRequireWildcard","require","_robustApi","_jsxRuntime","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","toNumberOrDefault","v","def","isFinite","normalizeMetrics","raw","wrapper","data","dataObj","canonicalCache","legacyCache","cachePerf","total_requests","hits","misses","errors","hit_rate","apiPerf","healthPerf","undefined","avgResponseTime","PerformanceMonitoringDashboard","metrics","setMetrics","useState","useEffect","mounted","load","resp","fetchPerformanceStats","normalized","process","env","NODE_ENV","jest","mappedLegacy","console","log","total","formatPercent","Number","toFixed","display","jsxs","className","children","jsx","String","_default","exports"],"sources":["PerformanceMonitoringDashboard.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { fetchPerformanceStats } from '../utils/robustApi';\r\n\r\ntype RawMetrics = unknown;\r\n\r\ninterface Metrics {\r\n  total_requests: number;\r\n  hits: number;\r\n  misses: number;\r\n  errors: number;\r\n  hit_rate: number;\r\n  avgResponseTime: number;\r\n}\r\n\r\nconst toNumberOrDefault = (v: unknown, def = 0) => (typeof v === 'number' && isFinite(v) ? v : def);\r\n\r\nfunction normalizeMetrics(raw: RawMetrics): Metrics {\r\n  // raw may be: { data: { cache_performance: {...} } } or { data: { cache: {...} } } or direct object\r\n  const wrapper = raw && typeof raw === 'object' && 'data' in (raw as Record<string, unknown>) ? (raw as Record<string, unknown>).data : (raw as Record<string, unknown> | undefined) || {};\r\n\r\n  const dataObj = wrapper as Record<string, unknown>;\r\n\r\n    // Prefer canonical `cache` object when present; merge legacy `cache_performance` and canonical\r\n    // so canonical keys override legacy but missing fields are filled from legacy.\r\n    const canonicalCache = (dataObj['cache'] as Record<string, unknown> | undefined) ?? {};\r\n    const legacyCache = (dataObj['cache_performance'] as Record<string, unknown> | undefined) ?? {};\r\n    const cachePerf = { ...legacyCache, ...canonicalCache };\r\n\r\n  const total_requests = toNumberOrDefault(cachePerf['total_requests'] ?? cachePerf['totalRequests'] ?? 0, 0);\r\n  const hits = toNumberOrDefault(cachePerf['hits'] ?? 0, 0);\r\n  const misses = toNumberOrDefault(cachePerf['misses'] ?? 0, 0);\r\n  const errors = toNumberOrDefault(cachePerf['errors'] ?? 0, 0);\r\n  const hit_rate = toNumberOrDefault(cachePerf['hit_rate'] ?? cachePerf['hitRate'] ?? cachePerf['hitRatePercent'] ?? 0, 0);\r\n\r\n  const apiPerf = dataObj['api_performance'] as Record<string, unknown> | undefined;\r\n  const healthPerf = apiPerf && apiPerf['/health'] ? (apiPerf['/health'] as Record<string, unknown>) : undefined;\r\n  const avgResponseTime = toNumberOrDefault(healthPerf ? healthPerf['avg_time_ms'] : dataObj['avgResponseTime'], 0);\r\n\r\n  return {\r\n    total_requests,\r\n    hits,\r\n    misses,\r\n    errors,\r\n    hit_rate,\r\n    avgResponseTime,\r\n  };\r\n}\r\n\r\nconst PerformanceMonitoringDashboard: React.FC = () => {\r\n  const [metrics, setMetrics] = useState<Metrics | null>(null);\r\n  // loading state removed; use `metrics` undefined/null to distinguish states\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n  const load = async () => {\r\n  try {\r\n        const resp = await fetchPerformanceStats();\r\n        if (!mounted) return;\r\n        const normalized = normalizeMetrics(resp);\r\n        setMetrics(normalized);\r\n\r\n        if (process.env.NODE_ENV === 'development' || typeof jest !== 'undefined') {\r\n          // Emit diagnostics expected by tests\r\n          const dataObj = resp && typeof resp === 'object' && 'data' in (resp as Record<string, unknown>) ? (resp as Record<string, unknown>).data as Record<string, unknown> : null;\r\n          const mappedLegacy = !!(dataObj && ('originFlags' in dataObj || 'origin_flags' in dataObj));\r\n          // eslint-disable-next-line no-console\r\n          console.log('[MetricsDiag]', {\r\n            total: normalized.total_requests,\r\n            hits: normalized.hits,\r\n            misses: normalized.misses,\r\n            errors: normalized.errors,\r\n            mappedLegacy,\r\n          });\r\n        }\r\n      } catch {\r\n        // On failure, set explicit null so fallback renders only on error\r\n        setMetrics(null);\r\n      }\r\n    };\r\n\r\n    load();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const formatPercent = (n: number | null | undefined) => {\r\n    if (n === null || n === undefined || !Number.isFinite(n)) return '0.0%';\r\n    return `${Number(n).toFixed(1)}%`;\r\n  };\r\n\r\n  const display = {\r\n    total_requests: metrics ? metrics.total_requests : 0,\r\n    hits: metrics ? metrics.hits : 0,\r\n    misses: metrics ? metrics.misses : 0,\r\n    hit_rate: metrics ? metrics.hit_rate : 0,\r\n    avgResponseTime: metrics ? metrics.avgResponseTime : null,\r\n  };\r\n\r\n  return (\r\n    <div className='bg-gray-900 text-white p-6 rounded shadow-lg'>\r\n      <h2 className='text-xl font-bold mb-4'>Performance Monitoring</h2>\r\n\r\n      <div>\r\n        <h3 className='text-lg font-semibold mb-2'>API Performance</h3>\r\n        <ul className='space-y-2'>\r\n          <li>\r\n            <span className='font-semibold'>Total Requests</span>{' '}\r\n            <span data-testid='total-requests'>{String(display.total_requests)}</span>\r\n          </li>\r\n          <li>\r\n            <span className='font-semibold'>Cache Hits</span>{' '}\r\n            <span data-testid='cache-hits'>{String(display.hits)}</span>\r\n          </li>\r\n          <li>\r\n            <span className='font-semibold'>Cache Misses</span>: <span data-testid='cache-misses'>{String(display.misses)}</span>\r\n          </li>\r\n          <li>\r\n            <span className='font-semibold'>Hit Rate</span>: <span data-testid='cache-hit-rate'>{formatPercent(display.hit_rate)}</span>\r\n          </li>\r\n        </ul>\r\n\r\n        {metrics === null && (\r\n          <div className='mt-4 text-yellow-400'>\r\n            Using demo data. Metrics data unavailable. Please check backend connection.\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PerformanceMonitoringDashboard;\r\n"],"mappings":"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","ignoreList":[]}