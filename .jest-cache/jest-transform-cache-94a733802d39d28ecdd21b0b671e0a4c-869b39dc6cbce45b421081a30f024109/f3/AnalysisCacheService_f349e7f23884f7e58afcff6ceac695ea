38708fe21f964f96e9fd03e4d6546390
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AnalysisCacheService = void 0;
var _AnalysisCacheService;
/**
 * Multi-level caching service for prop analysis results
 * Implements memory cache with TTL and optional localStorage persistence
 */
class AnalysisCacheService {
  // 30 minutes

  constructor() {
    this.memoryCache = void 0;
    this.stats = void 0;
    this.DEFAULT_TTL = 5 * 60 * 1000;
    // 5 minutes
    this.STALE_TTL = 30 * 60 * 1000;
    this.memoryCache = new Map();
    this.stats = {
      hits: 0,
      misses: 0,
      stale: 0,
      evictions: 0
    };

    // Run cache cleanup every minute
    setInterval(() => this.cleanupExpiredEntries(), 60 * 1000);
  }

  /**
   * Get singleton instance
   */
  static getInstance() {
    if (!AnalysisCacheService.instance) {
      AnalysisCacheService.instance = new AnalysisCacheService();
    }
    return AnalysisCacheService.instance;
  }

  /**
   * Generate a cache key from a request
   */
  static generateCacheKey(request) {
    const {
      propId,
      player,
      team,
      sport,
      statType,
      line
    } = request;
    return `prop_analysis:${propId}:${player}:${team}:${sport}:${statType}:${line}`;
  }

  /**
   * Get an item from cache
   * Returns null if not found or expired
   * Returns the item with isStale=true if it's stale but not fully expired
   */
  get(key) {
    // Use a consistent key format
    const actualKey = key.startsWith('cache:') ? key : `cache:${key}`;
    const entry = this.memoryCache.get(actualKey);
    if (!entry) {
      this.stats.misses++;
      return this.getFromLocalStorage(actualKey);
    }
    const now = Date.now();
    const age = now - entry.timestamp;

    // If fully expired
    if (age >= entry.ttl + this.STALE_TTL) {
      this.memoryCache.delete(key);
      this.stats.misses++;
      return this.getFromLocalStorage(key);
    }

    // If stale but not fully expired
    if (age > entry.ttl) {
      this.stats.stale++;
      return {
        ...entry.value,
        isStale: true
      };
    }

    // Fresh hit
    this.stats.hits++;
    return entry.value;
  }

  /**
   * Set an item in cache
   */
  set(key, value, options) {
    const ttl = options?.ttl || this.DEFAULT_TTL;

    // Use a consistent key format
    const actualKey = key.startsWith('cache:') ? key : `cache:${key}`;
    this.memoryCache.set(actualKey, {
      value,
      timestamp: Date.now(),
      ttl
    });

    // Also store in localStorage if available
    this.setInLocalStorage(actualKey, value, ttl);
  }

  /**
   * Check if an item exists in cache and is not expired
   */
  has(key) {
    // Use a consistent key format
    const actualKey = key.startsWith('cache:') ? key : `cache:${key}`;
    const entry = this.memoryCache.get(actualKey);
    if (!entry) {
      return this.hasInLocalStorage(actualKey);
    }
    const now = Date.now();
    return now - entry.timestamp <= entry.ttl;
  }

  /**
   * Delete an item from cache
   */
  delete(key) {
    // Use a consistent key format
    const actualKey = key.startsWith('cache:') ? key : `cache:${key}`;
    this.memoryCache.delete(actualKey);
    this.deleteFromLocalStorage(actualKey);
  }

  /**
   * Clear the entire cache
   */
  clear() {
    // Get a list of all keys to explicitly delete each one
    // This ensures we properly handle prefix consistency
    const keysToDelete = [];
    for (const key of this.memoryCache.keys()) {
      keysToDelete.push(key);
    }

    // Delete each key individually
    for (const key of keysToDelete) {
      this.delete(key.replace('cache:', ''));
    }

    // Also clear the memory cache and localStorage
    this.memoryCache.clear();
    this.clearLocalStorage();
  }

  /**
   * Get cache statistics
   */
  getStats() {
    return {
      ...this.stats
    };
  }

  /**
   * Clean up expired entries
   */
  cleanupExpiredEntries() {
    const now = Date.now();
    let evictionCount = 0;
    for (const [key, entry] of this.memoryCache.entries()) {
      if (now - entry.timestamp > entry.ttl + this.STALE_TTL) {
        this.memoryCache.delete(key);
        evictionCount++;
      }
    }
    if (evictionCount > 0) {
      this.stats.evictions += evictionCount;
    }
  }

  /**
   * Get an item from localStorage
   */
  getFromLocalStorage(key) {
    try {
      if (typeof localStorage === 'undefined') return null;

      // Key should already be in 'cache:' format
      const storedItem = localStorage.getItem(key);
      if (!storedItem) return null;
      const entry = JSON.parse(storedItem);
      const now = Date.now();
      const age = now - entry.timestamp;

      // If fully expired
      if (age >= entry.ttl + this.STALE_TTL) {
        localStorage.removeItem(key);
        return null;
      }

      // If stale but not fully expired
      if (age > entry.ttl) {
        this.stats.stale++;
        return {
          ...entry.value,
          isStale: true
        };
      }

      // Fresh hit from localStorage
      this.stats.hits++;

      // Also add to memory cache for faster access next time
      this.memoryCache.set(key, entry);
      return entry.value;
    } catch (error) {
      console.error('Error reading from localStorage:', error);
      return null;
    }
  }

  /**
   * Set an item in localStorage
   */
  setInLocalStorage(key, value, ttl) {
    try {
      if (typeof localStorage === 'undefined') return;
      const entry = {
        value,
        timestamp: Date.now(),
        ttl
      };

      // Key should already be in 'cache:' format
      localStorage.setItem(key, JSON.stringify(entry));
    } catch (error) {
      console.error('Error writing to localStorage:', error);
    }
  }

  /**
   * Check if an item exists in localStorage and is not expired
   */
  hasInLocalStorage(key) {
    try {
      if (typeof localStorage === 'undefined') return false;

      // Key should already be in 'cache:' format
      const storedItem = localStorage.getItem(key);
      if (!storedItem) return false;
      const entry = JSON.parse(storedItem);
      const now = Date.now();
      return now - entry.timestamp <= entry.ttl;
    } catch (error) {
      console.error('Error checking localStorage:', error);
      return false;
    }
  }

  /**
   * Delete an item from localStorage
   */
  deleteFromLocalStorage(key) {
    try {
      if (typeof localStorage === 'undefined') return;
      // Key should already be in 'cache:' format
      localStorage.removeItem(key);
    } catch (error) {
      console.error('Error deleting from localStorage:', error);
    }
  }

  /**
   * Clear all cache items from localStorage
   */
  clearLocalStorage() {
    try {
      if (typeof localStorage === 'undefined') return;
      const keysToRemove = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('cache:')) {
          keysToRemove.push(key);
        }
      }
      keysToRemove.forEach(key => localStorage.removeItem(key));
    } catch (error) {
      console.error('Error clearing localStorage cache:', error);
    }
  }
}
exports.AnalysisCacheService = AnalysisCacheService;
_AnalysisCacheService = AnalysisCacheService;
AnalysisCacheService.instance = void 0;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBbmFseXNpc0NhY2hlU2VydmljZSIsImNvbnN0cnVjdG9yIiwibWVtb3J5Q2FjaGUiLCJzdGF0cyIsIkRFRkFVTFRfVFRMIiwiU1RBTEVfVFRMIiwiTWFwIiwiaGl0cyIsIm1pc3NlcyIsInN0YWxlIiwiZXZpY3Rpb25zIiwic2V0SW50ZXJ2YWwiLCJjbGVhbnVwRXhwaXJlZEVudHJpZXMiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiZ2VuZXJhdGVDYWNoZUtleSIsInJlcXVlc3QiLCJwcm9wSWQiLCJwbGF5ZXIiLCJ0ZWFtIiwic3BvcnQiLCJzdGF0VHlwZSIsImxpbmUiLCJnZXQiLCJrZXkiLCJhY3R1YWxLZXkiLCJzdGFydHNXaXRoIiwiZW50cnkiLCJnZXRGcm9tTG9jYWxTdG9yYWdlIiwibm93IiwiRGF0ZSIsImFnZSIsInRpbWVzdGFtcCIsInR0bCIsImRlbGV0ZSIsInZhbHVlIiwiaXNTdGFsZSIsInNldCIsIm9wdGlvbnMiLCJzZXRJbkxvY2FsU3RvcmFnZSIsImhhcyIsImhhc0luTG9jYWxTdG9yYWdlIiwiZGVsZXRlRnJvbUxvY2FsU3RvcmFnZSIsImNsZWFyIiwia2V5c1RvRGVsZXRlIiwia2V5cyIsInB1c2giLCJyZXBsYWNlIiwiY2xlYXJMb2NhbFN0b3JhZ2UiLCJnZXRTdGF0cyIsImV2aWN0aW9uQ291bnQiLCJlbnRyaWVzIiwibG9jYWxTdG9yYWdlIiwic3RvcmVkSXRlbSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJyZW1vdmVJdGVtIiwiZXJyb3IiLCJjb25zb2xlIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImtleXNUb1JlbW92ZSIsImkiLCJsZW5ndGgiLCJmb3JFYWNoIiwiZXhwb3J0cyIsIl9BbmFseXNpc0NhY2hlU2VydmljZSJdLCJzb3VyY2VzIjpbIkFuYWx5c2lzQ2FjaGVTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb3BBbmFseXNpc1JlcXVlc3QsIFByb3BBbmFseXNpc1Jlc3BvbnNlIH0gZnJvbSAnLi9Qcm9wQW5hbHlzaXNBZ2dyZWdhdG9yJztcclxuXHJcbmludGVyZmFjZSBDYWNoZUVudHJ5PFQ+IHtcclxuICB2YWx1ZTogVDtcclxuICB0aW1lc3RhbXA6IG51bWJlcjtcclxuICB0dGw6IG51bWJlcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIENhY2hlU3RhdHMge1xyXG4gIGhpdHM6IG51bWJlcjtcclxuICBtaXNzZXM6IG51bWJlcjtcclxuICBzdGFsZTogbnVtYmVyO1xyXG4gIGV2aWN0aW9uczogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogTXVsdGktbGV2ZWwgY2FjaGluZyBzZXJ2aWNlIGZvciBwcm9wIGFuYWx5c2lzIHJlc3VsdHNcclxuICogSW1wbGVtZW50cyBtZW1vcnkgY2FjaGUgd2l0aCBUVEwgYW5kIG9wdGlvbmFsIGxvY2FsU3RvcmFnZSBwZXJzaXN0ZW5jZVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEFuYWx5c2lzQ2FjaGVTZXJ2aWNlIHtcclxuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQW5hbHlzaXNDYWNoZVNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBtZW1vcnlDYWNoZTogTWFwPHN0cmluZywgQ2FjaGVFbnRyeTxQcm9wQW5hbHlzaXNSZXNwb25zZT4+O1xyXG4gIHByaXZhdGUgc3RhdHM6IENhY2hlU3RhdHM7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX1RUTCA9IDUgKiA2MCAqIDEwMDA7IC8vIDUgbWludXRlc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgU1RBTEVfVFRMID0gMzAgKiA2MCAqIDEwMDA7IC8vIDMwIG1pbnV0ZXNcclxuXHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMubWVtb3J5Q2FjaGUgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLnN0YXRzID0ge1xyXG4gICAgICBoaXRzOiAwLFxyXG4gICAgICBtaXNzZXM6IDAsXHJcbiAgICAgIHN0YWxlOiAwLFxyXG4gICAgICBldmljdGlvbnM6IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFJ1biBjYWNoZSBjbGVhbnVwIGV2ZXJ5IG1pbnV0ZVxyXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5jbGVhbnVwRXhwaXJlZEVudHJpZXMoKSwgNjAgKiAxMDAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBzaW5nbGV0b24gaW5zdGFuY2VcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IEFuYWx5c2lzQ2FjaGVTZXJ2aWNlIHtcclxuICAgIGlmICghQW5hbHlzaXNDYWNoZVNlcnZpY2UuaW5zdGFuY2UpIHtcclxuICAgICAgQW5hbHlzaXNDYWNoZVNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgQW5hbHlzaXNDYWNoZVNlcnZpY2UoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBBbmFseXNpc0NhY2hlU2VydmljZS5pbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIGEgY2FjaGUga2V5IGZyb20gYSByZXF1ZXN0XHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZW5lcmF0ZUNhY2hlS2V5KHJlcXVlc3Q6IFByb3BBbmFseXNpc1JlcXVlc3QpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgeyBwcm9wSWQsIHBsYXllciwgdGVhbSwgc3BvcnQsIHN0YXRUeXBlLCBsaW5lIH0gPSByZXF1ZXN0O1xyXG4gICAgcmV0dXJuIGBwcm9wX2FuYWx5c2lzOiR7cHJvcElkfToke3BsYXllcn06JHt0ZWFtfToke3Nwb3J0fToke3N0YXRUeXBlfToke2xpbmV9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhbiBpdGVtIGZyb20gY2FjaGVcclxuICAgKiBSZXR1cm5zIG51bGwgaWYgbm90IGZvdW5kIG9yIGV4cGlyZWRcclxuICAgKiBSZXR1cm5zIHRoZSBpdGVtIHdpdGggaXNTdGFsZT10cnVlIGlmIGl0J3Mgc3RhbGUgYnV0IG5vdCBmdWxseSBleHBpcmVkXHJcbiAgICovXHJcbiAgcHVibGljIGdldChrZXk6IHN0cmluZyk6IFByb3BBbmFseXNpc1Jlc3BvbnNlIHwgbnVsbCB7XHJcbiAgICAvLyBVc2UgYSBjb25zaXN0ZW50IGtleSBmb3JtYXRcclxuICAgIGNvbnN0IGFjdHVhbEtleSA9IGtleS5zdGFydHNXaXRoKCdjYWNoZTonKSA/IGtleSA6IGBjYWNoZToke2tleX1gO1xyXG4gICAgY29uc3QgZW50cnkgPSB0aGlzLm1lbW9yeUNhY2hlLmdldChhY3R1YWxLZXkpO1xyXG5cclxuICAgIGlmICghZW50cnkpIHtcclxuICAgICAgdGhpcy5zdGF0cy5taXNzZXMrKztcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RnJvbUxvY2FsU3RvcmFnZShhY3R1YWxLZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICBjb25zdCBhZ2UgPSBub3cgLSBlbnRyeS50aW1lc3RhbXA7XHJcblxyXG4gICAgLy8gSWYgZnVsbHkgZXhwaXJlZFxyXG4gICAgaWYgKGFnZSA+PSBlbnRyeS50dGwgKyB0aGlzLlNUQUxFX1RUTCkge1xyXG4gICAgICB0aGlzLm1lbW9yeUNhY2hlLmRlbGV0ZShrZXkpO1xyXG4gICAgICB0aGlzLnN0YXRzLm1pc3NlcysrO1xyXG4gICAgICByZXR1cm4gdGhpcy5nZXRGcm9tTG9jYWxTdG9yYWdlKGtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgc3RhbGUgYnV0IG5vdCBmdWxseSBleHBpcmVkXHJcbiAgICBpZiAoYWdlID4gZW50cnkudHRsKSB7XHJcbiAgICAgIHRoaXMuc3RhdHMuc3RhbGUrKztcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5lbnRyeS52YWx1ZSxcclxuICAgICAgICBpc1N0YWxlOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZyZXNoIGhpdFxyXG4gICAgdGhpcy5zdGF0cy5oaXRzKys7XHJcbiAgICByZXR1cm4gZW50cnkudmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgYW4gaXRlbSBpbiBjYWNoZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBQcm9wQW5hbHlzaXNSZXNwb25zZSwgb3B0aW9ucz86IHsgdHRsPzogbnVtYmVyIH0pOiB2b2lkIHtcclxuICAgIGNvbnN0IHR0bCA9IG9wdGlvbnM/LnR0bCB8fCB0aGlzLkRFRkFVTFRfVFRMO1xyXG5cclxuICAgIC8vIFVzZSBhIGNvbnNpc3RlbnQga2V5IGZvcm1hdFxyXG4gICAgY29uc3QgYWN0dWFsS2V5ID0ga2V5LnN0YXJ0c1dpdGgoJ2NhY2hlOicpID8ga2V5IDogYGNhY2hlOiR7a2V5fWA7XHJcblxyXG4gICAgdGhpcy5tZW1vcnlDYWNoZS5zZXQoYWN0dWFsS2V5LCB7XHJcbiAgICAgIHZhbHVlLFxyXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXHJcbiAgICAgIHR0bCxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFsc28gc3RvcmUgaW4gbG9jYWxTdG9yYWdlIGlmIGF2YWlsYWJsZVxyXG4gICAgdGhpcy5zZXRJbkxvY2FsU3RvcmFnZShhY3R1YWxLZXksIHZhbHVlLCB0dGwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgYW4gaXRlbSBleGlzdHMgaW4gY2FjaGUgYW5kIGlzIG5vdCBleHBpcmVkXHJcbiAgICovXHJcbiAgcHVibGljIGhhcyhrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgLy8gVXNlIGEgY29uc2lzdGVudCBrZXkgZm9ybWF0XHJcbiAgICBjb25zdCBhY3R1YWxLZXkgPSBrZXkuc3RhcnRzV2l0aCgnY2FjaGU6JykgPyBrZXkgOiBgY2FjaGU6JHtrZXl9YDtcclxuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5tZW1vcnlDYWNoZS5nZXQoYWN0dWFsS2V5KTtcclxuXHJcbiAgICBpZiAoIWVudHJ5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmhhc0luTG9jYWxTdG9yYWdlKGFjdHVhbEtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuICAgIHJldHVybiBub3cgLSBlbnRyeS50aW1lc3RhbXAgPD0gZW50cnkudHRsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRlIGFuIGl0ZW0gZnJvbSBjYWNoZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZWxldGUoa2V5OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIC8vIFVzZSBhIGNvbnNpc3RlbnQga2V5IGZvcm1hdFxyXG4gICAgY29uc3QgYWN0dWFsS2V5ID0ga2V5LnN0YXJ0c1dpdGgoJ2NhY2hlOicpID8ga2V5IDogYGNhY2hlOiR7a2V5fWA7XHJcbiAgICB0aGlzLm1lbW9yeUNhY2hlLmRlbGV0ZShhY3R1YWxLZXkpO1xyXG4gICAgdGhpcy5kZWxldGVGcm9tTG9jYWxTdG9yYWdlKGFjdHVhbEtleSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciB0aGUgZW50aXJlIGNhY2hlXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyKCk6IHZvaWQge1xyXG4gICAgLy8gR2V0IGEgbGlzdCBvZiBhbGwga2V5cyB0byBleHBsaWNpdGx5IGRlbGV0ZSBlYWNoIG9uZVxyXG4gICAgLy8gVGhpcyBlbnN1cmVzIHdlIHByb3Blcmx5IGhhbmRsZSBwcmVmaXggY29uc2lzdGVuY3lcclxuICAgIGNvbnN0IGtleXNUb0RlbGV0ZSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5tZW1vcnlDYWNoZS5rZXlzKCkpIHtcclxuICAgICAga2V5c1RvRGVsZXRlLnB1c2goa2V5KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWxldGUgZWFjaCBrZXkgaW5kaXZpZHVhbGx5XHJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzVG9EZWxldGUpIHtcclxuICAgICAgdGhpcy5kZWxldGUoa2V5LnJlcGxhY2UoJ2NhY2hlOicsICcnKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWxzbyBjbGVhciB0aGUgbWVtb3J5IGNhY2hlIGFuZCBsb2NhbFN0b3JhZ2VcclxuICAgIHRoaXMubWVtb3J5Q2FjaGUuY2xlYXIoKTtcclxuICAgIHRoaXMuY2xlYXJMb2NhbFN0b3JhZ2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBjYWNoZSBzdGF0aXN0aWNzXHJcbiAgICovXHJcbiAgcHVibGljIGdldFN0YXRzKCk6IENhY2hlU3RhdHMge1xyXG4gICAgcmV0dXJuIHsgLi4udGhpcy5zdGF0cyB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xlYW4gdXAgZXhwaXJlZCBlbnRyaWVzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjbGVhbnVwRXhwaXJlZEVudHJpZXMoKTogdm9pZCB7XHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgbGV0IGV2aWN0aW9uQ291bnQgPSAwO1xyXG5cclxuICAgIGZvciAoY29uc3QgW2tleSwgZW50cnldIG9mIHRoaXMubWVtb3J5Q2FjaGUuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChub3cgLSBlbnRyeS50aW1lc3RhbXAgPiBlbnRyeS50dGwgKyB0aGlzLlNUQUxFX1RUTCkge1xyXG4gICAgICAgIHRoaXMubWVtb3J5Q2FjaGUuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgZXZpY3Rpb25Db3VudCsrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGV2aWN0aW9uQ291bnQgPiAwKSB7XHJcbiAgICAgIHRoaXMuc3RhdHMuZXZpY3Rpb25zICs9IGV2aWN0aW9uQ291bnQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYW4gaXRlbSBmcm9tIGxvY2FsU3RvcmFnZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RnJvbUxvY2FsU3RvcmFnZShrZXk6IHN0cmluZyk6IFByb3BBbmFseXNpc1Jlc3BvbnNlIHwgbnVsbCB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodHlwZW9mIGxvY2FsU3RvcmFnZSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgLy8gS2V5IHNob3VsZCBhbHJlYWR5IGJlIGluICdjYWNoZTonIGZvcm1hdFxyXG4gICAgICBjb25zdCBzdG9yZWRJdGVtID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgaWYgKCFzdG9yZWRJdGVtKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgIGNvbnN0IGVudHJ5ID0gSlNPTi5wYXJzZShzdG9yZWRJdGVtKSBhcyBDYWNoZUVudHJ5PFByb3BBbmFseXNpc1Jlc3BvbnNlPjtcclxuICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuICAgICAgY29uc3QgYWdlID0gbm93IC0gZW50cnkudGltZXN0YW1wO1xyXG5cclxuICAgICAgLy8gSWYgZnVsbHkgZXhwaXJlZFxyXG4gICAgICBpZiAoYWdlID49IGVudHJ5LnR0bCArIHRoaXMuU1RBTEVfVFRMKSB7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gSWYgc3RhbGUgYnV0IG5vdCBmdWxseSBleHBpcmVkXHJcbiAgICAgIGlmIChhZ2UgPiBlbnRyeS50dGwpIHtcclxuICAgICAgICB0aGlzLnN0YXRzLnN0YWxlKys7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIC4uLmVudHJ5LnZhbHVlLFxyXG4gICAgICAgICAgaXNTdGFsZTogdHJ1ZSxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBGcmVzaCBoaXQgZnJvbSBsb2NhbFN0b3JhZ2VcclxuICAgICAgdGhpcy5zdGF0cy5oaXRzKys7XHJcblxyXG4gICAgICAvLyBBbHNvIGFkZCB0byBtZW1vcnkgY2FjaGUgZm9yIGZhc3RlciBhY2Nlc3MgbmV4dCB0aW1lXHJcbiAgICAgIHRoaXMubWVtb3J5Q2FjaGUuc2V0KGtleSwgZW50cnkpO1xyXG5cclxuICAgICAgcmV0dXJuIGVudHJ5LnZhbHVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVhZGluZyBmcm9tIGxvY2FsU3RvcmFnZTonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IGFuIGl0ZW0gaW4gbG9jYWxTdG9yYWdlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRJbkxvY2FsU3RvcmFnZShrZXk6IHN0cmluZywgdmFsdWU6IFByb3BBbmFseXNpc1Jlc3BvbnNlLCB0dGw6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHR5cGVvZiBsb2NhbFN0b3JhZ2UgPT09ICd1bmRlZmluZWQnKSByZXR1cm47XHJcblxyXG4gICAgICBjb25zdCBlbnRyeTogQ2FjaGVFbnRyeTxQcm9wQW5hbHlzaXNSZXNwb25zZT4gPSB7XHJcbiAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICAgIHR0bCxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEtleSBzaG91bGQgYWxyZWFkeSBiZSBpbiAnY2FjaGU6JyBmb3JtYXRcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igd3JpdGluZyB0byBsb2NhbFN0b3JhZ2U6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgYW4gaXRlbSBleGlzdHMgaW4gbG9jYWxTdG9yYWdlIGFuZCBpcyBub3QgZXhwaXJlZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFzSW5Mb2NhbFN0b3JhZ2Uoa2V5OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0eXBlb2YgbG9jYWxTdG9yYWdlID09PSAndW5kZWZpbmVkJykgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgLy8gS2V5IHNob3VsZCBhbHJlYWR5IGJlIGluICdjYWNoZTonIGZvcm1hdFxyXG4gICAgICBjb25zdCBzdG9yZWRJdGVtID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgaWYgKCFzdG9yZWRJdGVtKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICBjb25zdCBlbnRyeSA9IEpTT04ucGFyc2Uoc3RvcmVkSXRlbSkgYXMgQ2FjaGVFbnRyeTxQcm9wQW5hbHlzaXNSZXNwb25zZT47XHJcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgIHJldHVybiBub3cgLSBlbnRyeS50aW1lc3RhbXAgPD0gZW50cnkudHRsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgbG9jYWxTdG9yYWdlOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRlIGFuIGl0ZW0gZnJvbSBsb2NhbFN0b3JhZ2VcclxuICAgKi9cclxuICBwcml2YXRlIGRlbGV0ZUZyb21Mb2NhbFN0b3JhZ2Uoa2V5OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0eXBlb2YgbG9jYWxTdG9yYWdlID09PSAndW5kZWZpbmVkJykgcmV0dXJuO1xyXG4gICAgICAvLyBLZXkgc2hvdWxkIGFscmVhZHkgYmUgaW4gJ2NhY2hlOicgZm9ybWF0XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBmcm9tIGxvY2FsU3RvcmFnZTonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciBhbGwgY2FjaGUgaXRlbXMgZnJvbSBsb2NhbFN0b3JhZ2VcclxuICAgKi9cclxuICBwcml2YXRlIGNsZWFyTG9jYWxTdG9yYWdlKCk6IHZvaWQge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHR5cGVvZiBsb2NhbFN0b3JhZ2UgPT09ICd1bmRlZmluZWQnKSByZXR1cm47XHJcblxyXG4gICAgICBjb25zdCBrZXlzVG9SZW1vdmU6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvY2FsU3RvcmFnZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7XHJcbiAgICAgICAgaWYgKGtleSAmJiBrZXkuc3RhcnRzV2l0aCgnY2FjaGU6JykpIHtcclxuICAgICAgICAgIGtleXNUb1JlbW92ZS5wdXNoKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBrZXlzVG9SZW1vdmUuZm9yRWFjaChrZXkgPT4gbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGVhcmluZyBsb2NhbFN0b3JhZ2UgY2FjaGU6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFlQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLE1BQU1BLG9CQUFvQixDQUFDO0VBS2E7O0VBRXJDQyxXQUFXQSxDQUFBLEVBQUc7SUFBQSxLQUxkQyxXQUFXO0lBQUEsS0FDWEMsS0FBSztJQUFBLEtBQ0lDLFdBQVcsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUk7SUFBRTtJQUFBLEtBQzdCQyxTQUFTLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJO0lBR3pDLElBQUksQ0FBQ0gsV0FBVyxHQUFHLElBQUlJLEdBQUcsQ0FBQyxDQUFDO0lBQzVCLElBQUksQ0FBQ0gsS0FBSyxHQUFHO01BQ1hJLElBQUksRUFBRSxDQUFDO01BQ1BDLE1BQU0sRUFBRSxDQUFDO01BQ1RDLEtBQUssRUFBRSxDQUFDO01BQ1JDLFNBQVMsRUFBRTtJQUNiLENBQUM7O0lBRUQ7SUFDQUMsV0FBVyxDQUFDLE1BQU0sSUFBSSxDQUFDQyxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQztFQUM1RDs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxPQUFjQyxXQUFXQSxDQUFBLEVBQXlCO0lBQ2hELElBQUksQ0FBQ2Isb0JBQW9CLENBQUNjLFFBQVEsRUFBRTtNQUNsQ2Qsb0JBQW9CLENBQUNjLFFBQVEsR0FBRyxJQUFJZCxvQkFBb0IsQ0FBQyxDQUFDO0lBQzVEO0lBQ0EsT0FBT0Esb0JBQW9CLENBQUNjLFFBQVE7RUFDdEM7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsT0FBY0MsZ0JBQWdCQSxDQUFDQyxPQUE0QixFQUFVO0lBQ25FLE1BQU07TUFBRUMsTUFBTTtNQUFFQyxNQUFNO01BQUVDLElBQUk7TUFBRUMsS0FBSztNQUFFQyxRQUFRO01BQUVDO0lBQUssQ0FBQyxHQUFHTixPQUFPO0lBQy9ELE9BQU8saUJBQWlCQyxNQUFNLElBQUlDLE1BQU0sSUFBSUMsSUFBSSxJQUFJQyxLQUFLLElBQUlDLFFBQVEsSUFBSUMsSUFBSSxFQUFFO0VBQ2pGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDU0MsR0FBR0EsQ0FBQ0MsR0FBVyxFQUErQjtJQUNuRDtJQUNBLE1BQU1DLFNBQVMsR0FBR0QsR0FBRyxDQUFDRSxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUdGLEdBQUcsR0FBRyxTQUFTQSxHQUFHLEVBQUU7SUFDakUsTUFBTUcsS0FBSyxHQUFHLElBQUksQ0FBQ3pCLFdBQVcsQ0FBQ3FCLEdBQUcsQ0FBQ0UsU0FBUyxDQUFDO0lBRTdDLElBQUksQ0FBQ0UsS0FBSyxFQUFFO01BQ1YsSUFBSSxDQUFDeEIsS0FBSyxDQUFDSyxNQUFNLEVBQUU7TUFDbkIsT0FBTyxJQUFJLENBQUNvQixtQkFBbUIsQ0FBQ0gsU0FBUyxDQUFDO0lBQzVDO0lBRUEsTUFBTUksR0FBRyxHQUFHQyxJQUFJLENBQUNELEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLE1BQU1FLEdBQUcsR0FBR0YsR0FBRyxHQUFHRixLQUFLLENBQUNLLFNBQVM7O0lBRWpDO0lBQ0EsSUFBSUQsR0FBRyxJQUFJSixLQUFLLENBQUNNLEdBQUcsR0FBRyxJQUFJLENBQUM1QixTQUFTLEVBQUU7TUFDckMsSUFBSSxDQUFDSCxXQUFXLENBQUNnQyxNQUFNLENBQUNWLEdBQUcsQ0FBQztNQUM1QixJQUFJLENBQUNyQixLQUFLLENBQUNLLE1BQU0sRUFBRTtNQUNuQixPQUFPLElBQUksQ0FBQ29CLG1CQUFtQixDQUFDSixHQUFHLENBQUM7SUFDdEM7O0lBRUE7SUFDQSxJQUFJTyxHQUFHLEdBQUdKLEtBQUssQ0FBQ00sR0FBRyxFQUFFO01BQ25CLElBQUksQ0FBQzlCLEtBQUssQ0FBQ00sS0FBSyxFQUFFO01BQ2xCLE9BQU87UUFDTCxHQUFHa0IsS0FBSyxDQUFDUSxLQUFLO1FBQ2RDLE9BQU8sRUFBRTtNQUNYLENBQUM7SUFDSDs7SUFFQTtJQUNBLElBQUksQ0FBQ2pDLEtBQUssQ0FBQ0ksSUFBSSxFQUFFO0lBQ2pCLE9BQU9vQixLQUFLLENBQUNRLEtBQUs7RUFDcEI7O0VBRUE7QUFDRjtBQUNBO0VBQ1NFLEdBQUdBLENBQUNiLEdBQVcsRUFBRVcsS0FBMkIsRUFBRUcsT0FBMEIsRUFBUTtJQUNyRixNQUFNTCxHQUFHLEdBQUdLLE9BQU8sRUFBRUwsR0FBRyxJQUFJLElBQUksQ0FBQzdCLFdBQVc7O0lBRTVDO0lBQ0EsTUFBTXFCLFNBQVMsR0FBR0QsR0FBRyxDQUFDRSxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUdGLEdBQUcsR0FBRyxTQUFTQSxHQUFHLEVBQUU7SUFFakUsSUFBSSxDQUFDdEIsV0FBVyxDQUFDbUMsR0FBRyxDQUFDWixTQUFTLEVBQUU7TUFDOUJVLEtBQUs7TUFDTEgsU0FBUyxFQUFFRixJQUFJLENBQUNELEdBQUcsQ0FBQyxDQUFDO01BQ3JCSTtJQUNGLENBQUMsQ0FBQzs7SUFFRjtJQUNBLElBQUksQ0FBQ00saUJBQWlCLENBQUNkLFNBQVMsRUFBRVUsS0FBSyxFQUFFRixHQUFHLENBQUM7RUFDL0M7O0VBRUE7QUFDRjtBQUNBO0VBQ1NPLEdBQUdBLENBQUNoQixHQUFXLEVBQVc7SUFDL0I7SUFDQSxNQUFNQyxTQUFTLEdBQUdELEdBQUcsQ0FBQ0UsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHRixHQUFHLEdBQUcsU0FBU0EsR0FBRyxFQUFFO0lBQ2pFLE1BQU1HLEtBQUssR0FBRyxJQUFJLENBQUN6QixXQUFXLENBQUNxQixHQUFHLENBQUNFLFNBQVMsQ0FBQztJQUU3QyxJQUFJLENBQUNFLEtBQUssRUFBRTtNQUNWLE9BQU8sSUFBSSxDQUFDYyxpQkFBaUIsQ0FBQ2hCLFNBQVMsQ0FBQztJQUMxQztJQUVBLE1BQU1JLEdBQUcsR0FBR0MsSUFBSSxDQUFDRCxHQUFHLENBQUMsQ0FBQztJQUN0QixPQUFPQSxHQUFHLEdBQUdGLEtBQUssQ0FBQ0ssU0FBUyxJQUFJTCxLQUFLLENBQUNNLEdBQUc7RUFDM0M7O0VBRUE7QUFDRjtBQUNBO0VBQ1NDLE1BQU1BLENBQUNWLEdBQVcsRUFBUTtJQUMvQjtJQUNBLE1BQU1DLFNBQVMsR0FBR0QsR0FBRyxDQUFDRSxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUdGLEdBQUcsR0FBRyxTQUFTQSxHQUFHLEVBQUU7SUFDakUsSUFBSSxDQUFDdEIsV0FBVyxDQUFDZ0MsTUFBTSxDQUFDVCxTQUFTLENBQUM7SUFDbEMsSUFBSSxDQUFDaUIsc0JBQXNCLENBQUNqQixTQUFTLENBQUM7RUFDeEM7O0VBRUE7QUFDRjtBQUNBO0VBQ1NrQixLQUFLQSxDQUFBLEVBQVM7SUFDbkI7SUFDQTtJQUNBLE1BQU1DLFlBQVksR0FBRyxFQUFFO0lBQ3ZCLEtBQUssTUFBTXBCLEdBQUcsSUFBSSxJQUFJLENBQUN0QixXQUFXLENBQUMyQyxJQUFJLENBQUMsQ0FBQyxFQUFFO01BQ3pDRCxZQUFZLENBQUNFLElBQUksQ0FBQ3RCLEdBQUcsQ0FBQztJQUN4Qjs7SUFFQTtJQUNBLEtBQUssTUFBTUEsR0FBRyxJQUFJb0IsWUFBWSxFQUFFO01BQzlCLElBQUksQ0FBQ1YsTUFBTSxDQUFDVixHQUFHLENBQUN1QixPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3hDOztJQUVBO0lBQ0EsSUFBSSxDQUFDN0MsV0FBVyxDQUFDeUMsS0FBSyxDQUFDLENBQUM7SUFDeEIsSUFBSSxDQUFDSyxpQkFBaUIsQ0FBQyxDQUFDO0VBQzFCOztFQUVBO0FBQ0Y7QUFDQTtFQUNTQyxRQUFRQSxDQUFBLEVBQWU7SUFDNUIsT0FBTztNQUFFLEdBQUcsSUFBSSxDQUFDOUM7SUFBTSxDQUFDO0VBQzFCOztFQUVBO0FBQ0Y7QUFDQTtFQUNVUyxxQkFBcUJBLENBQUEsRUFBUztJQUNwQyxNQUFNaUIsR0FBRyxHQUFHQyxJQUFJLENBQUNELEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLElBQUlxQixhQUFhLEdBQUcsQ0FBQztJQUVyQixLQUFLLE1BQU0sQ0FBQzFCLEdBQUcsRUFBRUcsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDekIsV0FBVyxDQUFDaUQsT0FBTyxDQUFDLENBQUMsRUFBRTtNQUNyRCxJQUFJdEIsR0FBRyxHQUFHRixLQUFLLENBQUNLLFNBQVMsR0FBR0wsS0FBSyxDQUFDTSxHQUFHLEdBQUcsSUFBSSxDQUFDNUIsU0FBUyxFQUFFO1FBQ3RELElBQUksQ0FBQ0gsV0FBVyxDQUFDZ0MsTUFBTSxDQUFDVixHQUFHLENBQUM7UUFDNUIwQixhQUFhLEVBQUU7TUFDakI7SUFDRjtJQUVBLElBQUlBLGFBQWEsR0FBRyxDQUFDLEVBQUU7TUFDckIsSUFBSSxDQUFDL0MsS0FBSyxDQUFDTyxTQUFTLElBQUl3QyxhQUFhO0lBQ3ZDO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0VBQ1V0QixtQkFBbUJBLENBQUNKLEdBQVcsRUFBK0I7SUFDcEUsSUFBSTtNQUNGLElBQUksT0FBTzRCLFlBQVksS0FBSyxXQUFXLEVBQUUsT0FBTyxJQUFJOztNQUVwRDtNQUNBLE1BQU1DLFVBQVUsR0FBR0QsWUFBWSxDQUFDRSxPQUFPLENBQUM5QixHQUFHLENBQUM7TUFDNUMsSUFBSSxDQUFDNkIsVUFBVSxFQUFFLE9BQU8sSUFBSTtNQUU1QixNQUFNMUIsS0FBSyxHQUFHNEIsSUFBSSxDQUFDQyxLQUFLLENBQUNILFVBQVUsQ0FBcUM7TUFDeEUsTUFBTXhCLEdBQUcsR0FBR0MsSUFBSSxDQUFDRCxHQUFHLENBQUMsQ0FBQztNQUN0QixNQUFNRSxHQUFHLEdBQUdGLEdBQUcsR0FBR0YsS0FBSyxDQUFDSyxTQUFTOztNQUVqQztNQUNBLElBQUlELEdBQUcsSUFBSUosS0FBSyxDQUFDTSxHQUFHLEdBQUcsSUFBSSxDQUFDNUIsU0FBUyxFQUFFO1FBQ3JDK0MsWUFBWSxDQUFDSyxVQUFVLENBQUNqQyxHQUFHLENBQUM7UUFDNUIsT0FBTyxJQUFJO01BQ2I7O01BRUE7TUFDQSxJQUFJTyxHQUFHLEdBQUdKLEtBQUssQ0FBQ00sR0FBRyxFQUFFO1FBQ25CLElBQUksQ0FBQzlCLEtBQUssQ0FBQ00sS0FBSyxFQUFFO1FBQ2xCLE9BQU87VUFDTCxHQUFHa0IsS0FBSyxDQUFDUSxLQUFLO1VBQ2RDLE9BQU8sRUFBRTtRQUNYLENBQUM7TUFDSDs7TUFFQTtNQUNBLElBQUksQ0FBQ2pDLEtBQUssQ0FBQ0ksSUFBSSxFQUFFOztNQUVqQjtNQUNBLElBQUksQ0FBQ0wsV0FBVyxDQUFDbUMsR0FBRyxDQUFDYixHQUFHLEVBQUVHLEtBQUssQ0FBQztNQUVoQyxPQUFPQSxLQUFLLENBQUNRLEtBQUs7SUFDcEIsQ0FBQyxDQUFDLE9BQU91QixLQUFLLEVBQUU7TUFDZEMsT0FBTyxDQUFDRCxLQUFLLENBQUMsa0NBQWtDLEVBQUVBLEtBQUssQ0FBQztNQUN4RCxPQUFPLElBQUk7SUFDYjtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtFQUNVbkIsaUJBQWlCQSxDQUFDZixHQUFXLEVBQUVXLEtBQTJCLEVBQUVGLEdBQVcsRUFBUTtJQUNyRixJQUFJO01BQ0YsSUFBSSxPQUFPbUIsWUFBWSxLQUFLLFdBQVcsRUFBRTtNQUV6QyxNQUFNekIsS0FBdUMsR0FBRztRQUM5Q1EsS0FBSztRQUNMSCxTQUFTLEVBQUVGLElBQUksQ0FBQ0QsR0FBRyxDQUFDLENBQUM7UUFDckJJO01BQ0YsQ0FBQzs7TUFFRDtNQUNBbUIsWUFBWSxDQUFDUSxPQUFPLENBQUNwQyxHQUFHLEVBQUUrQixJQUFJLENBQUNNLFNBQVMsQ0FBQ2xDLEtBQUssQ0FBQyxDQUFDO0lBQ2xELENBQUMsQ0FBQyxPQUFPK0IsS0FBSyxFQUFFO01BQ2RDLE9BQU8sQ0FBQ0QsS0FBSyxDQUFDLGdDQUFnQyxFQUFFQSxLQUFLLENBQUM7SUFDeEQ7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDVWpCLGlCQUFpQkEsQ0FBQ2pCLEdBQVcsRUFBVztJQUM5QyxJQUFJO01BQ0YsSUFBSSxPQUFPNEIsWUFBWSxLQUFLLFdBQVcsRUFBRSxPQUFPLEtBQUs7O01BRXJEO01BQ0EsTUFBTUMsVUFBVSxHQUFHRCxZQUFZLENBQUNFLE9BQU8sQ0FBQzlCLEdBQUcsQ0FBQztNQUM1QyxJQUFJLENBQUM2QixVQUFVLEVBQUUsT0FBTyxLQUFLO01BRTdCLE1BQU0xQixLQUFLLEdBQUc0QixJQUFJLENBQUNDLEtBQUssQ0FBQ0gsVUFBVSxDQUFxQztNQUN4RSxNQUFNeEIsR0FBRyxHQUFHQyxJQUFJLENBQUNELEdBQUcsQ0FBQyxDQUFDO01BQ3RCLE9BQU9BLEdBQUcsR0FBR0YsS0FBSyxDQUFDSyxTQUFTLElBQUlMLEtBQUssQ0FBQ00sR0FBRztJQUMzQyxDQUFDLENBQUMsT0FBT3lCLEtBQUssRUFBRTtNQUNkQyxPQUFPLENBQUNELEtBQUssQ0FBQyw4QkFBOEIsRUFBRUEsS0FBSyxDQUFDO01BQ3BELE9BQU8sS0FBSztJQUNkO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0VBQ1VoQixzQkFBc0JBLENBQUNsQixHQUFXLEVBQVE7SUFDaEQsSUFBSTtNQUNGLElBQUksT0FBTzRCLFlBQVksS0FBSyxXQUFXLEVBQUU7TUFDekM7TUFDQUEsWUFBWSxDQUFDSyxVQUFVLENBQUNqQyxHQUFHLENBQUM7SUFDOUIsQ0FBQyxDQUFDLE9BQU9rQyxLQUFLLEVBQUU7TUFDZEMsT0FBTyxDQUFDRCxLQUFLLENBQUMsbUNBQW1DLEVBQUVBLEtBQUssQ0FBQztJQUMzRDtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtFQUNVVixpQkFBaUJBLENBQUEsRUFBUztJQUNoQyxJQUFJO01BQ0YsSUFBSSxPQUFPSSxZQUFZLEtBQUssV0FBVyxFQUFFO01BRXpDLE1BQU1VLFlBQXNCLEdBQUcsRUFBRTtNQUVqQyxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR1gsWUFBWSxDQUFDWSxNQUFNLEVBQUVELENBQUMsRUFBRSxFQUFFO1FBQzVDLE1BQU12QyxHQUFHLEdBQUc0QixZQUFZLENBQUM1QixHQUFHLENBQUN1QyxDQUFDLENBQUM7UUFDL0IsSUFBSXZDLEdBQUcsSUFBSUEsR0FBRyxDQUFDRSxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7VUFDbkNvQyxZQUFZLENBQUNoQixJQUFJLENBQUN0QixHQUFHLENBQUM7UUFDeEI7TUFDRjtNQUVBc0MsWUFBWSxDQUFDRyxPQUFPLENBQUN6QyxHQUFHLElBQUk0QixZQUFZLENBQUNLLFVBQVUsQ0FBQ2pDLEdBQUcsQ0FBQyxDQUFDO0lBQzNELENBQUMsQ0FBQyxPQUFPa0MsS0FBSyxFQUFFO01BQ2RDLE9BQU8sQ0FBQ0QsS0FBSyxDQUFDLG9DQUFvQyxFQUFFQSxLQUFLLENBQUM7SUFDNUQ7RUFDRjtBQUNGO0FBQUNRLE9BQUEsQ0FBQWxFLG9CQUFBLEdBQUFBLG9CQUFBO0FBQUFtRSxxQkFBQSxHQTlSWW5FLG9CQUFvQjtBQUFwQkEsb0JBQW9CLENBQ2hCYyxRQUFRIiwiaWdub3JlTGlzdCI6W119