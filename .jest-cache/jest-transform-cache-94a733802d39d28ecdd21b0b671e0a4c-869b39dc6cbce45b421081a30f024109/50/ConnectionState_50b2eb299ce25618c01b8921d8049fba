470d7b84b5dec1514c45038bd79e9281
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getFailureDescription = exports.classifyFailure = void 0;
/**
 * WebSocket Connection States
 * 
 * Defines the connection state machine and related types for WebSocket management.
 */

// Gave up reconnecting, using local mode

// Custom: Server handshake error

// Unclassified error

const classifyFailure = (closeCode, error) => {
  // Classify based on close code first
  if (closeCode) {
    switch (closeCode) {
      case 4400:
      case 4401:
        return 'handshake';
      case 4500:
      case 1011:
        return 'server_error';
      case 1006:
        return 'abnormal';
      case 1000:
      case 1001:
        return 'network';
      // Normal closures during connection issues
      default:
        return 'unknown';
    }
  }

  // Classify based on error message
  if (error) {
    const message = error instanceof Error ? error.message.toLowerCase() : error.toString().toLowerCase();
    if (message.includes('network') || message.includes('connection refused') || message.includes('dns') || message.includes('host not found')) {
      return 'network';
    }
    if (message.includes('timeout')) {
      return 'timeout';
    }
    if (message.includes('handshake') || message.includes('upgrade') || message.includes('version')) {
      return 'handshake';
    }
    if (message.includes('server error') || message.includes('internal error')) {
      return 'server_error';
    }
  }
  return 'unknown';
};
exports.classifyFailure = classifyFailure;
const getFailureDescription = classification => {
  switch (classification) {
    case 'network':
      return 'Network connectivity issue (DNS, connection refused, etc.)';
    case 'handshake':
      return 'WebSocket handshake rejected (version mismatch, invalid params)';
    case 'server_error':
      return 'Server internal error during connection';
    case 'abnormal':
      return 'Connection closed unexpectedly (no close frame received)';
    case 'timeout':
      return 'Connection or heartbeat timeout';
    case 'unknown':
    default:
      return 'Unknown connection failure';
  }
};
exports.getFailureDescription = getFailureDescription;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjbGFzc2lmeUZhaWx1cmUiLCJjbG9zZUNvZGUiLCJlcnJvciIsIm1lc3NhZ2UiLCJFcnJvciIsInRvTG93ZXJDYXNlIiwidG9TdHJpbmciLCJpbmNsdWRlcyIsImV4cG9ydHMiLCJnZXRGYWlsdXJlRGVzY3JpcHRpb24iLCJjbGFzc2lmaWNhdGlvbiJdLCJzb3VyY2VzIjpbIkNvbm5lY3Rpb25TdGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogV2ViU29ja2V0IENvbm5lY3Rpb24gU3RhdGVzXHJcbiAqIFxyXG4gKiBEZWZpbmVzIHRoZSBjb25uZWN0aW9uIHN0YXRlIG1hY2hpbmUgYW5kIHJlbGF0ZWQgdHlwZXMgZm9yIFdlYlNvY2tldCBtYW5hZ2VtZW50LlxyXG4gKi9cclxuXHJcbmV4cG9ydCB0eXBlIFdTQ29ubmVjdGlvblBoYXNlID1cclxuICB8ICdpZGxlJyAgICAgICAgICAgLy8gTm90IGNvbm5lY3RlZCwgbm8gYXR0ZW1wdHMgbWFkZVxyXG4gIHwgJ2Nvbm5lY3RpbmcnICAgICAvLyBJbml0aWFsIGNvbm5lY3Rpb24gYXR0ZW1wdFxyXG4gIHwgJ29wZW4nICAgICAgICAgICAvLyBTdWNjZXNzZnVsbHkgY29ubmVjdGVkIGFuZCBvcGVyYXRpb25hbFxyXG4gIHwgJ2RlZ3JhZGVkJyAgICAgICAvLyBDb25uZWN0ZWQgYnV0IHdpdGggcmVkdWNlZCBmdW5jdGlvbmFsaXR5XHJcbiAgfCAncmVjb25uZWN0aW5nJyAgIC8vIEF0dGVtcHRpbmcgdG8gcmVjb25uZWN0IGFmdGVyIGZhaWx1cmVcclxuICB8ICdmYWlsZWQnICAgICAgICAgLy8gQ29ubmVjdGlvbiBmYWlsZWQsIHN0aWxsIHJldHJ5aW5nXHJcbiAgfCAnZmFsbGJhY2snOyAgICAgIC8vIEdhdmUgdXAgcmVjb25uZWN0aW5nLCB1c2luZyBsb2NhbCBtb2RlXHJcblxyXG5leHBvcnQgdHlwZSBXU0Nsb3NlQ29kZSA9IFxyXG4gIHwgMTAwMCAgLy8gTm9ybWFsIGNsb3N1cmVcclxuICB8IDEwMDEgIC8vIEdvaW5nIGF3YXlcclxuICB8IDEwMDIgIC8vIFByb3RvY29sIGVycm9yXHJcbiAgfCAxMDAzICAvLyBVbnN1cHBvcnRlZCBkYXRhXHJcbiAgfCAxMDA2ICAvLyBBYm5vcm1hbCBjbG9zdXJlIChubyBjbG9zZSBmcmFtZSlcclxuICB8IDEwMTEgIC8vIFNlcnZlciBlcnJvclxyXG4gIHwgNDQwMCAgLy8gQ3VzdG9tOiBVbnN1cHBvcnRlZCB2ZXJzaW9uXHJcbiAgfCA0NDAxICAvLyBDdXN0b206IEludmFsaWQgcm9sZVxyXG4gIHwgNDUwMDsgLy8gQ3VzdG9tOiBTZXJ2ZXIgaGFuZHNoYWtlIGVycm9yXHJcblxyXG5leHBvcnQgdHlwZSBXU0ZhaWx1cmVDbGFzc2lmaWNhdGlvbiA9XHJcbiAgfCAnbmV0d29yaycgICAgICAgLy8gRE5TLCBjb25uZWN0aW9uIHJlZnVzZWQsIG5ldHdvcmsgaXNzdWVzXHJcbiAgfCAnaGFuZHNoYWtlJyAgICAgLy8gNHh4IHJlc3BvbnNlcywgdmVyc2lvbiBtaXNtYXRjaFxyXG4gIHwgJ3NlcnZlcl9lcnJvcicgIC8vIDV4eCByZXNwb25zZXMsIHNlcnZlci1zaWRlIGlzc3VlcyAgXHJcbiAgfCAnYWJub3JtYWwnICAgICAgLy8gMTAwNiwgdW5leHBlY3RlZCBjbG9zdXJlXHJcbiAgfCAndGltZW91dCcgICAgICAgLy8gQ29ubmVjdGlvbiBvciBwaW5nIHRpbWVvdXRcclxuICB8ICd1bmtub3duJzsgICAgICAvLyBVbmNsYXNzaWZpZWQgZXJyb3JcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgV1NDb25uZWN0aW9uQXR0ZW1wdCB7XHJcbiAgYXR0ZW1wdDogbnVtYmVyO1xyXG4gIHRpbWVzdGFtcDogRGF0ZTtcclxuICBkdXJhdGlvbl9tcz86IG51bWJlcjtcclxuICBjbG9zZV9jb2RlPzogV1NDbG9zZUNvZGU7XHJcbiAgY2xvc2VfcmVhc29uPzogc3RyaW5nO1xyXG4gIGNsYXNzaWZpY2F0aW9uOiBXU0ZhaWx1cmVDbGFzc2lmaWNhdGlvbjtcclxuICBuZXh0X3JldHJ5X2V0YT86IERhdGU7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgV1NDb25uZWN0aW9uU3RhdHMge1xyXG4gIHRvdGFsX2F0dGVtcHRzOiBudW1iZXI7XHJcbiAgc3VjY2Vzc2Z1bF9jb25uZWN0aW9uczogbnVtYmVyO1xyXG4gIGN1cnJlbnRfdXB0aW1lX21zOiBudW1iZXI7XHJcbiAgbWVzc2FnZXNfcmVjZWl2ZWQ6IG51bWJlcjtcclxuICBtZXNzYWdlc19zZW50OiBudW1iZXI7XHJcbiAgaGVhcnRiZWF0c19yZWNlaXZlZDogbnVtYmVyO1xyXG4gIGhlYXJ0YmVhdHNfc2VudDogbnVtYmVyO1xyXG4gIGxhc3RfYWN0aXZpdHk6IERhdGUgfCBudWxsO1xyXG4gIGNvbm5lY3Rpb25fc3RhcnQ6IERhdGUgfCBudWxsO1xyXG4gIG1lc3NhZ2VfY291bnRzX2J5X3R5cGU6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgV1NIZWxsb01lc3NhZ2UgZXh0ZW5kcyBXU01lc3NhZ2Uge1xyXG4gIHR5cGU6ICdoZWxsbyc7XHJcbiAgc2VydmVyX3RpbWU6IHN0cmluZztcclxuICBhY2NlcHRlZF92ZXJzaW9uOiBudW1iZXI7XHJcbiAgZmVhdHVyZXM6IHN0cmluZ1tdO1xyXG4gIHJlcXVlc3RfaWQ6IHN0cmluZztcclxuICBjbGllbnRfaWQ6IHN0cmluZztcclxuICBoZWFydGJlYXRfaW50ZXJ2YWxfbXM6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBXU1N0YXRlIHtcclxuICBwaGFzZTogV1NDb25uZWN0aW9uUGhhc2U7XHJcbiAgY2xpZW50X2lkOiBzdHJpbmc7XHJcbiAgdXJsOiBzdHJpbmc7XHJcbiAgc3RhdHM6IFdTQ29ubmVjdGlvblN0YXRzO1xyXG4gIGN1cnJlbnRfYXR0ZW1wdDogV1NDb25uZWN0aW9uQXR0ZW1wdCB8IG51bGw7XHJcbiAgcmVjZW50X2F0dGVtcHRzOiBXU0Nvbm5lY3Rpb25BdHRlbXB0W107XHJcbiAgZmFsbGJhY2tfcmVhc29uOiBzdHJpbmcgfCBudWxsO1xyXG4gIGxhc3RfaGVsbG9fbWVzc2FnZTogV1NIZWxsb01lc3NhZ2UgfCBudWxsO1xyXG4gIGNvbm5lY3Rpb25fZmVhdHVyZXM6IHN0cmluZ1tdO1xyXG4gIGlzX2ZhbGxiYWNrX21vZGU6IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgV1NNZXNzYWdlIHtcclxuICB0eXBlOiBzdHJpbmc7XHJcbiAgdGltZXN0YW1wOiBzdHJpbmc7XHJcbiAgW2tleTogc3RyaW5nXTogdW5rbm93bjtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNsYXNzaWZ5RmFpbHVyZSA9IChcclxuICBjbG9zZUNvZGU/OiBXU0Nsb3NlQ29kZSwgXHJcbiAgZXJyb3I/OiBFcnJvciB8IEV2ZW50XHJcbik6IFdTRmFpbHVyZUNsYXNzaWZpY2F0aW9uID0+IHtcclxuICAvLyBDbGFzc2lmeSBiYXNlZCBvbiBjbG9zZSBjb2RlIGZpcnN0XHJcbiAgaWYgKGNsb3NlQ29kZSkge1xyXG4gICAgc3dpdGNoIChjbG9zZUNvZGUpIHtcclxuICAgICAgY2FzZSA0NDAwOlxyXG4gICAgICBjYXNlIDQ0MDE6XHJcbiAgICAgICAgcmV0dXJuICdoYW5kc2hha2UnO1xyXG4gICAgICBjYXNlIDQ1MDA6XHJcbiAgICAgIGNhc2UgMTAxMTpcclxuICAgICAgICByZXR1cm4gJ3NlcnZlcl9lcnJvcic7XHJcbiAgICAgIGNhc2UgMTAwNjpcclxuICAgICAgICByZXR1cm4gJ2Fibm9ybWFsJztcclxuICAgICAgY2FzZSAxMDAwOlxyXG4gICAgICBjYXNlIDEwMDE6XHJcbiAgICAgICAgcmV0dXJuICduZXR3b3JrJzsgLy8gTm9ybWFsIGNsb3N1cmVzIGR1cmluZyBjb25uZWN0aW9uIGlzc3Vlc1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiAndW5rbm93bic7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIC8vIENsYXNzaWZ5IGJhc2VkIG9uIGVycm9yIG1lc3NhZ2VcclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yIFxyXG4gICAgICA/IGVycm9yLm1lc3NhZ2UudG9Mb3dlckNhc2UoKVxyXG4gICAgICA6IGVycm9yLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcclxuICAgIFxyXG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ25ldHdvcmsnKSB8fCBcclxuICAgICAgICBtZXNzYWdlLmluY2x1ZGVzKCdjb25uZWN0aW9uIHJlZnVzZWQnKSB8fFxyXG4gICAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ2RucycpIHx8XHJcbiAgICAgICAgbWVzc2FnZS5pbmNsdWRlcygnaG9zdCBub3QgZm91bmQnKSkge1xyXG4gICAgICByZXR1cm4gJ25ldHdvcmsnO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAobWVzc2FnZS5pbmNsdWRlcygndGltZW91dCcpKSB7XHJcbiAgICAgIHJldHVybiAndGltZW91dCc7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdoYW5kc2hha2UnKSB8fCBcclxuICAgICAgICBtZXNzYWdlLmluY2x1ZGVzKCd1cGdyYWRlJykgfHxcclxuICAgICAgICBtZXNzYWdlLmluY2x1ZGVzKCd2ZXJzaW9uJykpIHtcclxuICAgICAgcmV0dXJuICdoYW5kc2hha2UnO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAobWVzc2FnZS5pbmNsdWRlcygnc2VydmVyIGVycm9yJykgfHwgXHJcbiAgICAgICAgbWVzc2FnZS5pbmNsdWRlcygnaW50ZXJuYWwgZXJyb3InKSkge1xyXG4gICAgICByZXR1cm4gJ3NlcnZlcl9lcnJvcic7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiAndW5rbm93bic7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0RmFpbHVyZURlc2NyaXB0aW9uID0gKGNsYXNzaWZpY2F0aW9uOiBXU0ZhaWx1cmVDbGFzc2lmaWNhdGlvbik6IHN0cmluZyA9PiB7XHJcbiAgc3dpdGNoIChjbGFzc2lmaWNhdGlvbikge1xyXG4gICAgY2FzZSAnbmV0d29yayc6XHJcbiAgICAgIHJldHVybiAnTmV0d29yayBjb25uZWN0aXZpdHkgaXNzdWUgKEROUywgY29ubmVjdGlvbiByZWZ1c2VkLCBldGMuKSc7XHJcbiAgICBjYXNlICdoYW5kc2hha2UnOlxyXG4gICAgICByZXR1cm4gJ1dlYlNvY2tldCBoYW5kc2hha2UgcmVqZWN0ZWQgKHZlcnNpb24gbWlzbWF0Y2gsIGludmFsaWQgcGFyYW1zKSc7XHJcbiAgICBjYXNlICdzZXJ2ZXJfZXJyb3InOlxyXG4gICAgICByZXR1cm4gJ1NlcnZlciBpbnRlcm5hbCBlcnJvciBkdXJpbmcgY29ubmVjdGlvbic7XHJcbiAgICBjYXNlICdhYm5vcm1hbCc6XHJcbiAgICAgIHJldHVybiAnQ29ubmVjdGlvbiBjbG9zZWQgdW5leHBlY3RlZGx5IChubyBjbG9zZSBmcmFtZSByZWNlaXZlZCknO1xyXG4gICAgY2FzZSAndGltZW91dCc6XHJcbiAgICAgIHJldHVybiAnQ29ubmVjdGlvbiBvciBoZWFydGJlYXQgdGltZW91dCc7XHJcbiAgICBjYXNlICd1bmtub3duJzpcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiAnVW5rbm93biBjb25uZWN0aW9uIGZhaWx1cmUnO1xyXG4gIH1cclxufTsiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBU3FCOztBQVdYOztBQVFVOztBQXNEYixNQUFNQSxlQUFlLEdBQUdBLENBQzdCQyxTQUF1QixFQUN2QkMsS0FBcUIsS0FDTztFQUM1QjtFQUNBLElBQUlELFNBQVMsRUFBRTtJQUNiLFFBQVFBLFNBQVM7TUFDZixLQUFLLElBQUk7TUFDVCxLQUFLLElBQUk7UUFDUCxPQUFPLFdBQVc7TUFDcEIsS0FBSyxJQUFJO01BQ1QsS0FBSyxJQUFJO1FBQ1AsT0FBTyxjQUFjO01BQ3ZCLEtBQUssSUFBSTtRQUNQLE9BQU8sVUFBVTtNQUNuQixLQUFLLElBQUk7TUFDVCxLQUFLLElBQUk7UUFDUCxPQUFPLFNBQVM7TUFBRTtNQUNwQjtRQUNFLE9BQU8sU0FBUztJQUNwQjtFQUNGOztFQUVBO0VBQ0EsSUFBSUMsS0FBSyxFQUFFO0lBQ1QsTUFBTUMsT0FBTyxHQUFHRCxLQUFLLFlBQVlFLEtBQUssR0FDbENGLEtBQUssQ0FBQ0MsT0FBTyxDQUFDRSxXQUFXLENBQUMsQ0FBQyxHQUMzQkgsS0FBSyxDQUFDSSxRQUFRLENBQUMsQ0FBQyxDQUFDRCxXQUFXLENBQUMsQ0FBQztJQUVsQyxJQUFJRixPQUFPLENBQUNJLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFDM0JKLE9BQU8sQ0FBQ0ksUUFBUSxDQUFDLG9CQUFvQixDQUFDLElBQ3RDSixPQUFPLENBQUNJLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFDdkJKLE9BQU8sQ0FBQ0ksUUFBUSxDQUFDLGdCQUFnQixDQUFDLEVBQUU7TUFDdEMsT0FBTyxTQUFTO0lBQ2xCO0lBRUEsSUFBSUosT0FBTyxDQUFDSSxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUU7TUFDL0IsT0FBTyxTQUFTO0lBQ2xCO0lBRUEsSUFBSUosT0FBTyxDQUFDSSxRQUFRLENBQUMsV0FBVyxDQUFDLElBQzdCSixPQUFPLENBQUNJLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFDM0JKLE9BQU8sQ0FBQ0ksUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFO01BQy9CLE9BQU8sV0FBVztJQUNwQjtJQUVBLElBQUlKLE9BQU8sQ0FBQ0ksUUFBUSxDQUFDLGNBQWMsQ0FBQyxJQUNoQ0osT0FBTyxDQUFDSSxRQUFRLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtNQUN0QyxPQUFPLGNBQWM7SUFDdkI7RUFDRjtFQUVBLE9BQU8sU0FBUztBQUNsQixDQUFDO0FBQUNDLE9BQUEsQ0FBQVIsZUFBQSxHQUFBQSxlQUFBO0FBRUssTUFBTVMscUJBQXFCLEdBQUlDLGNBQXVDLElBQWE7RUFDeEYsUUFBUUEsY0FBYztJQUNwQixLQUFLLFNBQVM7TUFDWixPQUFPLDREQUE0RDtJQUNyRSxLQUFLLFdBQVc7TUFDZCxPQUFPLGlFQUFpRTtJQUMxRSxLQUFLLGNBQWM7TUFDakIsT0FBTyx5Q0FBeUM7SUFDbEQsS0FBSyxVQUFVO01BQ2IsT0FBTywwREFBMEQ7SUFDbkUsS0FBSyxTQUFTO01BQ1osT0FBTyxpQ0FBaUM7SUFDMUMsS0FBSyxTQUFTO0lBQ2Q7TUFDRSxPQUFPLDRCQUE0QjtFQUN2QztBQUNGLENBQUM7QUFBQ0YsT0FBQSxDQUFBQyxxQkFBQSxHQUFBQSxxQkFBQSIsImlnbm9yZUxpc3QiOltdfQ==