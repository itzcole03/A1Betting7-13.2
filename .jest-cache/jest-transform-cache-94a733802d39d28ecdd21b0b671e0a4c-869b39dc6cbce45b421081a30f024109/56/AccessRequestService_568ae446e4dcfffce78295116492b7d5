d856a1002d9b4b34736909e49d76fad6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports._accessRequestService = void 0;
const constants_1 = require("../constants");
class AccessRequestService {
    constructor() {
        Object.defineProperty(this, "baseUrl", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        // Use centralized VITE_API_URL for browser-safe environment variables
        this.baseUrl = constants_1.VITE_API_URL || '/api';
    }
    /**
     * Submit an access request
     */
    async submitAccessRequest(data) {
        try {
            const _response = await fetch(`${this.baseUrl}/access-requests`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email: data.email.toLowerCase().trim(),
                    message: data.message?.trim(),
                    requestedAt: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    timestamp: Date.now(),
                }),
            });
            if (!_response.ok) {
                const _errorData = await _response.json().catch(() => ({ message: 'Network error' }));
                throw new Error(_errorData.message || `HTTP error! status: ${_response.status}`);
            }
            return await _response.json();
        }
        catch (error) {
            console.error('Failed to submit access request:', error);
            // For demo purposes, simulate success
            if (process.env.NODE_ENV === 'development') {
                return this.simulateAccessRequest(data);
            }
            throw error;
        }
    }
    /**
     * Check if email already has a pending request
     */
    async checkExistingRequest(email) {
        try {
            const _response = await fetch(`${this.baseUrl}/access-requests/check/${encodeURIComponent(email)}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            });
            if (_response.status === 404) {
                return null; // No existing request
            }
            if (!_response.ok) {
                throw new Error(`HTTP error! status: ${_response.status}`);
            }
            return await _response.json();
        }
        catch (error) {
            console.error('Failed to check existing request:', error);
            // For demo purposes, return null (no existing request)
            if (process.env.NODE_ENV === 'development') {
                return null;
            }
            throw error;
        }
    }
    /**
     * Get all access requests (admin only)
     */
    async getAllAccessRequests(authToken) {
        try {
            const _response = await fetch(`${this.baseUrl}/admin/access-requests`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${authToken}`,
                },
            });
            if (!_response.ok) {
                throw new Error(`HTTP error! status: ${_response.status}`);
            }
            return await _response.json();
        }
        catch (error) {
            console.error('Failed to fetch access requests:', error);
            // For demo purposes, return mock data
            if (process.env.NODE_ENV === 'development') {
                return this.getMockAccessRequests();
            }
            throw error;
        }
    }
    /**
     * Approve an access request (admin only)
     */
    async approveAccessRequest(requestId, authToken, adminEmail) {
        try {
            const _response = await fetch(`${this.baseUrl}/admin/access-requests/${requestId}/approve`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${authToken}`,
                },
                body: JSON.stringify({
                    approvedBy: adminEmail,
                    approvedAt: new Date().toISOString(),
                }),
            });
            if (!_response.ok) {
                throw new Error(`HTTP error! status: ${_response.status}`);
            }
            return await _response.json();
        }
        catch (error) {
            console.error('Failed to approve access request:', error);
            // For demo purposes, simulate success
            if (process.env.NODE_ENV === 'development') {
                return {
                    success: true,
                    message: 'Access request approved successfully. User will receive email with login credentials.',
                };
            }
            throw error;
        }
    }
    /**
     * Deny an access request (admin only)
     */
    async denyAccessRequest(requestId, authToken, adminEmail, reason) {
        try {
            const _response = await fetch(`${this.baseUrl}/admin/access-requests/${requestId}/deny`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${authToken}`,
                },
                body: JSON.stringify({
                    deniedBy: adminEmail,
                    deniedAt: new Date().toISOString(),
                    deniedReason: reason,
                }),
            });
            if (!_response.ok) {
                throw new Error(`HTTP error! status: ${_response.status}`);
            }
            return await _response.json();
        }
        catch (error) {
            console.error('Failed to deny access request:', error);
            // For demo purposes, simulate success
            if (process.env.NODE_ENV === 'development') {
                return {
                    success: true,
                    message: 'Access request denied. User will be notified via email.',
                };
            }
            throw error;
        }
    }
    /**
     * Validate email format
     */
    isValidEmail(email) {
        const _emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return _emailRegex.test(email);
    }
    /**
     * Generate temporary password
     */
    generateTempPassword() {
        const _chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789';
        let _password = '';
        for (let _i = 0; _i < 12; _i++) {
            _password += _chars.charAt(Math.floor(Math.random() * _chars.length));
        }
        return _password;
    }
    /**
     * Demo simulation methods for development
     */
    async simulateAccessRequest(data) {
        // Simulate network delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        // Simulate sending email notification to admin
        console.log('ðŸ”” [DEMO] Access Request Notification:', {
            email: data.email,
            message: data.message,
            timestamp: new Date().toISOString(),
            notifyAdmin: 'cole@example.com',
        });
        return {
            success: true,
            message: 'Access request submitted successfully! You will receive an email once your request is reviewed.',
            requestId: `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        };
    }
    getMockAccessRequests() {
        return [
            {
                id: 'req_001',
                email: 'user1@example.com',
                requestedAt: new Date(Date.now() - 86400000), // 1 day ago
                status: 'pending',
            },
            {
                id: 'req_002',
                email: 'user2@example.com',
                requestedAt: new Date(Date.now() - 172800000), // 2 days ago
                status: 'approved',
                approvedBy: 'cole@example.com',
                approvedAt: new Date(Date.now() - 86400000),
                tempPassword: 'TempPass123',
                isFirstLogin: true,
            },
            {
                id: 'req_003',
                email: 'spam@example.com',
                requestedAt: new Date(Date.now() - 259200000), // 3 days ago
                status: 'denied',
                approvedBy: 'cole@example.com',
                approvedAt: new Date(Date.now() - 172800000),
                deniedReason: 'Invalid business email domain',
            },
        ];
    }
}
// Export singleton instance
exports._accessRequestService = new AccessRequestService();
// Export class for testing
exports.default = AccessRequestService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxiY21hZFxcRG93bmxvYWRzXFxBMUJldHRpbmc3LTEzLjJcXGZyb250ZW5kXFxzcmNcXHNlcnZpY2VzXFxBY2Nlc3NSZXF1ZXN0U2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSw0Q0FBNEM7QUE0QjVDLE1BQU0sb0JBQW9CO0lBR3hCO1FBRlE7Ozs7O1dBQWdCO1FBR3RCLHNFQUFzRTtRQUN0RSxJQUFJLENBQUMsT0FBTyxHQUFHLHdCQUFZLElBQUksTUFBTSxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxJQUE2QjtRQUNyRCxJQUFJLENBQUM7WUFDSCxNQUFNLFNBQVMsR0FBRyxNQUFNLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLGtCQUFrQixFQUFFO2dCQUMvRCxNQUFNLEVBQUUsTUFBTTtnQkFDZCxPQUFPLEVBQUU7b0JBQ1AsY0FBYyxFQUFFLGtCQUFrQjtpQkFDbkM7Z0JBQ0QsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQ25CLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksRUFBRTtvQkFDdEMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFO29CQUM3QixXQUFXLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7b0JBQ3JDLFNBQVMsRUFBRSxTQUFTLENBQUMsU0FBUztvQkFDOUIsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7aUJBQ3RCLENBQUM7YUFDSCxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNsQixNQUFNLFVBQVUsR0FBRyxNQUFNLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RGLE1BQU0s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QyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsWUFBWTtnQkFDMUQsTUFBTSxFQUFFLFNBQVM7YUFDbEI7WUFDRDtnQkFDRSxFQUFFLEVBQUUsU0FBUztnQkFDYixLQUFLLEVBQUUsbUJBQW1CO2dCQUMxQixXQUFXLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFNBQVMsQ0FBQyxFQUFFLGFBQWE7Z0JBQzVELE1BQU0sRUFBRSxVQUFVO2dCQUNsQixVQUFVLEVBQUUsa0JBQWtCO2dCQUM5QixVQUFVLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFFBQVEsQ0FBQztnQkFDM0MsWUFBWSxFQUFFLGFBQWE7Z0JBQzNCLFlBQVksRUFBRSxJQUFJO2FBQ25CO1lBQ0Q7Z0JBQ0UsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsS0FBSyxFQUFFLGtCQUFrQjtnQkFDekIsV0FBVyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUMsRUFBRSxhQUFhO2dCQUM1RCxNQUFNLEVBQUUsUUFBUTtnQkFDaEIsVUFBVSxFQUFFLGtCQUFrQjtnQkFDOUIsVUFBVSxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7Z0JBQzVDLFlBQVksRUFBRSwrQkFBK0I7YUFDOUM7U0FDRixDQUFDO0lBQ0osQ0FBQztDQUNGO0FBRUQsNEJBQTRCO0FBQ2YsUUFBQSxxQkFBcUIsR0FBRyxJQUFJLG9CQUFvQixFQUFFLENBQUM7QUFFaEUsMkJBQTJCO0FBQzNCLGtCQUFlLG9CQUFvQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmNtYWRcXERvd25sb2Fkc1xcQTFCZXR0aW5nNy0xMy4yXFxmcm9udGVuZFxcc3JjXFxzZXJ2aWNlc1xcQWNjZXNzUmVxdWVzdFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVklURV9BUElfVVJMIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcclxuLyoqXHJcbiAqIEFjY2Vzc1JlcXVlc3RTZXJ2aWNlIC0gSGFuZGxlcyB1c2VyIGFjY2VzcyByZXF1ZXN0cyBhbmQgYXBwcm92YWwgd29ya2Zsb3dcclxuICovXHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFjY2Vzc1JlcXVlc3Qge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICByZXF1ZXN0ZWRBdDogRGF0ZTtcclxuICBzdGF0dXM6ICdwZW5kaW5nJyB8ICdhcHByb3ZlZCcgfCAnZGVuaWVkJztcclxuICBhcHByb3ZlZEJ5Pzogc3RyaW5nO1xyXG4gIGFwcHJvdmVkQXQ/OiBEYXRlO1xyXG4gIGRlbmllZFJlYXNvbj86IHN0cmluZztcclxuICB0ZW1wUGFzc3dvcmQ/OiBzdHJpbmc7XHJcbiAgaXNGaXJzdExvZ2luPzogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBY2Nlc3NSZXF1ZXN0U3VibWlzc2lvbiB7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICBtZXNzYWdlPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFjY2Vzc1JlcXVlc3RSZXNwb25zZSB7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgcmVxdWVzdElkPzogc3RyaW5nO1xyXG59XHJcblxyXG5jbGFzcyBBY2Nlc3NSZXF1ZXN0U2VydmljZSB7XHJcbiAgcHJpdmF0ZSBiYXNlVXJsOiBzdHJpbmc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgLy8gVXNlIGNlbnRyYWxpemVkIFZJVEVfQVBJX1VSTCBmb3IgYnJvd3Nlci1zYWZlIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG4gICAgdGhpcy5iYXNlVXJsID0gVklURV9BUElfVVJMIHx8ICcvYXBpJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN1Ym1pdCBhbiBhY2Nlc3MgcmVxdWVzdFxyXG4gICAqL1xyXG4gIGFzeW5jIHN1Ym1pdEFjY2Vzc1JlcXVlc3QoZGF0YTogQWNjZXNzUmVxdWVzdFN1Ym1pc3Npb24pOiBQcm9taXNlPEFjY2Vzc1JlcXVlc3RSZXNwb25zZT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hY2Nlc3MtcmVxdWVzdHNgLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgIGVtYWlsOiBkYXRhLmVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpLFxyXG4gICAgICAgICAgbWVzc2FnZTogZGF0YS5tZXNzYWdlPy50cmltKCksXHJcbiAgICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgdXNlckFnZW50OiBuYXZpZ2F0b3IudXNlckFnZW50LFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICAgIH0pLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghX3Jlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgY29uc3QgX2Vycm9yRGF0YSA9IGF3YWl0IF9yZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHsgbWVzc2FnZTogJ05ldHdvcmsgZXJyb3InIH0pKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2Vycm9yRGF0YS5tZXNzYWdlIHx8IGBIVFRQIGVycm9yISBzdGF0dXM6ICR7X3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGF3YWl0IF9yZXNwb25zZS5qc29uKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3VibWl0IGFjY2VzcyByZXF1ZXN0OicsIGVycm9yKTtcclxuICAgICAgLy8gRm9yIGRlbW8gcHVycG9zZXMsIHNpbXVsYXRlIHN1Y2Nlc3NcclxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2ltdWxhdGVBY2Nlc3NSZXF1ZXN0KGRhdGEpO1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgZW1haWwgYWxyZWFkeSBoYXMgYSBwZW5kaW5nIHJlcXVlc3RcclxuICAgKi9cclxuICBhc3luYyBjaGVja0V4aXN0aW5nUmVxdWVzdChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxBY2Nlc3NSZXF1ZXN0IHwgbnVsbD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgICAgYCR7dGhpcy5iYXNlVXJsfS9hY2Nlc3MtcmVxdWVzdHMvY2hlY2svJHtlbmNvZGVVUklDb21wb25lbnQoZW1haWwpfWAsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKF9yZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xyXG4gICAgICAgIHJldHVybiBudWxsOyAvLyBObyBleGlzdGluZyByZXF1ZXN0XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghX3Jlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBIVFRQIGVycm9yISBzdGF0dXM6ICR7X3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGF3YWl0IF9yZXNwb25zZS5qc29uKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2hlY2sgZXhpc3RpbmcgcmVxdWVzdDonLCBlcnJvcik7XHJcbiAgICAgIC8vIEZvciBkZW1vIHB1cnBvc2VzLCByZXR1cm4gbnVsbCAobm8gZXhpc3RpbmcgcmVxdWVzdClcclxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWxsIGFjY2VzcyByZXF1ZXN0cyAoYWRtaW4gb25seSlcclxuICAgKi9cclxuICBhc3luYyBnZXRBbGxBY2Nlc3NSZXF1ZXN0cyhhdXRoVG9rZW46IHN0cmluZyk6IFByb21pc2U8QWNjZXNzUmVxdWVzdFtdPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBfcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2FkbWluL2FjY2Vzcy1yZXF1ZXN0c2AsIHtcclxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXV0aFRva2VufWAsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIV9yZXNwb25zZS5vaykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgc3RhdHVzOiAke19yZXNwb25zZS5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBhd2FpdCBfcmVzcG9uc2UuanNvbigpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIGFjY2VzcyByZXF1ZXN0czonLCBlcnJvcik7XHJcbiAgICAgIC8vIEZvciBkZW1vIHB1cnBvc2VzLCByZXR1cm4gbW9jayBkYXRhXHJcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vY2tBY2Nlc3NSZXF1ZXN0cygpO1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQXBwcm92ZSBhbiBhY2Nlc3MgcmVxdWVzdCAoYWRtaW4gb25seSlcclxuICAgKi9cclxuICBhc3luYyBhcHByb3ZlQWNjZXNzUmVxdWVzdChcclxuICAgIHJlcXVlc3RJZDogc3RyaW5nLFxyXG4gICAgYXV0aFRva2VuOiBzdHJpbmcsXHJcbiAgICBhZG1pbkVtYWlsOiBzdHJpbmdcclxuICApOiBQcm9taXNlPEFjY2Vzc1JlcXVlc3RSZXNwb25zZT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hZG1pbi9hY2Nlc3MtcmVxdWVzdHMvJHtyZXF1ZXN0SWR9L2FwcHJvdmVgLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthdXRoVG9rZW59YCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgIGFwcHJvdmVkQnk6IGFkbWluRW1haWwsXHJcbiAgICAgICAgICBhcHByb3ZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFfcmVzcG9uc2Uub2spIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIHN0YXR1czogJHtfcmVzcG9uc2Uuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gYXdhaXQgX3Jlc3BvbnNlLmpzb24oKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBhcHByb3ZlIGFjY2VzcyByZXF1ZXN0OicsIGVycm9yKTtcclxuICAgICAgLy8gRm9yIGRlbW8gcHVycG9zZXMsIHNpbXVsYXRlIHN1Y2Nlc3NcclxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBtZXNzYWdlOlxyXG4gICAgICAgICAgICAnQWNjZXNzIHJlcXVlc3QgYXBwcm92ZWQgc3VjY2Vzc2Z1bGx5LiBVc2VyIHdpbGwgcmVjZWl2ZSBlbWFpbCB3aXRoIGxvZ2luIGNyZWRlbnRpYWxzLicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlbnkgYW4gYWNjZXNzIHJlcXVlc3QgKGFkbWluIG9ubHkpXHJcbiAgICovXHJcbiAgYXN5bmMgZGVueUFjY2Vzc1JlcXVlc3QoXHJcbiAgICByZXF1ZXN0SWQ6IHN0cmluZyxcclxuICAgIGF1dGhUb2tlbjogc3RyaW5nLFxyXG4gICAgYWRtaW5FbWFpbDogc3RyaW5nLFxyXG4gICAgcmVhc29uPzogc3RyaW5nXHJcbiAgKTogUHJvbWlzZTxBY2Nlc3NSZXF1ZXN0UmVzcG9uc2U+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IF9yZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vYWRtaW4vYWNjZXNzLXJlcXVlc3RzLyR7cmVxdWVzdElkfS9kZW55YCwge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXV0aFRva2VufWAsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBkZW5pZWRCeTogYWRtaW5FbWFpbCxcclxuICAgICAgICAgIGRlbmllZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBkZW5pZWRSZWFzb246IHJlYXNvbixcclxuICAgICAgICB9KSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIV9yZXNwb25zZS5vaykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgc3RhdHVzOiAke19yZXNwb25zZS5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBhd2FpdCBfcmVzcG9uc2UuanNvbigpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGRlbnkgYWNjZXNzIHJlcXVlc3Q6JywgZXJyb3IpO1xyXG4gICAgICAvLyBGb3IgZGVtbyBwdXJwb3Nlcywgc2ltdWxhdGUgc3VjY2Vzc1xyXG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgcmVxdWVzdCBkZW5pZWQuIFVzZXIgd2lsbCBiZSBub3RpZmllZCB2aWEgZW1haWwuJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGUgZW1haWwgZm9ybWF0XHJcbiAgICovXHJcbiAgaXNWYWxpZEVtYWlsKGVtYWlsOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IF9lbWFpbFJlZ2V4ID0gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC87XHJcbiAgICByZXR1cm4gX2VtYWlsUmVnZXgudGVzdChlbWFpbCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSB0ZW1wb3JhcnkgcGFzc3dvcmRcclxuICAgKi9cclxuICBnZW5lcmF0ZVRlbXBQYXNzd29yZCgpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgX2NoYXJzID0gJ0FCQ0RFRkdISktNTlBRUlNUVVZXWFlaYWJjZGVmZ2hpamttbnBxcnN0dXZ3eHl6MjM0NTY3ODknO1xyXG4gICAgbGV0IF9wYXNzd29yZCA9ICcnO1xyXG4gICAgZm9yIChsZXQgX2kgPSAwOyBfaSA8IDEyOyBfaSsrKSB7XHJcbiAgICAgIF9wYXNzd29yZCArPSBfY2hhcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIF9jaGFycy5sZW5ndGgpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBfcGFzc3dvcmQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZW1vIHNpbXVsYXRpb24gbWV0aG9kcyBmb3IgZGV2ZWxvcG1lbnRcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHNpbXVsYXRlQWNjZXNzUmVxdWVzdChcclxuICAgIGRhdGE6IEFjY2Vzc1JlcXVlc3RTdWJtaXNzaW9uXHJcbiAgKTogUHJvbWlzZTxBY2Nlc3NSZXF1ZXN0UmVzcG9uc2U+IHtcclxuICAgIC8vIFNpbXVsYXRlIG5ldHdvcmsgZGVsYXlcclxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XHJcblxyXG4gICAgLy8gU2ltdWxhdGUgc2VuZGluZyBlbWFpbCBub3RpZmljYXRpb24gdG8gYWRtaW5cclxuICAgIGNvbnNvbGUubG9nKCfwn5SUIFtERU1PXSBBY2Nlc3MgUmVxdWVzdCBOb3RpZmljYXRpb246Jywge1xyXG4gICAgICBlbWFpbDogZGF0YS5lbWFpbCxcclxuICAgICAgbWVzc2FnZTogZGF0YS5tZXNzYWdlLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgbm90aWZ5QWRtaW46ICdjb2xlQGV4YW1wbGUuY29tJyxcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIG1lc3NhZ2U6XHJcbiAgICAgICAgJ0FjY2VzcyByZXF1ZXN0IHN1Ym1pdHRlZCBzdWNjZXNzZnVsbHkhIFlvdSB3aWxsIHJlY2VpdmUgYW4gZW1haWwgb25jZSB5b3VyIHJlcXVlc3QgaXMgcmV2aWV3ZWQuJyxcclxuICAgICAgcmVxdWVzdElkOiBgcmVxXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldE1vY2tBY2Nlc3NSZXF1ZXN0cygpOiBBY2Nlc3NSZXF1ZXN0W10ge1xyXG4gICAgcmV0dXJuIFtcclxuICAgICAge1xyXG4gICAgICAgIGlkOiAncmVxXzAwMScsXHJcbiAgICAgICAgZW1haWw6ICd1c2VyMUBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSA4NjQwMDAwMCksIC8vIDEgZGF5IGFnb1xyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgaWQ6ICdyZXFfMDAyJyxcclxuICAgICAgICBlbWFpbDogJ3VzZXIyQGV4YW1wbGUuY29tJyxcclxuICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDE3MjgwMDAwMCksIC8vIDIgZGF5cyBhZ29cclxuICAgICAgICBzdGF0dXM6ICdhcHByb3ZlZCcsXHJcbiAgICAgICAgYXBwcm92ZWRCeTogJ2NvbGVAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgIGFwcHJvdmVkQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSA4NjQwMDAwMCksXHJcbiAgICAgICAgdGVtcFBhc3N3b3JkOiAnVGVtcFBhc3MxMjMnLFxyXG4gICAgICAgIGlzRmlyc3RMb2dpbjogdHJ1ZSxcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGlkOiAncmVxXzAwMycsXHJcbiAgICAgICAgZW1haWw6ICdzcGFtQGV4YW1wbGUuY29tJyxcclxuICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI1OTIwMDAwMCksIC8vIDMgZGF5cyBhZ29cclxuICAgICAgICBzdGF0dXM6ICdkZW5pZWQnLFxyXG4gICAgICAgIGFwcHJvdmVkQnk6ICdjb2xlQGV4YW1wbGUuY29tJyxcclxuICAgICAgICBhcHByb3ZlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMTcyODAwMDAwKSxcclxuICAgICAgICBkZW5pZWRSZWFzb246ICdJbnZhbGlkIGJ1c2luZXNzIGVtYWlsIGRvbWFpbicsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxyXG5leHBvcnQgY29uc3QgX2FjY2Vzc1JlcXVlc3RTZXJ2aWNlID0gbmV3IEFjY2Vzc1JlcXVlc3RTZXJ2aWNlKCk7XHJcblxyXG4vLyBFeHBvcnQgY2xhc3MgZm9yIHRlc3RpbmdcclxuZXhwb3J0IGRlZmF1bHQgQWNjZXNzUmVxdWVzdFNlcnZpY2U7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==