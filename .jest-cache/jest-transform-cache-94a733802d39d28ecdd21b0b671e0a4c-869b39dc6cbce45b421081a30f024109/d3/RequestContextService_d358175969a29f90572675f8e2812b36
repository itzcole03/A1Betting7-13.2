45dccda3b20fb245d159f03fe36e6ef5
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateRequestId = generateRequestId;
exports.getRequestContext = getRequestContext;
exports.timeRequest = timeRequest;
// RequestContextService.ts - Unified request tracing and correlation

// Simple UUID v4 generator (crypto-based if available)
function generateRequestId() {
  if (typeof crypto !== 'undefined' && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  // Fallback for environments without crypto.randomUUID
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
    const r = Math.random() * 16 | 0;
    const v = c === 'x' ? r : r & 0x3 | 0x8;
    return v.toString(16);
  });
}

// Returns headers with correlation/request ID and optional version info
function getRequestContext(version) {
  const requestId = generateRequestId();
  const headers = {
    'X-Request-ID': requestId
  };
  if (version) headers['X-Api-Version'] = version;
  return headers;
}

// Optional: Request timing metrics
function timeRequest(fn) {
  const start = performance.now();
  return fn().then(result => ({
    result,
    duration: performance.now() - start
  }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0ZVJlcXVlc3RJZCIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJyZXBsYWNlIiwiYyIsInIiLCJNYXRoIiwicmFuZG9tIiwidiIsInRvU3RyaW5nIiwiZ2V0UmVxdWVzdENvbnRleHQiLCJ2ZXJzaW9uIiwicmVxdWVzdElkIiwiaGVhZGVycyIsInRpbWVSZXF1ZXN0IiwiZm4iLCJzdGFydCIsInBlcmZvcm1hbmNlIiwibm93IiwidGhlbiIsInJlc3VsdCIsImR1cmF0aW9uIl0sInNvdXJjZXMiOlsiUmVxdWVzdENvbnRleHRTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFJlcXVlc3RDb250ZXh0U2VydmljZS50cyAtIFVuaWZpZWQgcmVxdWVzdCB0cmFjaW5nIGFuZCBjb3JyZWxhdGlvblxyXG5cclxuLy8gU2ltcGxlIFVVSUQgdjQgZ2VuZXJhdG9yIChjcnlwdG8tYmFzZWQgaWYgYXZhaWxhYmxlKVxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVSZXF1ZXN0SWQoKTogc3RyaW5nIHtcclxuICBpZiAodHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLnJhbmRvbVVVSUQpIHtcclxuICAgIHJldHVybiBjcnlwdG8ucmFuZG9tVVVJRCgpO1xyXG4gIH1cclxuICAvLyBGYWxsYmFjayBmb3IgZW52aXJvbm1lbnRzIHdpdGhvdXQgY3J5cHRvLnJhbmRvbVVVSURcclxuICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBjID0+IHtcclxuICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XHJcbiAgICBjb25zdCB2ID0gYyA9PT0gJ3gnID8gciA6IChyICYgMHgzKSB8IDB4ODtcclxuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gUmV0dXJucyBoZWFkZXJzIHdpdGggY29ycmVsYXRpb24vcmVxdWVzdCBJRCBhbmQgb3B0aW9uYWwgdmVyc2lvbiBpbmZvXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSZXF1ZXN0Q29udGV4dCh2ZXJzaW9uPzogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XHJcbiAgY29uc3QgcmVxdWVzdElkID0gZ2VuZXJhdGVSZXF1ZXN0SWQoKTtcclxuICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xyXG4gICAgJ1gtUmVxdWVzdC1JRCc6IHJlcXVlc3RJZCxcclxuICB9O1xyXG4gIGlmICh2ZXJzaW9uKSBoZWFkZXJzWydYLUFwaS1WZXJzaW9uJ10gPSB2ZXJzaW9uO1xyXG4gIHJldHVybiBoZWFkZXJzO1xyXG59XHJcblxyXG4vLyBPcHRpb25hbDogUmVxdWVzdCB0aW1pbmcgbWV0cmljc1xyXG5leHBvcnQgZnVuY3Rpb24gdGltZVJlcXVlc3Q8VD4oZm46ICgpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPHsgcmVzdWx0OiBUOyBkdXJhdGlvbjogbnVtYmVyIH0+IHtcclxuICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gIHJldHVybiBmbigpLnRoZW4ocmVzdWx0ID0+ICh7IHJlc3VsdCwgZHVyYXRpb246IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQgfSkpO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7QUFFQTtBQUNPLFNBQVNBLGlCQUFpQkEsQ0FBQSxFQUFXO0VBQzFDLElBQUksT0FBT0MsTUFBTSxLQUFLLFdBQVcsSUFBSUEsTUFBTSxDQUFDQyxVQUFVLEVBQUU7SUFDdEQsT0FBT0QsTUFBTSxDQUFDQyxVQUFVLENBQUMsQ0FBQztFQUM1QjtFQUNBO0VBQ0EsT0FBTyxzQ0FBc0MsQ0FBQ0MsT0FBTyxDQUFDLE9BQU8sRUFBRUMsQ0FBQyxJQUFJO0lBQ2xFLE1BQU1DLENBQUMsR0FBSUMsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBSSxDQUFDO0lBQ2xDLE1BQU1DLENBQUMsR0FBR0osQ0FBQyxLQUFLLEdBQUcsR0FBR0MsQ0FBQyxHQUFJQSxDQUFDLEdBQUcsR0FBRyxHQUFJLEdBQUc7SUFDekMsT0FBT0csQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDO0VBQ3ZCLENBQUMsQ0FBQztBQUNKOztBQUVBO0FBQ08sU0FBU0MsaUJBQWlCQSxDQUFDQyxPQUFnQixFQUEwQjtFQUMxRSxNQUFNQyxTQUFTLEdBQUdaLGlCQUFpQixDQUFDLENBQUM7RUFDckMsTUFBTWEsT0FBK0IsR0FBRztJQUN0QyxjQUFjLEVBQUVEO0VBQ2xCLENBQUM7RUFDRCxJQUFJRCxPQUFPLEVBQUVFLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBR0YsT0FBTztFQUMvQyxPQUFPRSxPQUFPO0FBQ2hCOztBQUVBO0FBQ08sU0FBU0MsV0FBV0EsQ0FBSUMsRUFBb0IsRUFBNEM7RUFDN0YsTUFBTUMsS0FBSyxHQUFHQyxXQUFXLENBQUNDLEdBQUcsQ0FBQyxDQUFDO0VBQy9CLE9BQU9ILEVBQUUsQ0FBQyxDQUFDLENBQUNJLElBQUksQ0FBQ0MsTUFBTSxLQUFLO0lBQUVBLE1BQU07SUFBRUMsUUFBUSxFQUFFSixXQUFXLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUdGO0VBQU0sQ0FBQyxDQUFDLENBQUM7QUFDL0UiLCJpZ25vcmVMaXN0IjpbXX0=