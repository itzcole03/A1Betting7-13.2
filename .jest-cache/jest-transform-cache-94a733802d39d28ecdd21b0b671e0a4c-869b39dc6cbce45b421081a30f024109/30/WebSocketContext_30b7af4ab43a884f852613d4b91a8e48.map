{"version":3,"names":["_react","_interopRequireWildcard","require","_jsxRuntime","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_WebSocketContext","exports","createContext","undefined","_WebSocketProvider","children","status","setStatus","useState","connected","setConnected","lastError","setLastError","verboseLogging","process","env","NODE_ENV","_wsRef","useRef","_handlers","reconnectAttempts","reconnectTimeout","onlineListener","offlineListener","isUnmounted","getWebSocketUrl","wsEnabled","VITE_WEBSOCKET_ENABLED","window","__VITE_ENV__","baseUrl","VITE_WS_URL","replace","protocol","location","host","connectWebSocket","React","useCallback","isReconnection","_wsUrl","console","log","current","debug","_ws","WebSocket","onopen","readyState","OPEN","send","JSON","stringify","event","timestamp","Date","now","onclose","code","reason","wasClean","delay","Math","min","clearTimeout","setTimeout","error","onerror","warn","CONNECTING","close","closeError","onmessage","data","trim","startsWith","_data","parse","eventType","type","forEach","fn","payload","connectionError","useEffect","handleOnline","handleOffline","addEventListener","removeEventListener","_send","msg","_subscribe","handler","push","_unsubscribe","filter","jsx","Provider","value","subscribe","unsubscribe","_useWebSocket","_ctx","useContext","Error"],"sources":["WebSocketContext.tsx"],"sourcesContent":["/**\r\n * WebSocketContext (Production-Grade)\r\n *\r\n * Provides robust, production-grade WebSocket connection and lifecycle management for real-time features.\r\n *\r\n * Features:\r\n * - Exponential backoff for reconnections on transient failures\r\n * - Immediate reconnect on network online events\r\n * - Cleans up all timers and event listeners on unmount\r\n * - Exposes connection status (connecting, connected, reconnecting, disconnected) and last error via context\r\n * - Graceful error handling: non-critical WebSocket errors are logged as warnings\r\n * - Designed for testability: all connection states and errors are observable in context\r\n * - Security: Prevents mixed content errors in development\r\n *\r\n * Usage:\r\n *   const { status, lastError, sendMessage } = useWebSocket();\r\n *\r\n *   // status: 'connecting' | 'connected' | 'reconnecting' | 'disconnected'\r\n *   // lastError: string | null\r\n *\r\n * Test Coverage:\r\n *   - Simulates transient connection failures and recovery\r\n *   - Simulates network offline/online events and immediate reconnect\r\n *   - Verifies status and error context updates\r\n *\r\n * See: WebSocketContext.test.tsx for comprehensive test scenarios.\r\n */\r\nimport React, { ReactNode, createContext, useContext, useEffect, useRef, useState } from 'react';\r\n\r\n/**\r\n * WebSocket connection status values.\r\n */\r\nexport type WebSocketStatus = 'connecting' | 'connected' | 'disconnected' | 'reconnecting';\r\n\r\nexport interface WebSocketContextType {\r\n  status: WebSocketStatus;\r\n  connected: boolean;\r\n  lastError: string | null;\r\n  send: (msg: unknown) => void;\r\n  subscribe: (event: string, handler: (data: unknown) => void) => void;\r\n  unsubscribe: (event: string, handler: (data: unknown) => void) => void;\r\n}\r\n\r\n/**\r\n * React context for WebSocket state and messaging.\r\n */\r\nconst _WebSocketContext = createContext<WebSocketContextType | undefined>(undefined);\r\nexport { _WebSocketContext };\r\n\r\n/**\r\n * WebSocketProvider component.\r\n * Wrap your app with this provider to enable WebSocket utilities.\r\n * @param {object} props - React children.\r\n * @returns {JSX.Element} The provider component.\r\n */\r\nexport const _WebSocketProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const [status, setStatus] = useState<WebSocketStatus>('disconnected');\r\n  const [connected, setConnected] = useState(false);\r\n  const [lastError, setLastError] = useState<string | null>(null);\r\n  const verboseLogging = process.env.NODE_ENV === 'development';\r\n  const _wsRef = useRef<WebSocket | null>(null);\r\n  const _handlers = useRef<Record<string, ((data: unknown) => void)[]>>({});\r\n  const reconnectAttempts = useRef(0);\r\n  const reconnectTimeout = useRef<NodeJS.Timeout | null>(null);\r\n  const onlineListener = useRef<(() => void) | null>(null);\r\n  const offlineListener = useRef<(() => void) | null>(null);\r\n  const isUnmounted = useRef(false);\r\n\r\n  // Helper to get the WebSocket URL with security considerations\r\n  const getWebSocketUrl = () => {\r\n    // Check if WebSocket is explicitly disabled\r\n    const wsEnabled = (() => {\r\n      if (typeof process !== 'undefined' && process.env?.VITE_WEBSOCKET_ENABLED) {\r\n        return process.env.VITE_WEBSOCKET_ENABLED === 'true';\r\n      }\r\n      if (typeof window !== 'undefined' && (window as any).__VITE_ENV__?.VITE_WEBSOCKET_ENABLED) {\r\n        return (window as any).__VITE_ENV__.VITE_WEBSOCKET_ENABLED === 'true';\r\n      }\r\n      return false;\r\n    })();\r\n    if (!wsEnabled) {\r\n      return null; // Signal that WebSocket should not be used\r\n    }\r\n\r\n    if (process.env.NODE_ENV === 'development') {\r\n      // In development, connect to backend port 8000\r\n      return 'ws://localhost:8000/ws/client';\r\n    } else {\r\n      // In production, use secure WebSocket\r\n      const baseUrl = (() => {\r\n        if (typeof process !== 'undefined' && process.env?.VITE_WS_URL) {\r\n          return process.env.VITE_WS_URL;\r\n        }\r\n        if (typeof window !== 'undefined' && (window as any).__VITE_ENV__?.VITE_WS_URL) {\r\n          return (window as any).__VITE_ENV__.VITE_WS_URL;\r\n        }\r\n        return undefined;\r\n      })();\r\n      if (baseUrl) {\r\n        // Ensure we use wss:// for secure connections in production\r\n        return baseUrl.replace(/^ws:/, 'wss:');\r\n      }\r\n      // Fallback to current protocol\r\n      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n      return `${protocol}//${window.location.host}/ws`;\r\n    }\r\n  };\r\n\r\n  // Robust connect logic with exponential backoff and error tracking\r\n  const connectWebSocket = React.useCallback((isReconnection = false) => {\r\n    const _wsUrl = getWebSocketUrl();\r\n\r\n    // If WebSocket URL is null, it means WebSocket is disabled\r\n    if (!_wsUrl) {\r\n      setStatus('disconnected');\r\n      setConnected(false);\r\n      setLastError('WebSocket disabled in configuration');\r\n      if (verboseLogging) console.log('[WebSocket] Connection disabled via configuration');\r\n      return;\r\n    }\r\n\r\n    setStatus(reconnectAttempts.current > 0 || isReconnection ? 'reconnecting' : 'connecting');\r\n    setLastError(null);\r\n\r\n    if (verboseLogging) console.debug(`[WebSocket] Connecting to: ${_wsUrl}`);\r\n\r\n    try {\r\n      const _ws = new WebSocket(_wsUrl);\r\n      _wsRef.current = _ws;\r\n\r\n      _ws.onopen = () => {\r\n        if (verboseLogging) console.debug(`[WebSocket] Connected successfully to: ${_wsUrl}`);\r\n        setConnected(true);\r\n        setStatus('connected');\r\n        setLastError(null);\r\n        reconnectAttempts.current = 0;\r\n        // Send a ping to verify connection is working\r\n        if (_ws.readyState === WebSocket.OPEN) {\r\n          _ws.send(JSON.stringify({ event: 'ping', timestamp: Date.now() }));\r\n        }\r\n      };\r\n\r\n      _ws.onclose = event => {\r\n        if (verboseLogging)\r\n          console.debug(`[WebSocket] Connection closed:`, event.code, event.reason, event.wasClean);\r\n        setConnected(false);\r\n        setStatus('disconnected');\r\n        if (!isUnmounted.current && event.code !== 1000) {\r\n          // Exponential backoff for reconnection with maximum attempts\r\n          if (reconnectAttempts.current < 10) {\r\n            const delay = Math.min(1000 * 2 ** reconnectAttempts.current, 30000);\r\n            reconnectAttempts.current += 1;\r\n            if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);\r\n            reconnectTimeout.current = setTimeout(() => {\r\n              setStatus('reconnecting');\r\n              console.log(`[WebSocket] Reconnecting... (attempt ${reconnectAttempts.current})`);\r\n              connectWebSocket(true);\r\n            }, delay);\r\n            setLastError(\r\n              `Disconnected. Attempting to reconnect in ${delay / 1000}s (attempt ${\r\n                reconnectAttempts.current\r\n              })`\r\n            );\r\n          } else {\r\n            setLastError('Maximum reconnection attempts reached. Giving up.');\r\n            console.error('[WebSocket] Maximum reconnection attempts reached. Giving up.');\r\n          }\r\n        }\r\n      };\r\n\r\n      _ws.onerror = error => {\r\n        setConnected(false);\r\n        setStatus('disconnected');\r\n        setLastError('WebSocket connection error');\r\n        if (verboseLogging)\r\n          console.warn(`[WebSocket] Connection error (non-critical, app will continue):`, error);\r\n\r\n        // Handle WebSocket errors gracefully to prevent unhandled promise rejections\r\n        try {\r\n          if (_ws.readyState === WebSocket.CONNECTING) {\r\n            // Close the connection if it's still trying to connect\r\n            _ws.close();\r\n          }\r\n        } catch (closeError) {\r\n          console.warn('[WebSocket] Error during cleanup:', closeError);\r\n        }\r\n      };\r\n\r\n      _ws.onmessage = event => {\r\n        try {\r\n          // Only parse if message looks like JSON\r\n          if (event.data && typeof event.data === 'string' && event.data.trim().startsWith('{')) {\r\n            const _data = JSON.parse(event.data);\r\n            // Support both 'event' and 'type' fields for compatibility\r\n            const eventType = _data.event || _data.type;\r\n            if (eventType && _handlers.current[eventType]) {\r\n              _handlers.current[eventType].forEach(fn => fn(_data.payload));\r\n            } else {\r\n              // Valid JSON but no handler for event/type\r\n              if (verboseLogging) console.warn('WebSocket received unhandled JSON message:', _data);\r\n            }\r\n          } else {\r\n            // Non-JSON message, log as warning and skip\r\n            if (verboseLogging) console.warn('WebSocket received non-JSON message:', event.data);\r\n          }\r\n        } catch (e) {\r\n          setLastError('WebSocket message error');\r\n          if (verboseLogging)\r\n            console.warn('WebSocket message parse error (non-critical):', e, event.data);\r\n        }\r\n      };\r\n    } catch (connectionError) {\r\n      // Handle WebSocket creation errors (e.g., mixed content issues)\r\n      setConnected(false);\r\n      setStatus('disconnected');\r\n      setLastError('WebSocket connection blocked - mixed content or security issue');\r\n      if (verboseLogging) {\r\n        console.warn('[WebSocket] Connection creation failed (non-critical):', connectionError);\r\n      }\r\n      return;\r\n    }\r\n  }, [verboseLogging]);\r\n\r\n  // Setup and cleanup effect\r\n  useEffect(() => {\r\n    isUnmounted.current = false;\r\n\r\n    // Only connect if WebSocket server is explicitly enabled\r\n    const wsEnabled = (() => {\r\n      if (typeof process !== 'undefined' && process.env?.VITE_WEBSOCKET_ENABLED) {\r\n        return process.env.VITE_WEBSOCKET_ENABLED === 'true';\r\n      }\r\n      if (typeof window !== 'undefined' && (window as any).__VITE_ENV__?.VITE_WEBSOCKET_ENABLED) {\r\n        return (window as any).__VITE_ENV__.VITE_WEBSOCKET_ENABLED === 'true';\r\n      }\r\n      return false;\r\n    })();\r\n    if (wsEnabled) {\r\n      connectWebSocket();\r\n    } else {\r\n      // Set to disconnected state without attempting connection\r\n      setStatus('disconnected');\r\n      setConnected(false);\r\n      setLastError('WebSocket disabled in configuration');\r\n      if (verboseLogging) console.log('[WebSocket] Connection disabled via configuration');\r\n    }\r\n\r\n    // Immediate reconnect on network changes\r\n    const handleOnline = () => {\r\n      const wsEnabled = (() => {\r\n        if (typeof process !== 'undefined' && process.env?.VITE_WEBSOCKET_ENABLED) {\r\n          return process.env.VITE_WEBSOCKET_ENABLED === 'true';\r\n        }\r\n        if (typeof window !== 'undefined' && (window as any).__VITE_ENV__?.VITE_WEBSOCKET_ENABLED) {\r\n          return (window as any).__VITE_ENV__.VITE_WEBSOCKET_ENABLED === 'true';\r\n        }\r\n        return false;\r\n      })();\r\n      if (!connected && wsEnabled) {\r\n        setStatus('reconnecting');\r\n        setLastError(null);\r\n        reconnectAttempts.current = 0;\r\n        if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);\r\n        connectWebSocket(true);\r\n      }\r\n    };\r\n    const handleOffline = () => {\r\n      setStatus('disconnected');\r\n      setLastError('Network offline');\r\n      if (_wsRef.current) _wsRef.current.close();\r\n    };\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n    onlineListener.current = handleOnline;\r\n    offlineListener.current = handleOffline;\r\n\r\n    return () => {\r\n      isUnmounted.current = true;\r\n      if (_wsRef.current) _wsRef.current.close();\r\n      if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);\r\n      if (onlineListener.current) window.removeEventListener('online', onlineListener.current);\r\n      if (offlineListener.current) window.removeEventListener('offline', offlineListener.current);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const _send = (msg: unknown) => {\r\n    if (_wsRef.current && connected) {\r\n      _wsRef.current.send(JSON.stringify(msg));\r\n    }\r\n  };\r\n\r\n  const _subscribe = (event: string, handler: (data: unknown) => void) => {\r\n    if (!_handlers.current[event]) _handlers.current[event] = [];\r\n    _handlers.current[event].push(handler);\r\n  };\r\n\r\n  const _unsubscribe = (event: string, handler: (data: unknown) => void) => {\r\n    if (_handlers.current[event]) {\r\n      _handlers.current[event] = _handlers.current[event].filter(fn => fn !== handler);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <_WebSocketContext.Provider\r\n      value={{\r\n        status,\r\n        connected,\r\n        lastError,\r\n        send: _send,\r\n        subscribe: _subscribe,\r\n        unsubscribe: _unsubscribe,\r\n      }}\r\n    >\r\n      {children}\r\n    </_WebSocketContext.Provider>\r\n  );\r\n};\r\n\r\n/**\r\n * useWebSocket\r\n * Access the WebSocket context in any component.\r\n */\r\nexport const _useWebSocket = () => {\r\n  const _ctx = useContext(_WebSocketContext);\r\n  if (!_ctx) throw new Error('useWebSocket must be used within WebSocketProvider');\r\n  return _ctx;\r\n};\r\n"],"mappings":"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","ignoreList":[]}