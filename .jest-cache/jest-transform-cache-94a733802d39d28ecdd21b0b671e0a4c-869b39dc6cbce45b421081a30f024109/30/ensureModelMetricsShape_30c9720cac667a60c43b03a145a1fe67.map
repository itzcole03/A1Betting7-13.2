{"version":3,"names":["hasLoggedMissingFields","safeStringify","obj","JSON","stringify","String","coerceToNumber","value","fallback","isFinite","parsed","parseFloat","isNaN","coerceToString","extractNestedValue","path","current","segment","undefined","getValueWithLegacyFallback","rawObj","canonicalPath","legacyPaths","type","defaultValue","canonicalValue","coerced","usedLegacy","legacyPath","legacyValue","deriveTotalTokens","usage","inputTokens","input_tokens","outputTokens","output_tokens","deriveSuccessRate","successRequests","success_requests","successful_requests","totalRequests","total_requests","total_inferences","ensureModelMetricsShape","raw","originFlags","usedLegacyFields","modelName","provider","optimizationLevel","version","optimizationMode","throughputRps","avgLatencyMs","p95LatencyMs","successRate","directSuccessRate","totalTokens","cacheHits","cacheHitRate","tuning","temperature","top_p","max_tokens","presence_penalty","frequency_penalty","mappedLegacy","hasModelSection","model","hasPerformanceSection","performance","hasUsageSection","partialPayload","missingFields","push","process","env","NODE_ENV","jest","length","console","warn","join","substring","normalized","name","optimization_level","optimization_mode","throughput_rps","avg_latency_ms","p95_latency_ms","success_rate","total_tokens","cache_hits","cache_hit_rate"],"sources":["ensureModelMetricsShape.ts"],"sourcesContent":["/**\r\n * Model metrics normalization to prevent \"Cannot read properties of undefined (reading 'optimization_level')\" errors\r\n * Provides shape normalization and legacy field mapping for AI/ML model metrics\r\n * \r\n * @module ensureModelMetricsShape\r\n */\r\n\r\n// Guard to prevent multiple logging\r\nlet hasLoggedMissingFields = false;\r\n\r\nexport interface ModelMetricsShape {\r\n  model: {\r\n    name: string;\r\n    provider: string;\r\n    version?: string;\r\n    optimization_level: string;\r\n    optimization_mode?: string;\r\n  };\r\n  performance: {\r\n    throughput_rps: number;\r\n    avg_latency_ms: number;\r\n    p95_latency_ms: number;\r\n    success_rate: number;\r\n  };\r\n  usage: {\r\n    total_requests: number;\r\n    input_tokens: number;\r\n    output_tokens: number;\r\n    total_tokens: number;\r\n    cache_hits?: number;\r\n    cache_hit_rate?: number;\r\n  };\r\n  tuning?: {\r\n    temperature: number;\r\n    top_p?: number;\r\n    max_tokens?: number;\r\n    presence_penalty?: number;\r\n    frequency_penalty?: number;\r\n  };\r\n  originFlags?: {\r\n    mappedLegacy?: boolean;\r\n    partialPayload?: boolean;\r\n  };\r\n}\r\n\r\n/**\r\n * Legacy key mapping table for reference\r\n * \r\n * optimizationLevel -> model.optimization_level\r\n * opt_level -> model.optimization_level  \r\n * optimization_mode -> model.optimization_mode\r\n * optimizationTier -> model.optimization_level\r\n * modelName -> model.name\r\n * model_name -> model.name\r\n * avg_latency -> performance.avg_latency_ms\r\n * latency_ms -> performance.avg_latency_ms\r\n * throughput -> performance.throughput_rps\r\n * throughput_per_second -> performance.throughput_rps\r\n * success_requests -> derived success_rate\r\n * total_inferences -> usage.total_requests\r\n */\r\n\r\n/**\r\n * Safe stringify for logging\r\n */\r\nconst safeStringify = (obj: unknown): string => {\r\n  try {\r\n    return JSON.stringify(obj, null, 2);\r\n  } catch {\r\n    return String(obj);\r\n  }\r\n};\r\n\r\n/**\r\n * Safely coerce value to number with fallback\r\n */\r\nconst coerceToNumber = (value: unknown, fallback: number = 0): number => {\r\n  if (typeof value === 'number') {\r\n    if (!isFinite(value)) {\r\n      return fallback;\r\n    }\r\n    return value;\r\n  }\r\n  if (typeof value === 'boolean') {\r\n    return value ? 1 : 0;\r\n  }\r\n  if (typeof value === 'string') {\r\n    const parsed = parseFloat(value);\r\n    if (!isNaN(parsed)) {\r\n      return parsed;\r\n    }\r\n  }\r\n  return fallback;\r\n};\r\n\r\n/**\r\n * Safely coerce value to string with fallback\r\n */\r\nconst coerceToString = (value: unknown, fallback: string = ''): string => {\r\n  if (typeof value === 'string') {\r\n    return value;\r\n  }\r\n  if (typeof value === 'number' || typeof value === 'boolean') {\r\n    return String(value);\r\n  }\r\n  return fallback;\r\n};\r\n\r\n/**\r\n * Extract nested value using path segments\r\n */\r\nconst extractNestedValue = (obj: Record<string, unknown>, path: string[]): unknown => {\r\n  let current: unknown = obj;\r\n  for (const segment of path) {\r\n    if (current && typeof current === 'object' && segment in current) {\r\n      current = (current as Record<string, unknown>)[segment];\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n  return current;\r\n};\r\n\r\n/**\r\n * Get value with legacy fallback mapping\r\n */\r\nconst getValueWithLegacyFallback = (\r\n  rawObj: Record<string, unknown>, \r\n  canonicalPath: string[], \r\n  legacyPaths: string[][], \r\n  type: 'number' | 'string',\r\n  defaultValue: string | number\r\n): { value: string | number; usedLegacy: boolean } => {\r\n  \r\n  // Try canonical path first\r\n  const canonicalValue = extractNestedValue(rawObj, canonicalPath);\r\n  if (canonicalValue !== undefined) {\r\n    const coerced = type === 'number' \r\n      ? coerceToNumber(canonicalValue, defaultValue as number)\r\n      : coerceToString(canonicalValue, defaultValue as string);\r\n    return { value: coerced, usedLegacy: false };\r\n  }\r\n  \r\n  // Try legacy paths\r\n  for (const legacyPath of legacyPaths) {\r\n    const legacyValue = extractNestedValue(rawObj, legacyPath);\r\n    if (legacyValue !== undefined) {\r\n      const coerced = type === 'number' \r\n        ? coerceToNumber(legacyValue, defaultValue as number)\r\n        : coerceToString(legacyValue, defaultValue as string);\r\n      return { value: coerced, usedLegacy: true };\r\n    }\r\n  }\r\n  \r\n  return { value: defaultValue, usedLegacy: false };\r\n};\r\n\r\n/**\r\n * Derive total_tokens if missing\r\n */\r\nconst deriveTotalTokens = (usage: Record<string, unknown>): number => {\r\n  const inputTokens = coerceToNumber(usage.input_tokens || usage.inputTokens, 0);\r\n  const outputTokens = coerceToNumber(usage.output_tokens || usage.outputTokens, 0);\r\n  return inputTokens + outputTokens;\r\n};\r\n\r\n/**\r\n * Derive success_rate if missing but success/total available\r\n */\r\nconst deriveSuccessRate = (rawObj: Record<string, unknown>): number => {\r\n  const successRequests = coerceToNumber(rawObj.success_requests || rawObj.successful_requests, 0);\r\n  const totalRequests = coerceToNumber(rawObj.total_requests || rawObj.total_inferences, 0);\r\n  \r\n  if (totalRequests > 0) {\r\n    return successRequests / totalRequests;\r\n  }\r\n  \r\n  return 0;\r\n};\r\n\r\n/**\r\n * Ensures model metrics data conforms to ModelMetricsShape with safe defaults\r\n * \r\n * Features:\r\n * - Normalizes missing nested objects to safe defaults\r\n * - Maps legacy fields to canonical structure  \r\n * - Coerces numeric fields to numbers and strings to strings\r\n * - Derives computed fields (total_tokens, success_rate)\r\n * - Adds development metadata in originFlags\r\n * - One-time logging for missing fields and legacy usage\r\n */\r\nexport function ensureModelMetricsShape(raw: unknown): ModelMetricsShape {\r\n  const originFlags: ModelMetricsShape['originFlags'] = {};\r\n  \r\n  // Type guard for raw data\r\n  const rawObj = raw && typeof raw === 'object' ? raw as Record<string, unknown> : {};\r\n\r\n  let usedLegacyFields = false;\r\n\r\n  // Build model section with legacy mapping\r\n  const modelName = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['model', 'name'], \r\n    [['modelName'], ['model_name'], ['name']], \r\n    'string', \r\n    'Unknown Model'\r\n  );\r\n  if (modelName.usedLegacy) usedLegacyFields = true;\r\n\r\n  const provider = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['model', 'provider'], \r\n    [['provider'], ['model_provider'], ['modelProvider']], \r\n    'string', \r\n    'Unknown Provider'\r\n  );\r\n  if (provider.usedLegacy) usedLegacyFields = true;\r\n\r\n  const optimizationLevel = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['model', 'optimization_level'], \r\n    [\r\n      ['optimizationLevel'], \r\n      ['opt_level'], \r\n      ['optimization_mode'],\r\n      ['system_info', 'optimization_level'],\r\n      ['optimizationTier'],\r\n      ['optTier']\r\n    ], \r\n    'string', \r\n    'Basic'\r\n  );\r\n  if (optimizationLevel.usedLegacy) usedLegacyFields = true;\r\n\r\n  const version = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['model', 'version'], \r\n    [['version'], ['model_version']], \r\n    'string', \r\n    ''\r\n  );\r\n\r\n  const optimizationMode = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['model', 'optimization_mode'], \r\n    [['optimization_mode'], ['optimizationMode']], \r\n    'string', \r\n    ''\r\n  );\r\n\r\n  // Build performance section\r\n  const throughputRps = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['performance', 'throughput_rps'], \r\n    [['throughput'], ['throughput_per_second'], ['rps']], \r\n    'number', \r\n    0\r\n  );\r\n  if (throughputRps.usedLegacy) usedLegacyFields = true;\r\n\r\n  const avgLatencyMs = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['performance', 'avg_latency_ms'], \r\n    [['avg_latency'], ['latency_ms'], ['avg_latency_ms']], \r\n    'number', \r\n    0\r\n  );\r\n  if (avgLatencyMs.usedLegacy) usedLegacyFields = true;\r\n\r\n  const p95LatencyMs = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['performance', 'p95_latency_ms'], \r\n    [['p95_latency'], ['p95_latency_ms']], \r\n    'number', \r\n    0\r\n  );\r\n  if (p95LatencyMs.usedLegacy) usedLegacyFields = true;\r\n\r\n  // Try to derive success_rate or use direct value\r\n  let successRate: number;\r\n  const directSuccessRate = extractNestedValue(rawObj, ['performance', 'success_rate']);\r\n  if (directSuccessRate !== undefined) {\r\n    successRate = coerceToNumber(directSuccessRate, 0);\r\n  } else {\r\n    successRate = deriveSuccessRate(rawObj);\r\n    if (successRate > 0) usedLegacyFields = true;\r\n  }\r\n\r\n  // Build usage section\r\n  const totalRequests = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['usage', 'total_requests'], \r\n    [['total_requests'], ['total_inferences'], ['totalRequests']], \r\n    'number', \r\n    0\r\n  );\r\n  if (totalRequests.usedLegacy) usedLegacyFields = true;\r\n\r\n  const inputTokens = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['usage', 'input_tokens'], \r\n    [['input_tokens'], ['inputTokens']], \r\n    'number', \r\n    0\r\n  );\r\n  if (inputTokens.usedLegacy) usedLegacyFields = true;\r\n\r\n  const outputTokens = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['usage', 'output_tokens'], \r\n    [['output_tokens'], ['outputTokens']], \r\n    'number', \r\n    0\r\n  );\r\n  if (outputTokens.usedLegacy) usedLegacyFields = true;\r\n\r\n  // Derive total_tokens\r\n  let totalTokens = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['usage', 'total_tokens'], \r\n    [['total_tokens'], ['totalTokens']], \r\n    'number', \r\n    0\r\n  ).value as number;\r\n\r\n  if (totalTokens === 0 && ((inputTokens.value as number) > 0 || (outputTokens.value as number) > 0)) {\r\n    totalTokens = deriveTotalTokens({\r\n      input_tokens: inputTokens.value,\r\n      output_tokens: outputTokens.value\r\n    });\r\n  }\r\n\r\n  const cacheHits = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['usage', 'cache_hits'], \r\n    [['cache_hits'], ['cacheHits']], \r\n    'number', \r\n    0\r\n  );\r\n\r\n  const cacheHitRate = getValueWithLegacyFallback(\r\n    rawObj, \r\n    ['usage', 'cache_hit_rate'], \r\n    [['cache_hit_rate'], ['cacheHitRate']], \r\n    'number', \r\n    0\r\n  );\r\n\r\n  // Build optional tuning section\r\n  let tuning: ModelMetricsShape['tuning'] | undefined;\r\n  const temperature = extractNestedValue(rawObj, ['tuning', 'temperature']) || rawObj.temperature;\r\n  if (temperature !== undefined || rawObj.top_p !== undefined || rawObj.max_tokens !== undefined) {\r\n    tuning = {\r\n      temperature: coerceToNumber(temperature, 0.7),\r\n      top_p: rawObj.top_p !== undefined ? coerceToNumber(rawObj.top_p, undefined) : undefined,\r\n      max_tokens: rawObj.max_tokens !== undefined ? coerceToNumber(rawObj.max_tokens, undefined) : undefined,\r\n      presence_penalty: rawObj.presence_penalty !== undefined ? coerceToNumber(rawObj.presence_penalty, undefined) : undefined,\r\n      frequency_penalty: rawObj.frequency_penalty !== undefined ? coerceToNumber(rawObj.frequency_penalty, undefined) : undefined,\r\n    };\r\n  }\r\n\r\n  // Set origin flags\r\n  if (usedLegacyFields) {\r\n    originFlags.mappedLegacy = true;\r\n  }\r\n\r\n  const hasModelSection = rawObj.model && typeof rawObj.model === 'object';\r\n  const hasPerformanceSection = rawObj.performance && typeof rawObj.performance === 'object';\r\n  const hasUsageSection = rawObj.usage && typeof rawObj.usage === 'object';\r\n\r\n  if (!hasModelSection || !hasPerformanceSection || !hasUsageSection) {\r\n    originFlags.partialPayload = true;\r\n  }\r\n\r\n  // One-time development logging\r\n  const missingFields: string[] = [];\r\n  if (!raw) missingFields.push('entire model metrics object');\r\n  if (!hasModelSection) missingFields.push('model section');\r\n  if (!hasPerformanceSection) missingFields.push('performance section');\r\n  if (!hasUsageSection) missingFields.push('usage section');\r\n\r\n  if ((process.env.NODE_ENV === 'development' ||\r\n        process.env.NODE_ENV === 'test' ||\r\n        typeof jest !== 'undefined') &&\r\n      (missingFields.length > 0 || originFlags.mappedLegacy) &&\r\n      !hasLoggedMissingFields) {\r\n    hasLoggedMissingFields = true;\r\n    \r\n    if (missingFields.length > 0) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(\r\n        '[ModelMetricsGuard] Missing model metrics fields detected:',\r\n        missingFields.join(', '),\r\n        '\\nRaw data sample:',\r\n        safeStringify(rawObj)?.substring(0, 500) + '...'\r\n      );\r\n    }\r\n    \r\n    if (originFlags.mappedLegacy) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(\r\n        '[ModelMetricsGuard] Using legacy model metrics fields:',\r\n        'optimizationLevel, opt_level, model_name, throughput_per_second, etc.',\r\n        'Consider migrating to canonical structure'\r\n      );\r\n    }\r\n  }\r\n\r\n  // Build normalized model metrics object\r\n  const normalized: ModelMetricsShape = {\r\n    model: {\r\n      name: modelName.value as string,\r\n      provider: provider.value as string,\r\n      optimization_level: optimizationLevel.value as string,\r\n      ...(version.value && version.value !== '' ? { version: version.value as string } : {}),\r\n      ...(optimizationMode.value && optimizationMode.value !== '' ? { optimization_mode: optimizationMode.value as string } : {}),\r\n    },\r\n    performance: {\r\n      throughput_rps: throughputRps.value as number,\r\n      avg_latency_ms: avgLatencyMs.value as number,\r\n      p95_latency_ms: p95LatencyMs.value as number,\r\n      success_rate: successRate,\r\n    },\r\n    usage: {\r\n      total_requests: totalRequests.value as number,\r\n      input_tokens: inputTokens.value as number,\r\n      output_tokens: outputTokens.value as number,\r\n      total_tokens: totalTokens,\r\n      ...((cacheHits.value as number) > 0 ? { cache_hits: cacheHits.value as number } : {}),\r\n      ...((cacheHitRate.value as number) > 0 ? { cache_hit_rate: cacheHitRate.value as number } : {}),\r\n    },\r\n    ...(tuning ? { tuning } : {}),\r\n    originFlags,\r\n  };\r\n\r\n  return normalized;\r\n}"],"mappings":"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","ignoreList":[]}