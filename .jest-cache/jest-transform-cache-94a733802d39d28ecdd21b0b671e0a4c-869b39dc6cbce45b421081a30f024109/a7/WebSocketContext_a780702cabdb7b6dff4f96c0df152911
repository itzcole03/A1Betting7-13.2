14221871292a83a44ac9c7fd74218487
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports._useWebSocket = exports._WebSocketProvider = exports._WebSocketContext = void 0;
var _react = _interopRequireWildcard(require("react"));
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
/**
 * WebSocketContext (Production-Grade)
 *
 * Provides robust, production-grade WebSocket connection and lifecycle management for real-time features.
 *
 * Features:
 * - Exponential backoff for reconnections on transient failures
 * - Immediate reconnect on network online events
 * - Cleans up all timers and event listeners on unmount
 * - Exposes connection status (connecting, connected, reconnecting, disconnected) and last error via context
 * - Graceful error handling: non-critical WebSocket errors are logged as warnings
 * - Designed for testability: all connection states and errors are observable in context
 * - Security: Prevents mixed content errors in development
 *
 * Usage:
 *   const { status, lastError, sendMessage } = useWebSocket();
 *
 *   // status: 'connecting' | 'connected' | 'reconnecting' | 'disconnected'
 *   // lastError: string | null
 *
 * Test Coverage:
 *   - Simulates transient connection failures and recovery
 *   - Simulates network offline/online events and immediate reconnect
 *   - Verifies status and error context updates
 *
 * See: WebSocketContext.test.tsx for comprehensive test scenarios.
 */

/**
 * WebSocket connection status values.
 */

/**
 * React context for WebSocket state and messaging.
 */
const _WebSocketContext = exports._WebSocketContext = /*#__PURE__*/(0, _react.createContext)(undefined);
/**
 * WebSocketProvider component.
 * Wrap your app with this provider to enable WebSocket utilities.
 * @param {object} props - React children.
 * @returns {JSX.Element} The provider component.
 */
const _WebSocketProvider = ({
  children
}) => {
  const [status, setStatus] = (0, _react.useState)('disconnected');
  const [connected, setConnected] = (0, _react.useState)(false);
  const [lastError, setLastError] = (0, _react.useState)(null);
  const verboseLogging = process.env.NODE_ENV === 'development';
  const _wsRef = (0, _react.useRef)(null);
  const _handlers = (0, _react.useRef)({});
  const reconnectAttempts = (0, _react.useRef)(0);
  const reconnectTimeout = (0, _react.useRef)(null);
  const onlineListener = (0, _react.useRef)(null);
  const offlineListener = (0, _react.useRef)(null);
  const isUnmounted = (0, _react.useRef)(false);

  // Helper to get the WebSocket URL with security considerations
  const getWebSocketUrl = () => {
    // Check if WebSocket is explicitly disabled
    const wsEnabled = (() => {
      if (typeof process !== 'undefined' && process.env?.VITE_WEBSOCKET_ENABLED) {
        return process.env.VITE_WEBSOCKET_ENABLED === 'true';
      }
      if (typeof window !== 'undefined' && window.__VITE_ENV__?.VITE_WEBSOCKET_ENABLED) {
        return window.__VITE_ENV__.VITE_WEBSOCKET_ENABLED === 'true';
      }
      return false;
    })();
    if (!wsEnabled) {
      return null; // Signal that WebSocket should not be used
    }
    if (process.env.NODE_ENV === 'development') {
      // In development, connect to backend port 8000
      return 'ws://localhost:8000/ws/client';
    } else {
      // In production, use secure WebSocket
      const baseUrl = (() => {
        if (typeof process !== 'undefined' && process.env?.VITE_WS_URL) {
          return process.env.VITE_WS_URL;
        }
        if (typeof window !== 'undefined' && window.__VITE_ENV__?.VITE_WS_URL) {
          return window.__VITE_ENV__.VITE_WS_URL;
        }
        return undefined;
      })();
      if (baseUrl) {
        // Ensure we use wss:// for secure connections in production
        return baseUrl.replace(/^ws:/, 'wss:');
      }
      // Fallback to current protocol
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      return `${protocol}//${window.location.host}/ws`;
    }
  };

  // Robust connect logic with exponential backoff and error tracking
  const connectWebSocket = _react.default.useCallback((isReconnection = false) => {
    const _wsUrl = getWebSocketUrl();

    // If WebSocket URL is null, it means WebSocket is disabled
    if (!_wsUrl) {
      setStatus('disconnected');
      setConnected(false);
      setLastError('WebSocket disabled in configuration');
      if (verboseLogging) console.log('[WebSocket] Connection disabled via configuration');
      return;
    }
    setStatus(reconnectAttempts.current > 0 || isReconnection ? 'reconnecting' : 'connecting');
    setLastError(null);
    if (verboseLogging) console.debug(`[WebSocket] Connecting to: ${_wsUrl}`);
    try {
      const _ws = new WebSocket(_wsUrl);
      _wsRef.current = _ws;
      _ws.onopen = () => {
        if (verboseLogging) console.debug(`[WebSocket] Connected successfully to: ${_wsUrl}`);
        setConnected(true);
        setStatus('connected');
        setLastError(null);
        reconnectAttempts.current = 0;
        // Send a ping to verify connection is working
        if (_ws.readyState === WebSocket.OPEN) {
          _ws.send(JSON.stringify({
            event: 'ping',
            timestamp: Date.now()
          }));
        }
      };
      _ws.onclose = event => {
        if (verboseLogging) console.debug(`[WebSocket] Connection closed:`, event.code, event.reason, event.wasClean);
        setConnected(false);
        setStatus('disconnected');
        if (!isUnmounted.current && event.code !== 1000) {
          // Exponential backoff for reconnection with maximum attempts
          if (reconnectAttempts.current < 10) {
            const delay = Math.min(1000 * 2 ** reconnectAttempts.current, 30000);
            reconnectAttempts.current += 1;
            if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);
            reconnectTimeout.current = setTimeout(() => {
              setStatus('reconnecting');
              console.log(`[WebSocket] Reconnecting... (attempt ${reconnectAttempts.current})`);
              connectWebSocket(true);
            }, delay);
            setLastError(`Disconnected. Attempting to reconnect in ${delay / 1000}s (attempt ${reconnectAttempts.current})`);
          } else {
            setLastError('Maximum reconnection attempts reached. Giving up.');
            console.error('[WebSocket] Maximum reconnection attempts reached. Giving up.');
          }
        }
      };
      _ws.onerror = error => {
        setConnected(false);
        setStatus('disconnected');
        setLastError('WebSocket connection error');
        if (verboseLogging) console.warn(`[WebSocket] Connection error (non-critical, app will continue):`, error);

        // Handle WebSocket errors gracefully to prevent unhandled promise rejections
        try {
          if (_ws.readyState === WebSocket.CONNECTING) {
            // Close the connection if it's still trying to connect
            _ws.close();
          }
        } catch (closeError) {
          console.warn('[WebSocket] Error during cleanup:', closeError);
        }
      };
      _ws.onmessage = event => {
        try {
          // Only parse if message looks like JSON
          if (event.data && typeof event.data === 'string' && event.data.trim().startsWith('{')) {
            const _data = JSON.parse(event.data);
            // Support both 'event' and 'type' fields for compatibility
            const eventType = _data.event || _data.type;
            if (eventType && _handlers.current[eventType]) {
              _handlers.current[eventType].forEach(fn => fn(_data.payload));
            } else {
              // Valid JSON but no handler for event/type
              if (verboseLogging) console.warn('WebSocket received unhandled JSON message:', _data);
            }
          } else {
            // Non-JSON message, log as warning and skip
            if (verboseLogging) console.warn('WebSocket received non-JSON message:', event.data);
          }
        } catch (e) {
          setLastError('WebSocket message error');
          if (verboseLogging) console.warn('WebSocket message parse error (non-critical):', e, event.data);
        }
      };
    } catch (connectionError) {
      // Handle WebSocket creation errors (e.g., mixed content issues)
      setConnected(false);
      setStatus('disconnected');
      setLastError('WebSocket connection blocked - mixed content or security issue');
      if (verboseLogging) {
        console.warn('[WebSocket] Connection creation failed (non-critical):', connectionError);
      }
      return;
    }
  }, [verboseLogging]);

  // Setup and cleanup effect
  (0, _react.useEffect)(() => {
    isUnmounted.current = false;

    // Only connect if WebSocket server is explicitly enabled
    const wsEnabled = (() => {
      if (typeof process !== 'undefined' && process.env?.VITE_WEBSOCKET_ENABLED) {
        return process.env.VITE_WEBSOCKET_ENABLED === 'true';
      }
      if (typeof window !== 'undefined' && window.__VITE_ENV__?.VITE_WEBSOCKET_ENABLED) {
        return window.__VITE_ENV__.VITE_WEBSOCKET_ENABLED === 'true';
      }
      return false;
    })();
    if (wsEnabled) {
      connectWebSocket();
    } else {
      // Set to disconnected state without attempting connection
      setStatus('disconnected');
      setConnected(false);
      setLastError('WebSocket disabled in configuration');
      if (verboseLogging) console.log('[WebSocket] Connection disabled via configuration');
    }

    // Immediate reconnect on network changes
    const handleOnline = () => {
      const wsEnabled = (() => {
        if (typeof process !== 'undefined' && process.env?.VITE_WEBSOCKET_ENABLED) {
          return process.env.VITE_WEBSOCKET_ENABLED === 'true';
        }
        if (typeof window !== 'undefined' && window.__VITE_ENV__?.VITE_WEBSOCKET_ENABLED) {
          return window.__VITE_ENV__.VITE_WEBSOCKET_ENABLED === 'true';
        }
        return false;
      })();
      if (!connected && wsEnabled) {
        setStatus('reconnecting');
        setLastError(null);
        reconnectAttempts.current = 0;
        if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);
        connectWebSocket(true);
      }
    };
    const handleOffline = () => {
      setStatus('disconnected');
      setLastError('Network offline');
      if (_wsRef.current) _wsRef.current.close();
    };
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    onlineListener.current = handleOnline;
    offlineListener.current = handleOffline;
    return () => {
      isUnmounted.current = true;
      if (_wsRef.current) _wsRef.current.close();
      if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);
      if (onlineListener.current) window.removeEventListener('online', onlineListener.current);
      if (offlineListener.current) window.removeEventListener('offline', offlineListener.current);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  const _send = msg => {
    if (_wsRef.current && connected) {
      _wsRef.current.send(JSON.stringify(msg));
    }
  };
  const _subscribe = (event, handler) => {
    if (!_handlers.current[event]) _handlers.current[event] = [];
    _handlers.current[event].push(handler);
  };
  const _unsubscribe = (event, handler) => {
    if (_handlers.current[event]) {
      _handlers.current[event] = _handlers.current[event].filter(fn => fn !== handler);
    }
  };
  return /*#__PURE__*/(0, _jsxRuntime.jsx)(_WebSocketContext.Provider, {
    value: {
      status,
      connected,
      lastError,
      send: _send,
      subscribe: _subscribe,
      unsubscribe: _unsubscribe
    },
    children: children
  });
};

/**
 * useWebSocket
 * Access the WebSocket context in any component.
 */
exports._WebSocketProvider = _WebSocketProvider;
const _useWebSocket = () => {
  const _ctx = (0, _react.useContext)(_WebSocketContext);
  if (!_ctx) throw new Error('useWebSocket must be used within WebSocketProvider');
  return _ctx;
};
exports._useWebSocket = _useWebSocket;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfanN4UnVudGltZSIsImUiLCJ0IiwiV2Vha01hcCIsInIiLCJuIiwiX19lc01vZHVsZSIsIm8iLCJpIiwiZiIsIl9fcHJvdG9fXyIsImRlZmF1bHQiLCJoYXMiLCJnZXQiLCJzZXQiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIl9XZWJTb2NrZXRDb250ZXh0IiwiZXhwb3J0cyIsImNyZWF0ZUNvbnRleHQiLCJ1bmRlZmluZWQiLCJfV2ViU29ja2V0UHJvdmlkZXIiLCJjaGlsZHJlbiIsInN0YXR1cyIsInNldFN0YXR1cyIsInVzZVN0YXRlIiwiY29ubmVjdGVkIiwic2V0Q29ubmVjdGVkIiwibGFzdEVycm9yIiwic2V0TGFzdEVycm9yIiwidmVyYm9zZUxvZ2dpbmciLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJfd3NSZWYiLCJ1c2VSZWYiLCJfaGFuZGxlcnMiLCJyZWNvbm5lY3RBdHRlbXB0cyIsInJlY29ubmVjdFRpbWVvdXQiLCJvbmxpbmVMaXN0ZW5lciIsIm9mZmxpbmVMaXN0ZW5lciIsImlzVW5tb3VudGVkIiwiZ2V0V2ViU29ja2V0VXJsIiwid3NFbmFibGVkIiwiVklURV9XRUJTT0NLRVRfRU5BQkxFRCIsIndpbmRvdyIsIl9fVklURV9FTlZfXyIsImJhc2VVcmwiLCJWSVRFX1dTX1VSTCIsInJlcGxhY2UiLCJwcm90b2NvbCIsImxvY2F0aW9uIiwiaG9zdCIsImNvbm5lY3RXZWJTb2NrZXQiLCJSZWFjdCIsInVzZUNhbGxiYWNrIiwiaXNSZWNvbm5lY3Rpb24iLCJfd3NVcmwiLCJjb25zb2xlIiwibG9nIiwiY3VycmVudCIsImRlYnVnIiwiX3dzIiwiV2ViU29ja2V0Iiwib25vcGVuIiwicmVhZHlTdGF0ZSIsIk9QRU4iLCJzZW5kIiwiSlNPTiIsInN0cmluZ2lmeSIsImV2ZW50IiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsIm9uY2xvc2UiLCJjb2RlIiwicmVhc29uIiwid2FzQ2xlYW4iLCJkZWxheSIsIk1hdGgiLCJtaW4iLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiZXJyb3IiLCJvbmVycm9yIiwid2FybiIsIkNPTk5FQ1RJTkciLCJjbG9zZSIsImNsb3NlRXJyb3IiLCJvbm1lc3NhZ2UiLCJkYXRhIiwidHJpbSIsInN0YXJ0c1dpdGgiLCJfZGF0YSIsInBhcnNlIiwiZXZlbnRUeXBlIiwidHlwZSIsImZvckVhY2giLCJmbiIsInBheWxvYWQiLCJjb25uZWN0aW9uRXJyb3IiLCJ1c2VFZmZlY3QiLCJoYW5kbGVPbmxpbmUiLCJoYW5kbGVPZmZsaW5lIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJfc2VuZCIsIm1zZyIsIl9zdWJzY3JpYmUiLCJoYW5kbGVyIiwicHVzaCIsIl91bnN1YnNjcmliZSIsImZpbHRlciIsImpzeCIsIlByb3ZpZGVyIiwidmFsdWUiLCJzdWJzY3JpYmUiLCJ1bnN1YnNjcmliZSIsIl91c2VXZWJTb2NrZXQiLCJfY3R4IiwidXNlQ29udGV4dCIsIkVycm9yIl0sInNvdXJjZXMiOlsiV2ViU29ja2V0Q29udGV4dC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFdlYlNvY2tldENvbnRleHQgKFByb2R1Y3Rpb24tR3JhZGUpXHJcbiAqXHJcbiAqIFByb3ZpZGVzIHJvYnVzdCwgcHJvZHVjdGlvbi1ncmFkZSBXZWJTb2NrZXQgY29ubmVjdGlvbiBhbmQgbGlmZWN5Y2xlIG1hbmFnZW1lbnQgZm9yIHJlYWwtdGltZSBmZWF0dXJlcy5cclxuICpcclxuICogRmVhdHVyZXM6XHJcbiAqIC0gRXhwb25lbnRpYWwgYmFja29mZiBmb3IgcmVjb25uZWN0aW9ucyBvbiB0cmFuc2llbnQgZmFpbHVyZXNcclxuICogLSBJbW1lZGlhdGUgcmVjb25uZWN0IG9uIG5ldHdvcmsgb25saW5lIGV2ZW50c1xyXG4gKiAtIENsZWFucyB1cCBhbGwgdGltZXJzIGFuZCBldmVudCBsaXN0ZW5lcnMgb24gdW5tb3VudFxyXG4gKiAtIEV4cG9zZXMgY29ubmVjdGlvbiBzdGF0dXMgKGNvbm5lY3RpbmcsIGNvbm5lY3RlZCwgcmVjb25uZWN0aW5nLCBkaXNjb25uZWN0ZWQpIGFuZCBsYXN0IGVycm9yIHZpYSBjb250ZXh0XHJcbiAqIC0gR3JhY2VmdWwgZXJyb3IgaGFuZGxpbmc6IG5vbi1jcml0aWNhbCBXZWJTb2NrZXQgZXJyb3JzIGFyZSBsb2dnZWQgYXMgd2FybmluZ3NcclxuICogLSBEZXNpZ25lZCBmb3IgdGVzdGFiaWxpdHk6IGFsbCBjb25uZWN0aW9uIHN0YXRlcyBhbmQgZXJyb3JzIGFyZSBvYnNlcnZhYmxlIGluIGNvbnRleHRcclxuICogLSBTZWN1cml0eTogUHJldmVudHMgbWl4ZWQgY29udGVudCBlcnJvcnMgaW4gZGV2ZWxvcG1lbnRcclxuICpcclxuICogVXNhZ2U6XHJcbiAqICAgY29uc3QgeyBzdGF0dXMsIGxhc3RFcnJvciwgc2VuZE1lc3NhZ2UgfSA9IHVzZVdlYlNvY2tldCgpO1xyXG4gKlxyXG4gKiAgIC8vIHN0YXR1czogJ2Nvbm5lY3RpbmcnIHwgJ2Nvbm5lY3RlZCcgfCAncmVjb25uZWN0aW5nJyB8ICdkaXNjb25uZWN0ZWQnXHJcbiAqICAgLy8gbGFzdEVycm9yOiBzdHJpbmcgfCBudWxsXHJcbiAqXHJcbiAqIFRlc3QgQ292ZXJhZ2U6XHJcbiAqICAgLSBTaW11bGF0ZXMgdHJhbnNpZW50IGNvbm5lY3Rpb24gZmFpbHVyZXMgYW5kIHJlY292ZXJ5XHJcbiAqICAgLSBTaW11bGF0ZXMgbmV0d29yayBvZmZsaW5lL29ubGluZSBldmVudHMgYW5kIGltbWVkaWF0ZSByZWNvbm5lY3RcclxuICogICAtIFZlcmlmaWVzIHN0YXR1cyBhbmQgZXJyb3IgY29udGV4dCB1cGRhdGVzXHJcbiAqXHJcbiAqIFNlZTogV2ViU29ja2V0Q29udGV4dC50ZXN0LnRzeCBmb3IgY29tcHJlaGVuc2l2ZSB0ZXN0IHNjZW5hcmlvcy5cclxuICovXHJcbmltcG9ydCBSZWFjdCwgeyBSZWFjdE5vZGUsIGNyZWF0ZUNvbnRleHQsIHVzZUNvbnRleHQsIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcclxuXHJcbi8qKlxyXG4gKiBXZWJTb2NrZXQgY29ubmVjdGlvbiBzdGF0dXMgdmFsdWVzLlxyXG4gKi9cclxuZXhwb3J0IHR5cGUgV2ViU29ja2V0U3RhdHVzID0gJ2Nvbm5lY3RpbmcnIHwgJ2Nvbm5lY3RlZCcgfCAnZGlzY29ubmVjdGVkJyB8ICdyZWNvbm5lY3RpbmcnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBXZWJTb2NrZXRDb250ZXh0VHlwZSB7XHJcbiAgc3RhdHVzOiBXZWJTb2NrZXRTdGF0dXM7XHJcbiAgY29ubmVjdGVkOiBib29sZWFuO1xyXG4gIGxhc3RFcnJvcjogc3RyaW5nIHwgbnVsbDtcclxuICBzZW5kOiAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xyXG4gIHN1YnNjcmliZTogKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IChkYXRhOiB1bmtub3duKSA9PiB2b2lkKSA9PiB2b2lkO1xyXG4gIHVuc3Vic2NyaWJlOiAoZXZlbnQ6IHN0cmluZywgaGFuZGxlcjogKGRhdGE6IHVua25vd24pID0+IHZvaWQpID0+IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZWFjdCBjb250ZXh0IGZvciBXZWJTb2NrZXQgc3RhdGUgYW5kIG1lc3NhZ2luZy5cclxuICovXHJcbmNvbnN0IF9XZWJTb2NrZXRDb250ZXh0ID0gY3JlYXRlQ29udGV4dDxXZWJTb2NrZXRDb250ZXh0VHlwZSB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcclxuZXhwb3J0IHsgX1dlYlNvY2tldENvbnRleHQgfTtcclxuXHJcbi8qKlxyXG4gKiBXZWJTb2NrZXRQcm92aWRlciBjb21wb25lbnQuXHJcbiAqIFdyYXAgeW91ciBhcHAgd2l0aCB0aGlzIHByb3ZpZGVyIHRvIGVuYWJsZSBXZWJTb2NrZXQgdXRpbGl0aWVzLlxyXG4gKiBAcGFyYW0ge29iamVjdH0gcHJvcHMgLSBSZWFjdCBjaGlsZHJlbi5cclxuICogQHJldHVybnMge0pTWC5FbGVtZW50fSBUaGUgcHJvdmlkZXIgY29tcG9uZW50LlxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IF9XZWJTb2NrZXRQcm92aWRlcjogUmVhY3QuRkM8eyBjaGlsZHJlbjogUmVhY3ROb2RlIH0+ID0gKHsgY2hpbGRyZW4gfSkgPT4ge1xyXG4gIGNvbnN0IFtzdGF0dXMsIHNldFN0YXR1c10gPSB1c2VTdGF0ZTxXZWJTb2NrZXRTdGF0dXM+KCdkaXNjb25uZWN0ZWQnKTtcclxuICBjb25zdCBbY29ubmVjdGVkLCBzZXRDb25uZWN0ZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG4gIGNvbnN0IFtsYXN0RXJyb3IsIHNldExhc3RFcnJvcl0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcclxuICBjb25zdCB2ZXJib3NlTG9nZ2luZyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xyXG4gIGNvbnN0IF93c1JlZiA9IHVzZVJlZjxXZWJTb2NrZXQgfCBudWxsPihudWxsKTtcclxuICBjb25zdCBfaGFuZGxlcnMgPSB1c2VSZWY8UmVjb3JkPHN0cmluZywgKChkYXRhOiB1bmtub3duKSA9PiB2b2lkKVtdPj4oe30pO1xyXG4gIGNvbnN0IHJlY29ubmVjdEF0dGVtcHRzID0gdXNlUmVmKDApO1xyXG4gIGNvbnN0IHJlY29ubmVjdFRpbWVvdXQgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQgfCBudWxsPihudWxsKTtcclxuICBjb25zdCBvbmxpbmVMaXN0ZW5lciA9IHVzZVJlZjwoKCkgPT4gdm9pZCkgfCBudWxsPihudWxsKTtcclxuICBjb25zdCBvZmZsaW5lTGlzdGVuZXIgPSB1c2VSZWY8KCgpID0+IHZvaWQpIHwgbnVsbD4obnVsbCk7XHJcbiAgY29uc3QgaXNVbm1vdW50ZWQgPSB1c2VSZWYoZmFsc2UpO1xyXG5cclxuICAvLyBIZWxwZXIgdG8gZ2V0IHRoZSBXZWJTb2NrZXQgVVJMIHdpdGggc2VjdXJpdHkgY29uc2lkZXJhdGlvbnNcclxuICBjb25zdCBnZXRXZWJTb2NrZXRVcmwgPSAoKSA9PiB7XHJcbiAgICAvLyBDaGVjayBpZiBXZWJTb2NrZXQgaXMgZXhwbGljaXRseSBkaXNhYmxlZFxyXG4gICAgY29uc3Qgd3NFbmFibGVkID0gKCgpID0+IHtcclxuICAgICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudj8uVklURV9XRUJTT0NLRVRfRU5BQkxFRCkge1xyXG4gICAgICAgIHJldHVybiBwcm9jZXNzLmVudi5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEID09PSAndHJ1ZSc7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICh3aW5kb3cgYXMgYW55KS5fX1ZJVEVfRU5WX18/LlZJVEVfV0VCU09DS0VUX0VOQUJMRUQpIHtcclxuICAgICAgICByZXR1cm4gKHdpbmRvdyBhcyBhbnkpLl9fVklURV9FTlZfXy5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEID09PSAndHJ1ZSc7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSkoKTtcclxuICAgIGlmICghd3NFbmFibGVkKSB7XHJcbiAgICAgIHJldHVybiBudWxsOyAvLyBTaWduYWwgdGhhdCBXZWJTb2NrZXQgc2hvdWxkIG5vdCBiZSB1c2VkXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgIC8vIEluIGRldmVsb3BtZW50LCBjb25uZWN0IHRvIGJhY2tlbmQgcG9ydCA4MDAwXHJcbiAgICAgIHJldHVybiAnd3M6Ly9sb2NhbGhvc3Q6ODAwMC93cy9jbGllbnQnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW4gcHJvZHVjdGlvbiwgdXNlIHNlY3VyZSBXZWJTb2NrZXRcclxuICAgICAgY29uc3QgYmFzZVVybCA9ICgoKSA9PiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudj8uVklURV9XU19VUkwpIHtcclxuICAgICAgICAgIHJldHVybiBwcm9jZXNzLmVudi5WSVRFX1dTX1VSTDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICh3aW5kb3cgYXMgYW55KS5fX1ZJVEVfRU5WX18/LlZJVEVfV1NfVVJMKSB7XHJcbiAgICAgICAgICByZXR1cm4gKHdpbmRvdyBhcyBhbnkpLl9fVklURV9FTlZfXy5WSVRFX1dTX1VSTDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgfSkoKTtcclxuICAgICAgaWYgKGJhc2VVcmwpIHtcclxuICAgICAgICAvLyBFbnN1cmUgd2UgdXNlIHdzczovLyBmb3Igc2VjdXJlIGNvbm5lY3Rpb25zIGluIHByb2R1Y3Rpb25cclxuICAgICAgICByZXR1cm4gYmFzZVVybC5yZXBsYWNlKC9ed3M6LywgJ3dzczonKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBGYWxsYmFjayB0byBjdXJyZW50IHByb3RvY29sXHJcbiAgICAgIGNvbnN0IHByb3RvY29sID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6JyA6ICd3czonO1xyXG4gICAgICByZXR1cm4gYCR7cHJvdG9jb2x9Ly8ke3dpbmRvdy5sb2NhdGlvbi5ob3N0fS93c2A7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLy8gUm9idXN0IGNvbm5lY3QgbG9naWMgd2l0aCBleHBvbmVudGlhbCBiYWNrb2ZmIGFuZCBlcnJvciB0cmFja2luZ1xyXG4gIGNvbnN0IGNvbm5lY3RXZWJTb2NrZXQgPSBSZWFjdC51c2VDYWxsYmFjaygoaXNSZWNvbm5lY3Rpb24gPSBmYWxzZSkgPT4ge1xyXG4gICAgY29uc3QgX3dzVXJsID0gZ2V0V2ViU29ja2V0VXJsKCk7XHJcblxyXG4gICAgLy8gSWYgV2ViU29ja2V0IFVSTCBpcyBudWxsLCBpdCBtZWFucyBXZWJTb2NrZXQgaXMgZGlzYWJsZWRcclxuICAgIGlmICghX3dzVXJsKSB7XHJcbiAgICAgIHNldFN0YXR1cygnZGlzY29ubmVjdGVkJyk7XHJcbiAgICAgIHNldENvbm5lY3RlZChmYWxzZSk7XHJcbiAgICAgIHNldExhc3RFcnJvcignV2ViU29ja2V0IGRpc2FibGVkIGluIGNvbmZpZ3VyYXRpb24nKTtcclxuICAgICAgaWYgKHZlcmJvc2VMb2dnaW5nKSBjb25zb2xlLmxvZygnW1dlYlNvY2tldF0gQ29ubmVjdGlvbiBkaXNhYmxlZCB2aWEgY29uZmlndXJhdGlvbicpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3RhdHVzKHJlY29ubmVjdEF0dGVtcHRzLmN1cnJlbnQgPiAwIHx8IGlzUmVjb25uZWN0aW9uID8gJ3JlY29ubmVjdGluZycgOiAnY29ubmVjdGluZycpO1xyXG4gICAgc2V0TGFzdEVycm9yKG51bGwpO1xyXG5cclxuICAgIGlmICh2ZXJib3NlTG9nZ2luZykgY29uc29sZS5kZWJ1ZyhgW1dlYlNvY2tldF0gQ29ubmVjdGluZyB0bzogJHtfd3NVcmx9YCk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3dzID0gbmV3IFdlYlNvY2tldChfd3NVcmwpO1xyXG4gICAgICBfd3NSZWYuY3VycmVudCA9IF93cztcclxuXHJcbiAgICAgIF93cy5vbm9wZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHZlcmJvc2VMb2dnaW5nKSBjb25zb2xlLmRlYnVnKGBbV2ViU29ja2V0XSBDb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5IHRvOiAke193c1VybH1gKTtcclxuICAgICAgICBzZXRDb25uZWN0ZWQodHJ1ZSk7XHJcbiAgICAgICAgc2V0U3RhdHVzKCdjb25uZWN0ZWQnKTtcclxuICAgICAgICBzZXRMYXN0RXJyb3IobnVsbCk7XHJcbiAgICAgICAgcmVjb25uZWN0QXR0ZW1wdHMuY3VycmVudCA9IDA7XHJcbiAgICAgICAgLy8gU2VuZCBhIHBpbmcgdG8gdmVyaWZ5IGNvbm5lY3Rpb24gaXMgd29ya2luZ1xyXG4gICAgICAgIGlmIChfd3MucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgICAgIF93cy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgZXZlbnQ6ICdwaW5nJywgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBfd3Mub25jbG9zZSA9IGV2ZW50ID0+IHtcclxuICAgICAgICBpZiAodmVyYm9zZUxvZ2dpbmcpXHJcbiAgICAgICAgICBjb25zb2xlLmRlYnVnKGBbV2ViU29ja2V0XSBDb25uZWN0aW9uIGNsb3NlZDpgLCBldmVudC5jb2RlLCBldmVudC5yZWFzb24sIGV2ZW50Lndhc0NsZWFuKTtcclxuICAgICAgICBzZXRDb25uZWN0ZWQoZmFsc2UpO1xyXG4gICAgICAgIHNldFN0YXR1cygnZGlzY29ubmVjdGVkJyk7XHJcbiAgICAgICAgaWYgKCFpc1VubW91bnRlZC5jdXJyZW50ICYmIGV2ZW50LmNvZGUgIT09IDEwMDApIHtcclxuICAgICAgICAgIC8vIEV4cG9uZW50aWFsIGJhY2tvZmYgZm9yIHJlY29ubmVjdGlvbiB3aXRoIG1heGltdW0gYXR0ZW1wdHNcclxuICAgICAgICAgIGlmIChyZWNvbm5lY3RBdHRlbXB0cy5jdXJyZW50IDwgMTApIHtcclxuICAgICAgICAgICAgY29uc3QgZGVsYXkgPSBNYXRoLm1pbigxMDAwICogMiAqKiByZWNvbm5lY3RBdHRlbXB0cy5jdXJyZW50LCAzMDAwMCk7XHJcbiAgICAgICAgICAgIHJlY29ubmVjdEF0dGVtcHRzLmN1cnJlbnQgKz0gMTtcclxuICAgICAgICAgICAgaWYgKHJlY29ubmVjdFRpbWVvdXQuY3VycmVudCkgY2xlYXJUaW1lb3V0KHJlY29ubmVjdFRpbWVvdXQuY3VycmVudCk7XHJcbiAgICAgICAgICAgIHJlY29ubmVjdFRpbWVvdXQuY3VycmVudCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHNldFN0YXR1cygncmVjb25uZWN0aW5nJyk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtXZWJTb2NrZXRdIFJlY29ubmVjdGluZy4uLiAoYXR0ZW1wdCAke3JlY29ubmVjdEF0dGVtcHRzLmN1cnJlbnR9KWApO1xyXG4gICAgICAgICAgICAgIGNvbm5lY3RXZWJTb2NrZXQodHJ1ZSk7XHJcbiAgICAgICAgICAgIH0sIGRlbGF5KTtcclxuICAgICAgICAgICAgc2V0TGFzdEVycm9yKFxyXG4gICAgICAgICAgICAgIGBEaXNjb25uZWN0ZWQuIEF0dGVtcHRpbmcgdG8gcmVjb25uZWN0IGluICR7ZGVsYXkgLyAxMDAwfXMgKGF0dGVtcHQgJHtcclxuICAgICAgICAgICAgICAgIHJlY29ubmVjdEF0dGVtcHRzLmN1cnJlbnRcclxuICAgICAgICAgICAgICB9KWBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNldExhc3RFcnJvcignTWF4aW11bSByZWNvbm5lY3Rpb24gYXR0ZW1wdHMgcmVhY2hlZC4gR2l2aW5nIHVwLicpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbV2ViU29ja2V0XSBNYXhpbXVtIHJlY29ubmVjdGlvbiBhdHRlbXB0cyByZWFjaGVkLiBHaXZpbmcgdXAuJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgX3dzLm9uZXJyb3IgPSBlcnJvciA9PiB7XHJcbiAgICAgICAgc2V0Q29ubmVjdGVkKGZhbHNlKTtcclxuICAgICAgICBzZXRTdGF0dXMoJ2Rpc2Nvbm5lY3RlZCcpO1xyXG4gICAgICAgIHNldExhc3RFcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gZXJyb3InKTtcclxuICAgICAgICBpZiAodmVyYm9zZUxvZ2dpbmcpXHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oYFtXZWJTb2NrZXRdIENvbm5lY3Rpb24gZXJyb3IgKG5vbi1jcml0aWNhbCwgYXBwIHdpbGwgY29udGludWUpOmAsIGVycm9yKTtcclxuXHJcbiAgICAgICAgLy8gSGFuZGxlIFdlYlNvY2tldCBlcnJvcnMgZ3JhY2VmdWxseSB0byBwcmV2ZW50IHVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbnNcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgaWYgKF93cy5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuQ09OTkVDVElORykge1xyXG4gICAgICAgICAgICAvLyBDbG9zZSB0aGUgY29ubmVjdGlvbiBpZiBpdCdzIHN0aWxsIHRyeWluZyB0byBjb25uZWN0XHJcbiAgICAgICAgICAgIF93cy5jbG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGNsb3NlRXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybignW1dlYlNvY2tldF0gRXJyb3IgZHVyaW5nIGNsZWFudXA6JywgY2xvc2VFcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgX3dzLm9ubWVzc2FnZSA9IGV2ZW50ID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgLy8gT25seSBwYXJzZSBpZiBtZXNzYWdlIGxvb2tzIGxpa2UgSlNPTlxyXG4gICAgICAgICAgaWYgKGV2ZW50LmRhdGEgJiYgdHlwZW9mIGV2ZW50LmRhdGEgPT09ICdzdHJpbmcnICYmIGV2ZW50LmRhdGEudHJpbSgpLnN0YXJ0c1dpdGgoJ3snKSkge1xyXG4gICAgICAgICAgICBjb25zdCBfZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgIC8vIFN1cHBvcnQgYm90aCAnZXZlbnQnIGFuZCAndHlwZScgZmllbGRzIGZvciBjb21wYXRpYmlsaXR5XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50VHlwZSA9IF9kYXRhLmV2ZW50IHx8IF9kYXRhLnR5cGU7XHJcbiAgICAgICAgICAgIGlmIChldmVudFR5cGUgJiYgX2hhbmRsZXJzLmN1cnJlbnRbZXZlbnRUeXBlXSkge1xyXG4gICAgICAgICAgICAgIF9oYW5kbGVycy5jdXJyZW50W2V2ZW50VHlwZV0uZm9yRWFjaChmbiA9PiBmbihfZGF0YS5wYXlsb2FkKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gVmFsaWQgSlNPTiBidXQgbm8gaGFuZGxlciBmb3IgZXZlbnQvdHlwZVxyXG4gICAgICAgICAgICAgIGlmICh2ZXJib3NlTG9nZ2luZykgY29uc29sZS53YXJuKCdXZWJTb2NrZXQgcmVjZWl2ZWQgdW5oYW5kbGVkIEpTT04gbWVzc2FnZTonLCBfZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIE5vbi1KU09OIG1lc3NhZ2UsIGxvZyBhcyB3YXJuaW5nIGFuZCBza2lwXHJcbiAgICAgICAgICAgIGlmICh2ZXJib3NlTG9nZ2luZykgY29uc29sZS53YXJuKCdXZWJTb2NrZXQgcmVjZWl2ZWQgbm9uLUpTT04gbWVzc2FnZTonLCBldmVudC5kYXRhKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBzZXRMYXN0RXJyb3IoJ1dlYlNvY2tldCBtZXNzYWdlIGVycm9yJyk7XHJcbiAgICAgICAgICBpZiAodmVyYm9zZUxvZ2dpbmcpXHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignV2ViU29ja2V0IG1lc3NhZ2UgcGFyc2UgZXJyb3IgKG5vbi1jcml0aWNhbCk6JywgZSwgZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoY29ubmVjdGlvbkVycm9yKSB7XHJcbiAgICAgIC8vIEhhbmRsZSBXZWJTb2NrZXQgY3JlYXRpb24gZXJyb3JzIChlLmcuLCBtaXhlZCBjb250ZW50IGlzc3VlcylcclxuICAgICAgc2V0Q29ubmVjdGVkKGZhbHNlKTtcclxuICAgICAgc2V0U3RhdHVzKCdkaXNjb25uZWN0ZWQnKTtcclxuICAgICAgc2V0TGFzdEVycm9yKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBibG9ja2VkIC0gbWl4ZWQgY29udGVudCBvciBzZWN1cml0eSBpc3N1ZScpO1xyXG4gICAgICBpZiAodmVyYm9zZUxvZ2dpbmcpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ1tXZWJTb2NrZXRdIENvbm5lY3Rpb24gY3JlYXRpb24gZmFpbGVkIChub24tY3JpdGljYWwpOicsIGNvbm5lY3Rpb25FcnJvcik7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gIH0sIFt2ZXJib3NlTG9nZ2luZ10pO1xyXG5cclxuICAvLyBTZXR1cCBhbmQgY2xlYW51cCBlZmZlY3RcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaXNVbm1vdW50ZWQuY3VycmVudCA9IGZhbHNlO1xyXG5cclxuICAgIC8vIE9ubHkgY29ubmVjdCBpZiBXZWJTb2NrZXQgc2VydmVyIGlzIGV4cGxpY2l0bHkgZW5hYmxlZFxyXG4gICAgY29uc3Qgd3NFbmFibGVkID0gKCgpID0+IHtcclxuICAgICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudj8uVklURV9XRUJTT0NLRVRfRU5BQkxFRCkge1xyXG4gICAgICAgIHJldHVybiBwcm9jZXNzLmVudi5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEID09PSAndHJ1ZSc7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICh3aW5kb3cgYXMgYW55KS5fX1ZJVEVfRU5WX18/LlZJVEVfV0VCU09DS0VUX0VOQUJMRUQpIHtcclxuICAgICAgICByZXR1cm4gKHdpbmRvdyBhcyBhbnkpLl9fVklURV9FTlZfXy5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEID09PSAndHJ1ZSc7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSkoKTtcclxuICAgIGlmICh3c0VuYWJsZWQpIHtcclxuICAgICAgY29ubmVjdFdlYlNvY2tldCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gU2V0IHRvIGRpc2Nvbm5lY3RlZCBzdGF0ZSB3aXRob3V0IGF0dGVtcHRpbmcgY29ubmVjdGlvblxyXG4gICAgICBzZXRTdGF0dXMoJ2Rpc2Nvbm5lY3RlZCcpO1xyXG4gICAgICBzZXRDb25uZWN0ZWQoZmFsc2UpO1xyXG4gICAgICBzZXRMYXN0RXJyb3IoJ1dlYlNvY2tldCBkaXNhYmxlZCBpbiBjb25maWd1cmF0aW9uJyk7XHJcbiAgICAgIGlmICh2ZXJib3NlTG9nZ2luZykgY29uc29sZS5sb2coJ1tXZWJTb2NrZXRdIENvbm5lY3Rpb24gZGlzYWJsZWQgdmlhIGNvbmZpZ3VyYXRpb24nKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbW1lZGlhdGUgcmVjb25uZWN0IG9uIG5ldHdvcmsgY2hhbmdlc1xyXG4gICAgY29uc3QgaGFuZGxlT25saW5lID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCB3c0VuYWJsZWQgPSAoKCkgPT4ge1xyXG4gICAgICAgIGlmICh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvY2Vzcy5lbnY/LlZJVEVfV0VCU09DS0VUX0VOQUJMRUQpIHtcclxuICAgICAgICAgIHJldHVybiBwcm9jZXNzLmVudi5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEID09PSAndHJ1ZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiAod2luZG93IGFzIGFueSkuX19WSVRFX0VOVl9fPy5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEKSB7XHJcbiAgICAgICAgICByZXR1cm4gKHdpbmRvdyBhcyBhbnkpLl9fVklURV9FTlZfXy5WSVRFX1dFQlNPQ0tFVF9FTkFCTEVEID09PSAndHJ1ZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfSkoKTtcclxuICAgICAgaWYgKCFjb25uZWN0ZWQgJiYgd3NFbmFibGVkKSB7XHJcbiAgICAgICAgc2V0U3RhdHVzKCdyZWNvbm5lY3RpbmcnKTtcclxuICAgICAgICBzZXRMYXN0RXJyb3IobnVsbCk7XHJcbiAgICAgICAgcmVjb25uZWN0QXR0ZW1wdHMuY3VycmVudCA9IDA7XHJcbiAgICAgICAgaWYgKHJlY29ubmVjdFRpbWVvdXQuY3VycmVudCkgY2xlYXJUaW1lb3V0KHJlY29ubmVjdFRpbWVvdXQuY3VycmVudCk7XHJcbiAgICAgICAgY29ubmVjdFdlYlNvY2tldCh0cnVlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGhhbmRsZU9mZmxpbmUgPSAoKSA9PiB7XHJcbiAgICAgIHNldFN0YXR1cygnZGlzY29ubmVjdGVkJyk7XHJcbiAgICAgIHNldExhc3RFcnJvcignTmV0d29yayBvZmZsaW5lJyk7XHJcbiAgICAgIGlmIChfd3NSZWYuY3VycmVudCkgX3dzUmVmLmN1cnJlbnQuY2xvc2UoKTtcclxuICAgIH07XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgaGFuZGxlT25saW5lKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgaGFuZGxlT2ZmbGluZSk7XHJcbiAgICBvbmxpbmVMaXN0ZW5lci5jdXJyZW50ID0gaGFuZGxlT25saW5lO1xyXG4gICAgb2ZmbGluZUxpc3RlbmVyLmN1cnJlbnQgPSBoYW5kbGVPZmZsaW5lO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlzVW5tb3VudGVkLmN1cnJlbnQgPSB0cnVlO1xyXG4gICAgICBpZiAoX3dzUmVmLmN1cnJlbnQpIF93c1JlZi5jdXJyZW50LmNsb3NlKCk7XHJcbiAgICAgIGlmIChyZWNvbm5lY3RUaW1lb3V0LmN1cnJlbnQpIGNsZWFyVGltZW91dChyZWNvbm5lY3RUaW1lb3V0LmN1cnJlbnQpO1xyXG4gICAgICBpZiAob25saW5lTGlzdGVuZXIuY3VycmVudCkgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29ubGluZScsIG9ubGluZUxpc3RlbmVyLmN1cnJlbnQpO1xyXG4gICAgICBpZiAob2ZmbGluZUxpc3RlbmVyLmN1cnJlbnQpIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgb2ZmbGluZUxpc3RlbmVyLmN1cnJlbnQpO1xyXG4gICAgfTtcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcclxuICB9LCBbXSk7XHJcblxyXG4gIGNvbnN0IF9zZW5kID0gKG1zZzogdW5rbm93bikgPT4ge1xyXG4gICAgaWYgKF93c1JlZi5jdXJyZW50ICYmIGNvbm5lY3RlZCkge1xyXG4gICAgICBfd3NSZWYuY3VycmVudC5zZW5kKEpTT04uc3RyaW5naWZ5KG1zZykpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IF9zdWJzY3JpYmUgPSAoZXZlbnQ6IHN0cmluZywgaGFuZGxlcjogKGRhdGE6IHVua25vd24pID0+IHZvaWQpID0+IHtcclxuICAgIGlmICghX2hhbmRsZXJzLmN1cnJlbnRbZXZlbnRdKSBfaGFuZGxlcnMuY3VycmVudFtldmVudF0gPSBbXTtcclxuICAgIF9oYW5kbGVycy5jdXJyZW50W2V2ZW50XS5wdXNoKGhhbmRsZXIpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IF91bnN1YnNjcmliZSA9IChldmVudDogc3RyaW5nLCBoYW5kbGVyOiAoZGF0YTogdW5rbm93bikgPT4gdm9pZCkgPT4ge1xyXG4gICAgaWYgKF9oYW5kbGVycy5jdXJyZW50W2V2ZW50XSkge1xyXG4gICAgICBfaGFuZGxlcnMuY3VycmVudFtldmVudF0gPSBfaGFuZGxlcnMuY3VycmVudFtldmVudF0uZmlsdGVyKGZuID0+IGZuICE9PSBoYW5kbGVyKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPF9XZWJTb2NrZXRDb250ZXh0LlByb3ZpZGVyXHJcbiAgICAgIHZhbHVlPXt7XHJcbiAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgIGNvbm5lY3RlZCxcclxuICAgICAgICBsYXN0RXJyb3IsXHJcbiAgICAgICAgc2VuZDogX3NlbmQsXHJcbiAgICAgICAgc3Vic2NyaWJlOiBfc3Vic2NyaWJlLFxyXG4gICAgICAgIHVuc3Vic2NyaWJlOiBfdW5zdWJzY3JpYmUsXHJcbiAgICAgIH19XHJcbiAgICA+XHJcbiAgICAgIHtjaGlsZHJlbn1cclxuICAgIDwvX1dlYlNvY2tldENvbnRleHQuUHJvdmlkZXI+XHJcbiAgKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiB1c2VXZWJTb2NrZXRcclxuICogQWNjZXNzIHRoZSBXZWJTb2NrZXQgY29udGV4dCBpbiBhbnkgY29tcG9uZW50LlxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IF91c2VXZWJTb2NrZXQgPSAoKSA9PiB7XHJcbiAgY29uc3QgX2N0eCA9IHVzZUNvbnRleHQoX1dlYlNvY2tldENvbnRleHQpO1xyXG4gIGlmICghX2N0eCkgdGhyb3cgbmV3IEVycm9yKCd1c2VXZWJTb2NrZXQgbXVzdCBiZSB1c2VkIHdpdGhpbiBXZWJTb2NrZXRQcm92aWRlcicpO1xyXG4gIHJldHVybiBfY3R4O1xyXG59O1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQTJCQSxJQUFBQSxNQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFBaUcsSUFBQUMsV0FBQSxHQUFBRCxPQUFBO0FBQUEsU0FBQUQsd0JBQUFHLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFMLHVCQUFBLFlBQUFBLENBQUFHLENBQUEsRUFBQUMsQ0FBQSxTQUFBQSxDQUFBLElBQUFELENBQUEsSUFBQUEs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