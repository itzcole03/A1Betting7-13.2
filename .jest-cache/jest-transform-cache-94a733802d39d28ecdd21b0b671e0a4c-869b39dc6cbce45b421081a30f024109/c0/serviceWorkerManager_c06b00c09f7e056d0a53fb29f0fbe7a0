c603b2f01fe4361614def7b4121deacd
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serviceWorkerManager = exports.default = void 0;
exports.useServiceWorkerUpdate = useServiceWorkerUpdate;
var _react = _interopRequireDefault(require("react"));
var _enhancedLogger = require("../utils/enhancedLogger");
/**
 * Service Worker Registration - 2025 Best Practices
 *
 * Features:
 * - Automatic registration with update detection
 * - User-friendly update prompts
 * - Background sync capability
 * - Push notification support
 */

class ServiceWorkerManager {
  constructor() {
    this.registration = null;
    this.updateCallbacks = new Set();
    this.state = {
      hasUpdate: false,
      newWorker: null,
      isInstalling: false,
      error: null
    };
  }
  /**
   * Register the service worker with automatic update detection
   */
  async register() {
    if (!('serviceWorker' in navigator)) {
      _enhancedLogger.enhancedLogger.warn('ServiceWorker', 'register', 'Not supported in this browser');
      return null;
    }
    try {
      _enhancedLogger.enhancedLogger.info('ServiceWorker', 'register', 'Registering with 2025 best practices...');
      const registration = await navigator.serviceWorker.register('/sw.js', {
        scope: '/',
        updateViaCache: 'none' // Always check for updates
      });
      this.registration = registration;

      // Set up update detection
      this.setupUpdateHandling(registration);

      // Enable background sync
      this.enableBackgroundSync(registration);

      // Track registration success
      _enhancedLogger.enhancedLogger.info('ServiceWorker', 'register', 'Registration tracking: success');
      _enhancedLogger.enhancedLogger.info('ServiceWorker', 'register', 'Successfully registered');
      return registration;
    } catch (error) {
      _enhancedLogger.enhancedLogger.error('ServiceWorker', 'register', 'Registration failed', undefined, error);
      _enhancedLogger.enhancedLogger.warn('ServiceWorker', 'register', 'Registration tracking: error');
      this.updateState({
        error: `Registration failed: ${error instanceof Error ? error.message : 'Unknown error'}`
      });
      return null;
    }
  }

  /**
   * Set up update detection and handling
   */
  setupUpdateHandling(registration) {
    // Check for updates periodically
    setInterval(() => {
      registration.update().catch(e => _enhancedLogger.enhancedLogger.error('ServiceWorker', 'update', 'Update failed', undefined, e));
    }, 60000); // Check every minute

    // Handle installation of new service worker
    registration.addEventListener('updatefound', () => {
      const newWorker = registration.installing;
      if (!newWorker) return;
      _enhancedLogger.enhancedLogger.info('ServiceWorker', 'updatefound', 'New version found, installing...');
      this.updateState({
        isInstalling: true,
        newWorker
      });
      newWorker.addEventListener('statechange', () => {
        if (newWorker.state === 'installed') {
          if (navigator.serviceWorker.controller) {
            // New version available
            _enhancedLogger.enhancedLogger.info('ServiceWorker', 'update', 'New version ready');
            this.updateState({
              hasUpdate: true,
              isInstalling: false,
              newWorker
            });
          } else {
            // First time installation
            _enhancedLogger.enhancedLogger.info('ServiceWorker', 'update', 'App is ready for offline use');
            this.updateState({
              isInstalling: false
            });
          }
        }
      });
    });

    // Handle controller change (when new SW becomes active)
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      _enhancedLogger.enhancedLogger.info('ServiceWorker', 'controllerchange', 'New version is now controlling the app');
      // Optionally reload the page or show notification
      window.location.reload();
    });
  }

  /**
   * Enable background sync for offline analytics
   */
  enableBackgroundSync(registration) {
    // Check if sync is supported
    if ('sync' in registration) {
      try {
        // Add error handling for sync registration
        const syncManager = registration.sync;
        if (syncManager && typeof syncManager.register === 'function') {
          syncManager.register('analytics-sync').catch(error => {
            _enhancedLogger.enhancedLogger.error('ServiceWorker', 'sync', 'Sync registration failed', undefined, error);
          });
          _enhancedLogger.enhancedLogger.info('ServiceWorker', 'sync', 'Background sync enabled');
        }
      } catch (error) {
        _enhancedLogger.enhancedLogger.warn('ServiceWorker', 'sync', 'Background sync not available', undefined, error);
      }
    }
  }

  /**
   * Apply pending service worker update
   */
  applyUpdate() {
    if (this.state.newWorker) {
      this.state.newWorker.postMessage({
        type: 'SKIP_WAITING'
      });
    }
  }

  /**
   * Subscribe to update notifications
   */
  onUpdate(callback) {
    this.updateCallbacks.add(callback);

    // Immediately call with current state
    callback(this.state);

    // Return unsubscribe function
    return () => {
      this.updateCallbacks.delete(callback);
    };
  }

  /**
   * Request permission for push notifications
   */
  async requestNotificationPermission() {
    if (!('Notification' in window)) {
      throw new Error('Notifications not supported');
    }
    const permission = await Notification.requestPermission();
    if (permission === 'granted' && this.registration) {
      // Subscribe to push notifications
      try {
        const subscription = await this.registration.pushManager.subscribe({
          userVisibleOnly: true,
          // Cast to any to accept various BufferSource implementations across browsers
          applicationServerKey: this.urlBase64ToUint8Array(process.env.VITE_VAPID_PUBLIC_KEY || '')
        });

        // Send subscription to backend
        await fetch('/api/push/subscribe', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(subscription)
        });
        _enhancedLogger.enhancedLogger.info('ServiceWorker', 'push', 'Push notifications enabled');
      } catch (error) {
        _enhancedLogger.enhancedLogger.error('ServiceWorker', 'push', 'Push subscription failed', undefined, error);
      }
    }
    return permission;
  }

  /**
   * Get current registration
   */
  getRegistration() {
    return this.registration;
  }

  /**
   * Update internal state and notify callbacks
   */
  updateState(updates) {
    this.state = {
      ...this.state,
      ...updates
    };
    this.updateCallbacks.forEach(callback => callback(this.state));
  }

  /**
   * Convert VAPID key to Uint8Array
   */
  urlBase64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
    const rawData = window.atob(base64);
    const outputArray = new Uint8Array(rawData.length);
    for (let i = 0; i < rawData.length; ++i) {
      outputArray[i] = rawData.charCodeAt(i);
    }
    return outputArray;
  }
}

// Export singleton instance
const serviceWorkerManager = exports.serviceWorkerManager = new ServiceWorkerManager();

/**
 * React hook for service worker updates
 */
function useServiceWorkerUpdate() {
  const [updateState, setUpdateState] = _react.default.useState({
    hasUpdate: false,
    newWorker: null,
    isInstalling: false,
    error: null
  });
  _react.default.useEffect(() => {
    const unsubscribe = serviceWorkerManager.onUpdate(setUpdateState);
    return unsubscribe;
  }, []);
  const applyUpdate = _react.default.useCallback(() => {
    serviceWorkerManager.applyUpdate();
  }, []);
  const requestNotifications = _react.default.useCallback(() => {
    return serviceWorkerManager.requestNotificationPermission();
  }, []);
  return {
    ...updateState,
    applyUpdate,
    requestNotifications
  };
}
var _default = exports.default = serviceWorkerManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9lbmhhbmNlZExvZ2dlciIsIlNlcnZpY2VXb3JrZXJNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJyZWdpc3RyYXRpb24iLCJ1cGRhdGVDYWxsYmFja3MiLCJTZXQiLCJzdGF0ZSIsImhhc1VwZGF0ZSIsIm5ld1dvcmtlciIsImlzSW5zdGFsbGluZyIsImVycm9yIiwicmVnaXN0ZXIiLCJuYXZpZ2F0b3IiLCJlbmhhbmNlZExvZ2dlciIsIndhcm4iLCJpbmZvIiwic2VydmljZVdvcmtlciIsInNjb3BlIiwidXBkYXRlVmlhQ2FjaGUiLCJzZXR1cFVwZGF0ZUhhbmRsaW5nIiwiZW5hYmxlQmFja2dyb3VuZFN5bmMiLCJ1bmRlZmluZWQiLCJ1cGRhdGVTdGF0ZSIsIkVycm9yIiwibWVzc2FnZSIsInNldEludGVydmFsIiwidXBkYXRlIiwiY2F0Y2giLCJlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImluc3RhbGxpbmciLCJjb250cm9sbGVyIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJzeW5jTWFuYWdlciIsInN5bmMiLCJhcHBseVVwZGF0ZSIsInBvc3RNZXNzYWdlIiwidHlwZSIsIm9uVXBkYXRlIiwiY2FsbGJhY2siLCJhZGQiLCJkZWxldGUiLCJyZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbiIsInBlcm1pc3Npb24iLCJOb3RpZmljYXRpb24iLCJyZXF1ZXN0UGVybWlzc2lvbiIsInN1YnNjcmlwdGlvbiIsInB1c2hNYW5hZ2VyIiwic3Vic2NyaWJlIiwidXNlclZpc2libGVPbmx5IiwiYXBwbGljYXRpb25TZXJ2ZXJLZXkiLCJ1cmxCYXNlNjRUb1VpbnQ4QXJyYXkiLCJwcm9jZXNzIiwiZW52IiwiVklURV9WQVBJRF9QVUJMSUNfS0VZIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRSZWdpc3RyYXRpb24iLCJ1cGRhdGVzIiwiZm9yRWFjaCIsImJhc2U2NFN0cmluZyIsInBhZGRpbmciLCJyZXBlYXQiLCJsZW5ndGgiLCJiYXNlNjQiLCJyZXBsYWNlIiwicmF3RGF0YSIsImF0b2IiLCJvdXRwdXRBcnJheSIsIlVpbnQ4QXJyYXkiLCJpIiwiY2hhckNvZGVBdCIsInNlcnZpY2VXb3JrZXJNYW5hZ2VyIiwiZXhwb3J0cyIsInVzZVNlcnZpY2VXb3JrZXJVcGRhdGUiLCJzZXRVcGRhdGVTdGF0ZSIsIlJlYWN0IiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJ1bnN1YnNjcmliZSIsInVzZUNhbGxiYWNrIiwicmVxdWVzdE5vdGlmaWNhdGlvbnMiLCJfZGVmYXVsdCIsImRlZmF1bHQiXSwic291cmNlcyI6WyJzZXJ2aWNlV29ya2VyTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogU2VydmljZSBXb3JrZXIgUmVnaXN0cmF0aW9uIC0gMjAyNSBCZXN0IFByYWN0aWNlc1xyXG4gKlxyXG4gKiBGZWF0dXJlczpcclxuICogLSBBdXRvbWF0aWMgcmVnaXN0cmF0aW9uIHdpdGggdXBkYXRlIGRldGVjdGlvblxyXG4gKiAtIFVzZXItZnJpZW5kbHkgdXBkYXRlIHByb21wdHNcclxuICogLSBCYWNrZ3JvdW5kIHN5bmMgY2FwYWJpbGl0eVxyXG4gKiAtIFB1c2ggbm90aWZpY2F0aW9uIHN1cHBvcnRcclxuICovXHJcblxyXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyBlbmhhbmNlZExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2VuaGFuY2VkTG9nZ2VyJztcclxuXHJcbmludGVyZmFjZSBTZXJ2aWNlV29ya2VyVXBkYXRlU3RhdGUge1xyXG4gIGhhc1VwZGF0ZTogYm9vbGVhbjtcclxuICBuZXdXb3JrZXI6IFNlcnZpY2VXb3JrZXIgfCBudWxsO1xyXG4gIGlzSW5zdGFsbGluZzogYm9vbGVhbjtcclxuICBlcnJvcjogc3RyaW5nIHwgbnVsbDtcclxufVxyXG5cclxudHlwZSBVcGRhdGVDYWxsYmFjayA9IChzdGF0ZTogU2VydmljZVdvcmtlclVwZGF0ZVN0YXRlKSA9PiB2b2lkO1xyXG5cclxuY2xhc3MgU2VydmljZVdvcmtlck1hbmFnZXIge1xyXG4gIHByaXZhdGUgcmVnaXN0cmF0aW9uOiBTZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSB1cGRhdGVDYWxsYmFja3M6IFNldDxVcGRhdGVDYWxsYmFjaz4gPSBuZXcgU2V0KCk7XHJcbiAgcHJpdmF0ZSBzdGF0ZTogU2VydmljZVdvcmtlclVwZGF0ZVN0YXRlID0ge1xyXG4gICAgaGFzVXBkYXRlOiBmYWxzZSxcclxuICAgIG5ld1dvcmtlcjogbnVsbCxcclxuICAgIGlzSW5zdGFsbGluZzogZmFsc2UsXHJcbiAgICBlcnJvcjogbnVsbCxcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBSZWdpc3RlciB0aGUgc2VydmljZSB3b3JrZXIgd2l0aCBhdXRvbWF0aWMgdXBkYXRlIGRldGVjdGlvblxyXG4gICAqL1xyXG4gIGFzeW5jIHJlZ2lzdGVyKCk6IFByb21pc2U8U2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbiB8IG51bGw+IHtcclxuICAgIGlmICghKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpKSB7XHJcbiAgICAgIGVuaGFuY2VkTG9nZ2VyLndhcm4oJ1NlcnZpY2VXb3JrZXInLCAncmVnaXN0ZXInLCAnTm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXInKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ3JlZ2lzdGVyJywgJ1JlZ2lzdGVyaW5nIHdpdGggMjAyNSBiZXN0IHByYWN0aWNlcy4uLicpO1xyXG5cclxuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycsIHtcclxuICAgICAgICBzY29wZTogJy8nLFxyXG4gICAgICAgIHVwZGF0ZVZpYUNhY2hlOiAnbm9uZScsIC8vIEFsd2F5cyBjaGVjayBmb3IgdXBkYXRlc1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMucmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uO1xyXG5cclxuICAgICAgLy8gU2V0IHVwIHVwZGF0ZSBkZXRlY3Rpb25cclxuICAgICAgdGhpcy5zZXR1cFVwZGF0ZUhhbmRsaW5nKHJlZ2lzdHJhdGlvbik7XHJcblxyXG4gICAgICAvLyBFbmFibGUgYmFja2dyb3VuZCBzeW5jXHJcbiAgICAgIHRoaXMuZW5hYmxlQmFja2dyb3VuZFN5bmMocmVnaXN0cmF0aW9uKTtcclxuXHJcbiAgLy8gVHJhY2sgcmVnaXN0cmF0aW9uIHN1Y2Nlc3NcclxuICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ3JlZ2lzdGVyJywgJ1JlZ2lzdHJhdGlvbiB0cmFja2luZzogc3VjY2VzcycpO1xyXG5cclxuICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ3JlZ2lzdGVyJywgJ1N1Y2Nlc3NmdWxseSByZWdpc3RlcmVkJyk7XHJcbiAgICAgIHJldHVybiByZWdpc3RyYXRpb247XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gIGVuaGFuY2VkTG9nZ2VyLmVycm9yKCdTZXJ2aWNlV29ya2VyJywgJ3JlZ2lzdGVyJywgJ1JlZ2lzdHJhdGlvbiBmYWlsZWQnLCB1bmRlZmluZWQsIGVycm9yIGFzIEVycm9yKTtcclxuICBlbmhhbmNlZExvZ2dlci53YXJuKCdTZXJ2aWNlV29ya2VyJywgJ3JlZ2lzdGVyJywgJ1JlZ2lzdHJhdGlvbiB0cmFja2luZzogZXJyb3InKTtcclxuXHJcbiAgICAgIHRoaXMudXBkYXRlU3RhdGUoe1xyXG4gICAgICAgIGVycm9yOiBgUmVnaXN0cmF0aW9uIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHVwIHVwZGF0ZSBkZXRlY3Rpb24gYW5kIGhhbmRsaW5nXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXR1cFVwZGF0ZUhhbmRsaW5nKHJlZ2lzdHJhdGlvbjogU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbik6IHZvaWQge1xyXG4gICAgLy8gQ2hlY2sgZm9yIHVwZGF0ZXMgcGVyaW9kaWNhbGx5XHJcbiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgcmVnaXN0cmF0aW9uLnVwZGF0ZSgpLmNhdGNoKChlOiBhbnkpID0+IGVuaGFuY2VkTG9nZ2VyLmVycm9yKCdTZXJ2aWNlV29ya2VyJywgJ3VwZGF0ZScsICdVcGRhdGUgZmFpbGVkJywgdW5kZWZpbmVkLCBlIGFzIEVycm9yKSk7XHJcbiAgICB9LCA2MDAwMCk7IC8vIENoZWNrIGV2ZXJ5IG1pbnV0ZVxyXG5cclxuICAgIC8vIEhhbmRsZSBpbnN0YWxsYXRpb24gb2YgbmV3IHNlcnZpY2Ugd29ya2VyXHJcbiAgICByZWdpc3RyYXRpb24uYWRkRXZlbnRMaXN0ZW5lcigndXBkYXRlZm91bmQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld1dvcmtlciA9IHJlZ2lzdHJhdGlvbi5pbnN0YWxsaW5nO1xyXG4gICAgICBpZiAoIW5ld1dvcmtlcikgcmV0dXJuO1xyXG5cclxuICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ3VwZGF0ZWZvdW5kJywgJ05ldyB2ZXJzaW9uIGZvdW5kLCBpbnN0YWxsaW5nLi4uJyk7XHJcblxyXG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtcclxuICAgICAgICBpc0luc3RhbGxpbmc6IHRydWUsXHJcbiAgICAgICAgbmV3V29ya2VyLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG5ld1dvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsICgpID0+IHtcclxuICAgICAgICBpZiAobmV3V29ya2VyLnN0YXRlID09PSAnaW5zdGFsbGVkJykge1xyXG4gICAgICAgICAgaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHtcclxuICAgICAgICAgICAgLy8gTmV3IHZlcnNpb24gYXZhaWxhYmxlXHJcbiAgICAgICAgICAgIGVuaGFuY2VkTG9nZ2VyLmluZm8oJ1NlcnZpY2VXb3JrZXInLCAndXBkYXRlJywgJ05ldyB2ZXJzaW9uIHJlYWR5Jyk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe1xyXG4gICAgICAgICAgICAgIGhhc1VwZGF0ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICBpc0luc3RhbGxpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIG5ld1dvcmtlcixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBGaXJzdCB0aW1lIGluc3RhbGxhdGlvblxyXG4gICAgICAgICAgICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ3VwZGF0ZScsICdBcHAgaXMgcmVhZHkgZm9yIG9mZmxpbmUgdXNlJyk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe1xyXG4gICAgICAgICAgICAgIGlzSW5zdGFsbGluZzogZmFsc2UsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBIYW5kbGUgY29udHJvbGxlciBjaGFuZ2UgKHdoZW4gbmV3IFNXIGJlY29tZXMgYWN0aXZlKVxyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsICgpID0+IHtcclxuICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ2NvbnRyb2xsZXJjaGFuZ2UnLCAnTmV3IHZlcnNpb24gaXMgbm93IGNvbnRyb2xsaW5nIHRoZSBhcHAnKTtcclxuICAgICAgLy8gT3B0aW9uYWxseSByZWxvYWQgdGhlIHBhZ2Ugb3Igc2hvdyBub3RpZmljYXRpb25cclxuICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFbmFibGUgYmFja2dyb3VuZCBzeW5jIGZvciBvZmZsaW5lIGFuYWx5dGljc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZW5hYmxlQmFja2dyb3VuZFN5bmMocmVnaXN0cmF0aW9uOiBTZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uKTogdm9pZCB7XHJcbiAgICAvLyBDaGVjayBpZiBzeW5jIGlzIHN1cHBvcnRlZFxyXG4gICAgaWYgKCdzeW5jJyBpbiByZWdpc3RyYXRpb24pIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcgZm9yIHN5bmMgcmVnaXN0cmF0aW9uXHJcbiAgICAgICAgY29uc3Qgc3luY01hbmFnZXIgPSAocmVnaXN0cmF0aW9uIGFzIGFueSkuc3luYztcclxuICAgICAgICBpZiAoc3luY01hbmFnZXIgJiYgdHlwZW9mIHN5bmNNYW5hZ2VyLnJlZ2lzdGVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICBzeW5jTWFuYWdlci5yZWdpc3RlcignYW5hbHl0aWNzLXN5bmMnKS5jYXRjaCgoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBlbmhhbmNlZExvZ2dlci5lcnJvcignU2VydmljZVdvcmtlcicsICdzeW5jJywgJ1N5bmMgcmVnaXN0cmF0aW9uIGZhaWxlZCcsIHVuZGVmaW5lZCwgZXJyb3IgYXMgRXJyb3IpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBlbmhhbmNlZExvZ2dlci5pbmZvKCdTZXJ2aWNlV29ya2VyJywgJ3N5bmMnLCAnQmFja2dyb3VuZCBzeW5jIGVuYWJsZWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGVuaGFuY2VkTG9nZ2VyLndhcm4oJ1NlcnZpY2VXb3JrZXInLCAnc3luYycsICdCYWNrZ3JvdW5kIHN5bmMgbm90IGF2YWlsYWJsZScsIHVuZGVmaW5lZCwgZXJyb3IgYXMgRXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFwcGx5IHBlbmRpbmcgc2VydmljZSB3b3JrZXIgdXBkYXRlXHJcbiAgICovXHJcbiAgYXBwbHlVcGRhdGUoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5uZXdXb3JrZXIpIHtcclxuICAgICAgdGhpcy5zdGF0ZS5uZXdXb3JrZXIucG9zdE1lc3NhZ2UoeyB0eXBlOiAnU0tJUF9XQUlUSU5HJyB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN1YnNjcmliZSB0byB1cGRhdGUgbm90aWZpY2F0aW9uc1xyXG4gICAqL1xyXG4gIG9uVXBkYXRlKGNhbGxiYWNrOiBVcGRhdGVDYWxsYmFjayk6ICgpID0+IHZvaWQge1xyXG4gICAgdGhpcy51cGRhdGVDYWxsYmFja3MuYWRkKGNhbGxiYWNrKTtcclxuXHJcbiAgICAvLyBJbW1lZGlhdGVseSBjYWxsIHdpdGggY3VycmVudCBzdGF0ZVxyXG4gICAgY2FsbGJhY2sodGhpcy5zdGF0ZSk7XHJcblxyXG4gICAgLy8gUmV0dXJuIHVuc3Vic2NyaWJlIGZ1bmN0aW9uXHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUNhbGxiYWNrcy5kZWxldGUoY2FsbGJhY2spO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlcXVlc3QgcGVybWlzc2lvbiBmb3IgcHVzaCBub3RpZmljYXRpb25zXHJcbiAgICovXHJcbiAgYXN5bmMgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24oKTogUHJvbWlzZTxOb3RpZmljYXRpb25QZXJtaXNzaW9uPiB7XHJcbiAgICBpZiAoISgnTm90aWZpY2F0aW9uJyBpbiB3aW5kb3cpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm90aWZpY2F0aW9ucyBub3Qgc3VwcG9ydGVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGVybWlzc2lvbiA9IGF3YWl0IE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbigpO1xyXG5cclxuICAgIGlmIChwZXJtaXNzaW9uID09PSAnZ3JhbnRlZCcgJiYgdGhpcy5yZWdpc3RyYXRpb24pIHtcclxuICAgICAgLy8gU3Vic2NyaWJlIHRvIHB1c2ggbm90aWZpY2F0aW9uc1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHRoaXMucmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLnN1YnNjcmliZSh7XHJcbiAgICAgICAgICB1c2VyVmlzaWJsZU9ubHk6IHRydWUsXHJcbiAgICAgICAgICAvLyBDYXN0IHRvIGFueSB0byBhY2NlcHQgdmFyaW91cyBCdWZmZXJTb3VyY2UgaW1wbGVtZW50YXRpb25zIGFjcm9zcyBicm93c2Vyc1xyXG4gICAgICAgICAgYXBwbGljYXRpb25TZXJ2ZXJLZXk6IHRoaXMudXJsQmFzZTY0VG9VaW50OEFycmF5KHByb2Nlc3MuZW52LlZJVEVfVkFQSURfUFVCTElDX0tFWSB8fCAnJykgYXMgYW55LFxyXG4gICAgICAgIH0gYXMgYW55KTtcclxuXHJcbiAgICAgICAgLy8gU2VuZCBzdWJzY3JpcHRpb24gdG8gYmFja2VuZFxyXG4gICAgICAgIGF3YWl0IGZldGNoKCcvYXBpL3B1c2gvc3Vic2NyaWJlJywge1xyXG4gICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc3Vic2NyaXB0aW9uKSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgZW5oYW5jZWRMb2dnZXIuaW5mbygnU2VydmljZVdvcmtlcicsICdwdXNoJywgJ1B1c2ggbm90aWZpY2F0aW9ucyBlbmFibGVkJyk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgZW5oYW5jZWRMb2dnZXIuZXJyb3IoJ1NlcnZpY2VXb3JrZXInLCAncHVzaCcsICdQdXNoIHN1YnNjcmlwdGlvbiBmYWlsZWQnLCB1bmRlZmluZWQsIGVycm9yIGFzIEVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwZXJtaXNzaW9uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGN1cnJlbnQgcmVnaXN0cmF0aW9uXHJcbiAgICovXHJcbiAgZ2V0UmVnaXN0cmF0aW9uKCk6IFNlcnZpY2VXb3JrZXJSZWdpc3RyYXRpb24gfCBudWxsIHtcclxuICAgIHJldHVybiB0aGlzLnJlZ2lzdHJhdGlvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBpbnRlcm5hbCBzdGF0ZSBhbmQgbm90aWZ5IGNhbGxiYWNrc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlU3RhdGUodXBkYXRlczogUGFydGlhbDxTZXJ2aWNlV29ya2VyVXBkYXRlU3RhdGU+KTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlID0geyAuLi50aGlzLnN0YXRlLCAuLi51cGRhdGVzIH07XHJcbiAgdGhpcy51cGRhdGVDYWxsYmFja3MuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayh0aGlzLnN0YXRlKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0IFZBUElEIGtleSB0byBVaW50OEFycmF5XHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cmxCYXNlNjRUb1VpbnQ4QXJyYXkoYmFzZTY0U3RyaW5nOiBzdHJpbmcpOiBVaW50OEFycmF5IHtcclxuICAgIGNvbnN0IHBhZGRpbmcgPSAnPScucmVwZWF0KCg0IC0gKGJhc2U2NFN0cmluZy5sZW5ndGggJSA0KSkgJSA0KTtcclxuICAgIGNvbnN0IGJhc2U2NCA9IChiYXNlNjRTdHJpbmcgKyBwYWRkaW5nKS5yZXBsYWNlKC8tL2csICcrJykucmVwbGFjZSgvXy9nLCAnLycpO1xyXG5cclxuICAgIGNvbnN0IHJhd0RhdGEgPSB3aW5kb3cuYXRvYihiYXNlNjQpO1xyXG4gICAgY29uc3Qgb3V0cHV0QXJyYXkgPSBuZXcgVWludDhBcnJheShyYXdEYXRhLmxlbmd0aCk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYXdEYXRhLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgIG91dHB1dEFycmF5W2ldID0gcmF3RGF0YS5jaGFyQ29kZUF0KGkpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvdXRwdXRBcnJheTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcclxuZXhwb3J0IGNvbnN0IHNlcnZpY2VXb3JrZXJNYW5hZ2VyID0gbmV3IFNlcnZpY2VXb3JrZXJNYW5hZ2VyKCk7XHJcblxyXG4vKipcclxuICogUmVhY3QgaG9vayBmb3Igc2VydmljZSB3b3JrZXIgdXBkYXRlc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZVNlcnZpY2VXb3JrZXJVcGRhdGUoKSB7XHJcbiAgY29uc3QgW3VwZGF0ZVN0YXRlLCBzZXRVcGRhdGVTdGF0ZV0gPSBSZWFjdC51c2VTdGF0ZTxTZXJ2aWNlV29ya2VyVXBkYXRlU3RhdGU+KHtcclxuICAgIGhhc1VwZGF0ZTogZmFsc2UsXHJcbiAgICBuZXdXb3JrZXI6IG51bGwsXHJcbiAgICBpc0luc3RhbGxpbmc6IGZhbHNlLFxyXG4gICAgZXJyb3I6IG51bGwsXHJcbiAgfSk7XHJcblxyXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBjb25zdCB1bnN1YnNjcmliZSA9IHNlcnZpY2VXb3JrZXJNYW5hZ2VyLm9uVXBkYXRlKHNldFVwZGF0ZVN0YXRlKTtcclxuICAgIHJldHVybiB1bnN1YnNjcmliZTtcclxuICB9LCBbXSk7XHJcblxyXG4gIGNvbnN0IGFwcGx5VXBkYXRlID0gUmVhY3QudXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgc2VydmljZVdvcmtlck1hbmFnZXIuYXBwbHlVcGRhdGUoKTtcclxuICB9LCBbXSk7XHJcblxyXG4gIGNvbnN0IHJlcXVlc3ROb3RpZmljYXRpb25zID0gUmVhY3QudXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgcmV0dXJuIHNlcnZpY2VXb3JrZXJNYW5hZ2VyLnJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uKCk7XHJcbiAgfSwgW10pO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgLi4udXBkYXRlU3RhdGUsXHJcbiAgICBhcHBseVVwZGF0ZSxcclxuICAgIHJlcXVlc3ROb3RpZmljYXRpb25zLFxyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHNlcnZpY2VXb3JrZXJNYW5hZ2VyO1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBVUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsZUFBQSxHQUFBRCxPQUFBO0FBWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQWNBLE1BQU1FLG9CQUFvQixDQUFDO0VBQUFDLFlBQUE7SUFBQSxLQUNqQkMsWUFBWSxHQUFxQyxJQUFJO0lBQUEsS0FDckRDLGVBQWUsR0FBd0IsSUFBSUMsR0FBRyxDQUFDLENBQUM7SUFBQSxLQUNoREMsS0FBSyxHQUE2QjtNQUN4Q0MsU0FBUyxFQUFFLEtBQUs7TUFDaEJDLFNBQVMsRUFBRSxJQUFJO01BQ2ZDLFlBQVksRUFBRSxLQUFLO01BQ25CQyxLQUFLLEVBQUU7SUFDVCxDQUFDO0VBQUE7RUFFRDtBQUNGO0FBQ0E7RUFDRSxNQUFNQyxRQUFRQSxDQUFBLEVBQThDO0lBQzFELElBQUksRUFBRSxlQUFlLElBQUlD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