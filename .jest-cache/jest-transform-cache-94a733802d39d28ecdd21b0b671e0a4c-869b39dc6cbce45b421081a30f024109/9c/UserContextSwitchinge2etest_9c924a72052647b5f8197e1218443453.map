{"version":3,"names":["_getJestObj","mock","_interopRequireDefault","require","_react","_react2","_axios","_reactRouterDom","_UserFriendlyApp","_jsxRuntime","jest","describe","beforeEach","localStorage","setItem","JSON","stringify","id","email","role","permissions","it","axios","get","mockImplementation","url","includes","Promise","resolve","data","status","render","jsx","MemoryRouter","children","default","expect","screen","findByText","content","node","text","textContent","test","toBeInTheDocument","switchUserButton","findByRole","name","act","click","waitFor","getByText"],"sources":["UserContextSwitching.e2e.test.tsx"],"sourcesContent":["import React from 'react';\r\nimport { act, render, screen, waitFor } from '@testing-library/react';\r\n// Ensure axios is the manual mock for this test\r\njest.mock('axios');\r\nimport axios from 'axios';\r\nimport { MemoryRouter } from 'react-router-dom';\r\nimport UserFriendlyApp from '../components/user-friendly/UserFriendlyApp';\r\n\r\ndescribe('User Context Switching E2E', () => {\r\n  beforeEach(() => {\r\n    localStorage.setItem('onboardingComplete', 'true');\r\n    localStorage.setItem('token', 'test-token');\r\n    localStorage.setItem(\r\n      'user',\r\n      JSON.stringify({\r\n        id: 'test-user',\r\n        email: 'test@example.com',\r\n        role: 'admin',\r\n        permissions: ['admin'],\r\n      })\r\n    );\r\n  });\r\n\r\n  it('switches user context and updates permissions', async () => {\r\n    // Ensure health endpoint resolves so ApiHealthIndicator transitions to 'ok'\r\n    (axios as any).get?.mockImplementation((url: string) => {\r\n      if (typeof url === 'string' && url.includes('/api/v2/health')) {\r\n        return Promise.resolve({ data: { status: 'ok' }, status: 200 });\r\n      }\r\n      return Promise.resolve({ data: {} });\r\n    });\r\n    render(\r\n      <MemoryRouter>\r\n        <UserFriendlyApp />\r\n      </MemoryRouter>\r\n    );\r\n    // Wait for admin dashboard (robust matcher for split/nested nodes)\r\n    expect(\r\n      await screen.findByText((content, node) => {\r\n        const text = node?.textContent || '';\r\n        return /Admin Dashboard|User Management/i.test(text);\r\n      })\r\n    ).toBeInTheDocument();\r\n    // Simulate switching to user role\r\n    const switchUserButton = await screen.findByRole('button', { name: /Switch to User/i });\r\n    act(() => {\r\n      switchUserButton.click();\r\n    });\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/User Dashboard|Betting Interface/i)).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n"],"mappings":";;AAEA;AACAA,WAAA,GAAKC,IAAI,CAAC,OAAO,CAAC;AAAC,IAAAC,sBAAA,GAAAC,OAAA;AAHnB,IAAAC,MAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AAGA,IAAAG,MAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,eAAA,GAAAJ,OAAA;AACA,IAAAK,gBAAA,GAAAN,sBAAA,CAAAC,OAAA;AAA0E,IAAAM,WAAA,GAAAN,OAAA;AAAA,SAAAH,YAAA;EAAA;IAAAU;EAAA,IAAAP,OAAA;EAAAH,WAAA,GAAAA,CAAA,KAAAU,IAAA;EAAA,OAAAA,IAAA;AAAA;AAE1EC,QAAQ,CAAC,4BAA4B,EAAE,MAAM;EAC3CC,UAAU,CAAC,MAAM;IACfC,YAAY,CAACC,OAAO,CAAC,oBAAoB,EAAE,MAAM,CAAC;IAClDD,YAAY,CAACC,OAAO,CAAC,OAAO,EAAE,YAAY,CAAC;IAC3CD,YAAY,CAACC,OAAO,CAClB,MAAM,EACNC,IAAI,CAACC,SAAS,CAAC;MACbC,EAAE,EAAE,WAAW;MACfC,KAAK,EAAE,kBAAkB;MACzBC,IAAI,EAAE,OAAO;MACbC,WAAW,EAAE,CAAC,OAAO;IACvB,CAAC,CACH,CAAC;EACH,CAAC,CAAC;EAEFC,EAAE,CAAC,+CAA+C,EAAE,YAAY;IAC9D;IACCC,cAAK,CAASC,GAAG,EAAEC,kBAAkB,CAAEC,GAAW,IAAK;MACtD,IAAI,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACC,QAAQ,CAAC,gBAAgB,CAAC,EAAE;QAC7D,OAAOC,OAAO,CAACC,OAAO,CAAC;UAAEC,IAAI,EAAE;YAAEC,MAAM,EAAE;UAAK,CAAC;UAAEA,MAAM,EAAE;QAAI,CAAC,CAAC;MACjE;MACA,OAAOH,OAAO,CAACC,OAAO,CAAC;QAAEC,IAAI,EAAE,CAAC;MAAE,CAAC,CAAC;IACtC,CAAC,CAAC;IACF,IAAAE,cAAM,eACJ,IAAAtB,WAAA,CAAAuB,GAAA,EAACzB,eAAA,CAAA0B,YAAY;MAAAC,QAAA,eACX,IAAAzB,WAAA,CAAAuB,GAAA,EAACxB,gBAAA,CAAA2B,OAAe,IAAE;IAAC,CACP,CAChB,CAAC;IACD;IACAC,MAAM,CACJ,MAAMC,cAAM,CAACC,UAAU,CAAC,CAACC,OAAO,EAAEC,IAAI,KAAK;MACzC,MAAMC,IAAI,GAAGD,IAAI,EAAEE,WAAW,IAAI,EAAE;MACpC,OAAO,kCAAkC,CAACC,IAAI,CAACF,IAAI,CAAC;IACtD,CAAC,CACH,CAAC,CAACG,iBAAiB,CAAC,CAAC;IACrB;IACA,MAAMC,gBAAgB,GAAG,MAAMR,cAAM,CAACS,UAAU,CAAC,QAAQ,EAAE;MAAEC,IAAI,EAAE;IAAkB,CAAC,CAAC;IACvF,IAAAC,WAAG,EAAC,MAAM;MACRH,gBAAgB,CAACI,KAAK,CAAC,CAAC;IAC1B,CAAC,CAAC;IACF,MAAM,IAAAC,eAAO,EAAC,MAAM;MAClBd,MAAM,CAACC,cAAM,CAACc,SAAS,CAAC,mCAAmC,CAAC,CAAC,CAACP,iBAAiB,CAAC,CAAC;IACnF,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}