44bf6c211e1a9e7de9719b32a183fda6
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UnifiedStateService = void 0;
var _BaseService = require("./BaseService");
var _UnifiedStateService;
class UnifiedStateService extends _BaseService.BaseService {
  constructor() {
    // @ts-expect-error TS(2554): Expected 2 arguments, but got 1. BaseService expects two arguments, but only one is provided here for singleton pattern compatibility.
    super('UnifiedStateService');
    this.state = {};
    this.listeners = [];
    this.listenerIdCounter = 0;
    this.initializeDefaultState();
  }
  static getInstance() {
    if (!UnifiedStateService.instance) {
      UnifiedStateService.instance = new UnifiedStateService();
    }
    return UnifiedStateService.instance;
  }
  initializeDefaultState() {
    this.state = {
      user: {
        isAuthenticated: false,
        profile: null,
        preferences: {}
      },
      sports: {
        selectedSport: 'nfl',
        activeFilters: {},
        data: {}
      },
      betting: {
        opportunities: [],
        history: [],
        metrics: {}
      },
      ui: {
        theme: 'cyber-dark',
        sidebarOpen: true,
        notifications: []
      },
      system: {
        isOnline: true,
        lastSync: null,
        errors: []
      }
    };
  }
  get(path, defaultValue) {
    const _keys = path.split('.');
    let _current = this.state;
    for (const _key of _keys) {
      if (_current && typeof _current === 'object' && _key in _current) {
        _current = _current[_key];
      } else {
        return defaultValue;
      }
    }
    return _current;
  }
  set(path, value) {
    const _keys = path.split('.');
    const _lastKey = _keys.pop();
    let _current = this.state;

    // Navigate to the parent object
    for (const _key of _keys) {
      if (!(_key in _current) || typeof _current[_key] !== 'object') {
        _current[_key] = {};
      }
      _current = _current[_key];
    }
    const _oldValue = _current[_lastKey];
    _current[_lastKey] = value;
    this.notifyListeners(path, value, _oldValue);
    this.logger.debug('State updated', {
      path,
      value
    });
  }
  update(path, updater) {
    const _currentValue = this.get(path);
    const _newValue = updater(_currentValue);
    this.set(path, _newValue);
  }
  merge(path, partial) {
    const _currentValue = this.get(path, {});
    const _newValue = {
      ..._currentValue,
      ...partial
    };
    this.set(path, _newValue);
  }
  delete(path) {
    const _keys = path.split('.');
    const _lastKey = _keys.pop();
    let _current = this.state;
    for (const _key of _keys) {
      if (!(_key in _current) || typeof _current[_key] !== 'object') {
        return; // Path doesn't exist
      }
      _current = _current[_key];
    }
    const _oldValue = _current[_lastKey];
    delete _current[_lastKey];
    this.notifyListeners(path, undefined, _oldValue);
    this.logger.debug('State deleted', {
      path
    });
  }
  subscribe(path, callback) {
    const _id = `listener_${++this.listenerIdCounter}`;
    this.listeners.push({
      id: _id,
      path,
      callback
    });
    this.logger.debug('State listener added', {
      id: _id,
      path
    });
    return _id;
  }
  unsubscribe(listenerId) {
    const _index = this.listeners.findIndex(l => l.id === listenerId);
    if (_index >= 0) {
      this.listeners.splice(_index, 1);
      this.logger.debug('State listener removed', {
        listenerId
      });
    }
  }
  notifyListeners(changedPath, newValue, oldValue) {
    for (const _listener of this.listeners) {
      if (this.pathMatches(changedPath, _listener.path)) {
        try {
          _listener.callback(newValue, oldValue);
        } catch (error) {
          this.logger.error('State listener error', {
            listenerId: _listener.id,
            path: _listener.path,
            error
          });
        }
      }
    }
  }
  pathMatches(changedPath, listenerPath) {
    // Exact match
    if (changedPath === listenerPath) return true;

    // Parent path change affects child listeners
    if (changedPath.length < listenerPath.length) {
      return listenerPath.startsWith(changedPath + '.');
    }

    // Child path change affects parent listeners
    if (changedPath.length > listenerPath.length) {
      return changedPath.startsWith(listenerPath + '.');
    }
    return false;
  }
  getState() {
    return JSON.parse(JSON.stringify(this.state));
  }
  setState(newState) {
    const _oldState = this.state;
    this.state = newState;

    // Notify all listeners that root state changed
    this.notifyListeners('', newState, _oldState);
    this.logger.info('Full state replaced');
  }
  reset() {
    this.initializeDefaultState();
    this.listeners = [];
    this.logger.info('State reset to defaults');
  }
  persist() {
    try {
      const _serializedState = JSON.stringify(this.state);
      localStorage.setItem('app_state', _serializedState);
      this.logger.debug('State persisted to localStorage');
    } catch (error) {
      this.logger.error('Failed to persist state', error);
    }
  }
  restore() {
    try {
      const _serializedState = localStorage.getItem('app_state');
      if (_serializedState) {
        const _restoredState = JSON.parse(_serializedState);
        this.setState(_restoredState);
        this.logger.info('State restored from localStorage');
      }
    } catch (error) {
      this.logger.error('Failed to restore state', error);
      this.initializeDefaultState();
    }
  }
}
exports.UnifiedStateService = UnifiedStateService;
_UnifiedStateService = UnifiedStateService;
UnifiedStateService.instance = void 0;
var _default = exports.default = UnifiedStateService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQmFzZVNlcnZpY2UiLCJyZXF1aXJlIiwiX1VuaWZpZWRTdGF0ZVNlcnZpY2UiLCJVbmlmaWVkU3RhdGVTZXJ2aWNlIiwiQmFzZVNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInN0YXRlIiwibGlzdGVuZXJzIiwibGlzdGVuZXJJZENvdW50ZXIiLCJpbml0aWFsaXplRGVmYXVsdFN0YXRlIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsInVzZXIiLCJpc0F1dGhlbnRpY2F0ZWQiLCJwcm9maWxlIiwicHJlZmVyZW5jZXMiLCJzcG9ydHMiLCJzZWxlY3RlZFNwb3J0IiwiYWN0aXZlRmlsdGVycyIsImRhdGEiLCJiZXR0aW5nIiwib3Bwb3J0dW5pdGllcyIsImhpc3RvcnkiLCJtZXRyaWNzIiwidWkiLCJ0aGVtZSIsInNpZGViYXJPcGVuIiwibm90aWZpY2F0aW9ucyIsInN5c3RlbSIsImlzT25saW5lIiwibGFzdFN5bmMiLCJlcnJvcnMiLCJnZXQiLCJwYXRoIiwiZGVmYXVsdFZhbHVlIiwiX2tleXMiLCJzcGxpdCIsIl9jdXJyZW50IiwiX2tleSIsInNldCIsInZhbHVlIiwiX2xhc3RLZXkiLCJwb3AiLCJfb2xkVmFsdWUiLCJub3RpZnlMaXN0ZW5lcnMiLCJsb2dnZXIiLCJkZWJ1ZyIsInVwZGF0ZSIsInVwZGF0ZXIiLCJfY3VycmVudFZhbHVlIiwiX25ld1ZhbHVlIiwibWVyZ2UiLCJwYXJ0aWFsIiwiZGVsZXRlIiwidW5kZWZpbmVkIiwic3Vic2NyaWJlIiwiY2FsbGJhY2siLCJfaWQiLCJwdXNoIiwiaWQiLCJ1bnN1YnNjcmliZSIsImxpc3RlbmVySWQiLCJfaW5kZXgiLCJmaW5kSW5kZXgiLCJsIiwic3BsaWNlIiwiY2hhbmdlZFBhdGgiLCJuZXdWYWx1ZSIsIm9sZFZhbHVlIiwiX2xpc3RlbmVyIiwicGF0aE1hdGNoZXMiLCJlcnJvciIsImxpc3RlbmVyUGF0aCIsImxlbmd0aCIsInN0YXJ0c1dpdGgiLCJnZXRTdGF0ZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsInNldFN0YXRlIiwibmV3U3RhdGUiLCJfb2xkU3RhdGUiLCJpbmZvIiwicmVzZXQiLCJwZXJzaXN0IiwiX3NlcmlhbGl6ZWRTdGF0ZSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJyZXN0b3JlIiwiZ2V0SXRlbSIsIl9yZXN0b3JlZFN0YXRlIiwiZXhwb3J0cyIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIlVuaWZpZWRTdGF0ZVNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZVNlcnZpY2UgfSBmcm9tICcuL0Jhc2VTZXJ2aWNlJztcclxuXHJcbmludGVyZmFjZSBTdGF0ZURhdGEge1xyXG4gIFtrZXk6IHN0cmluZ106IHVua25vd247XHJcbn1cclxuXHJcbmludGVyZmFjZSBTdGF0ZUxpc3RlbmVyIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHBhdGg6IHN0cmluZztcclxuICBjYWxsYmFjazogKG5ld1ZhbHVlOiB1bmtub3duLCBvbGRWYWx1ZTogdW5rbm93bikgPT4gdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFVuaWZpZWRTdGF0ZVNlcnZpY2UgZXh0ZW5kcyBCYXNlU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFVuaWZpZWRTdGF0ZVNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBzdGF0ZTogU3RhdGVEYXRhID0ge307XHJcbiAgcHJpdmF0ZSBsaXN0ZW5lcnM6IFN0YXRlTGlzdGVuZXJbXSA9IFtdO1xyXG4gIHByaXZhdGUgbGlzdGVuZXJJZENvdW50ZXIgPSAwO1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoKSB7XHJcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRTKDI1NTQpOiBFeHBlY3RlZCAyIGFyZ3VtZW50cywgYnV0IGdvdCAxLiBCYXNlU2VydmljZSBleHBlY3RzIHR3byBhcmd1bWVudHMsIGJ1dCBvbmx5IG9uZSBpcyBwcm92aWRlZCBoZXJlIGZvciBzaW5nbGV0b24gcGF0dGVybiBjb21wYXRpYmlsaXR5LlxyXG4gICAgc3VwZXIoJ1VuaWZpZWRTdGF0ZVNlcnZpY2UnKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZURlZmF1bHRTdGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFVuaWZpZWRTdGF0ZVNlcnZpY2Uge1xyXG4gICAgaWYgKCFVbmlmaWVkU3RhdGVTZXJ2aWNlLmluc3RhbmNlKSB7XHJcbiAgICAgIFVuaWZpZWRTdGF0ZVNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgVW5pZmllZFN0YXRlU2VydmljZSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFVuaWZpZWRTdGF0ZVNlcnZpY2UuaW5zdGFuY2U7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXRpYWxpemVEZWZhdWx0U3RhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICB1c2VyOiB7XHJcbiAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZSxcclxuICAgICAgICBwcm9maWxlOiBudWxsLFxyXG4gICAgICAgIHByZWZlcmVuY2VzOiB7fSxcclxuICAgICAgfSxcclxuICAgICAgc3BvcnRzOiB7XHJcbiAgICAgICAgc2VsZWN0ZWRTcG9ydDogJ25mbCcsXHJcbiAgICAgICAgYWN0aXZlRmlsdGVyczoge30sXHJcbiAgICAgICAgZGF0YToge30sXHJcbiAgICAgIH0sXHJcbiAgICAgIGJldHRpbmc6IHtcclxuICAgICAgICBvcHBvcnR1bml0aWVzOiBbXSxcclxuICAgICAgICBoaXN0b3J5OiBbXSxcclxuICAgICAgICBtZXRyaWNzOiB7fSxcclxuICAgICAgfSxcclxuICAgICAgdWk6IHtcclxuICAgICAgICB0aGVtZTogJ2N5YmVyLWRhcmsnLFxyXG4gICAgICAgIHNpZGViYXJPcGVuOiB0cnVlLFxyXG4gICAgICAgIG5vdGlmaWNhdGlvbnM6IFtdLFxyXG4gICAgICB9LFxyXG4gICAgICBzeXN0ZW06IHtcclxuICAgICAgICBpc09ubGluZTogdHJ1ZSxcclxuICAgICAgICBsYXN0U3luYzogbnVsbCxcclxuICAgICAgICBlcnJvcnM6IFtdLFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldDxUPihwYXRoOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZT86IFQpOiBUIHtcclxuICAgIGNvbnN0IF9rZXlzID0gcGF0aC5zcGxpdCgnLicpO1xyXG4gICAgbGV0IF9jdXJyZW50ID0gdGhpcy5zdGF0ZTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IF9rZXkgb2YgX2tleXMpIHtcclxuICAgICAgaWYgKF9jdXJyZW50ICYmIHR5cGVvZiBfY3VycmVudCA9PT0gJ29iamVjdCcgJiYgX2tleSBpbiBfY3VycmVudCkge1xyXG4gICAgICAgIF9jdXJyZW50ID0gKF9jdXJyZW50IGFzIGFueSlbX2tleV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZSBhcyBUO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIF9jdXJyZW50IGFzIFQ7XHJcbiAgfVxyXG5cclxuICBzZXQocGF0aDogc3RyaW5nLCB2YWx1ZTogdW5rbm93bik6IHZvaWQge1xyXG4gICAgY29uc3QgX2tleXMgPSBwYXRoLnNwbGl0KCcuJyk7XHJcbiAgICBjb25zdCBfbGFzdEtleSA9IF9rZXlzLnBvcCgpITtcclxuICAgIGxldCBfY3VycmVudCA9IHRoaXMuc3RhdGU7XHJcblxyXG4gICAgLy8gTmF2aWdhdGUgdG8gdGhlIHBhcmVudCBvYmplY3RcclxuICAgIGZvciAoY29uc3QgX2tleSBvZiBfa2V5cykge1xyXG4gICAgICBpZiAoIShfa2V5IGluIF9jdXJyZW50KSB8fCB0eXBlb2YgKF9jdXJyZW50IGFzIGFueSlbX2tleV0gIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgKF9jdXJyZW50IGFzIGFueSlbX2tleV0gPSB7fTtcclxuICAgICAgfVxyXG4gICAgICBfY3VycmVudCA9IChfY3VycmVudCBhcyBhbnkpW19rZXldO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IF9vbGRWYWx1ZSA9IChfY3VycmVudCBhcyBhbnkpW19sYXN0S2V5XTtcclxuICAgIChfY3VycmVudCBhcyBhbnkpW19sYXN0S2V5XSA9IHZhbHVlO1xyXG5cclxuICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKHBhdGgsIHZhbHVlLCBfb2xkVmFsdWUpO1xyXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ1N0YXRlIHVwZGF0ZWQnLCB7IHBhdGgsIHZhbHVlIH0pO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlKHBhdGg6IHN0cmluZywgdXBkYXRlcjogKGN1cnJlbnQ6IHVua25vd24pID0+IHVua25vd24pOiB2b2lkIHtcclxuICAgIGNvbnN0IF9jdXJyZW50VmFsdWUgPSB0aGlzLmdldChwYXRoKTtcclxuICAgIGNvbnN0IF9uZXdWYWx1ZSA9IHVwZGF0ZXIoX2N1cnJlbnRWYWx1ZSk7XHJcbiAgICB0aGlzLnNldChwYXRoLCBfbmV3VmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgbWVyZ2UocGF0aDogc3RyaW5nLCBwYXJ0aWFsOiB1bmtub3duKTogdm9pZCB7XHJcbiAgICBjb25zdCBfY3VycmVudFZhbHVlID0gdGhpcy5nZXQocGF0aCwge30pO1xyXG4gICAgY29uc3QgX25ld1ZhbHVlID0geyAuLi4oX2N1cnJlbnRWYWx1ZSBhcyBvYmplY3QpLCAuLi4ocGFydGlhbCBhcyBvYmplY3QpIH07XHJcbiAgICB0aGlzLnNldChwYXRoLCBfbmV3VmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKHBhdGg6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgX2tleXMgPSBwYXRoLnNwbGl0KCcuJyk7XHJcbiAgICBjb25zdCBfbGFzdEtleSA9IF9rZXlzLnBvcCgpITtcclxuICAgIGxldCBfY3VycmVudCA9IHRoaXMuc3RhdGU7XHJcblxyXG4gICAgZm9yIChjb25zdCBfa2V5IG9mIF9rZXlzKSB7XHJcbiAgICAgIGlmICghKF9rZXkgaW4gX2N1cnJlbnQpIHx8IHR5cGVvZiAoX2N1cnJlbnQgYXMgYW55KVtfa2V5XSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICByZXR1cm47IC8vIFBhdGggZG9lc24ndCBleGlzdFxyXG4gICAgICB9XHJcbiAgICAgIF9jdXJyZW50ID0gKF9jdXJyZW50IGFzIGFueSlbX2tleV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgX29sZFZhbHVlID0gKF9jdXJyZW50IGFzIGFueSlbX2xhc3RLZXldO1xyXG4gICAgZGVsZXRlIChfY3VycmVudCBhcyBhbnkpW19sYXN0S2V5XTtcclxuXHJcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhwYXRoLCB1bmRlZmluZWQsIF9vbGRWYWx1ZSk7XHJcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnU3RhdGUgZGVsZXRlZCcsIHsgcGF0aCB9KTtcclxuICB9XHJcblxyXG4gIHN1YnNjcmliZShwYXRoOiBzdHJpbmcsIGNhbGxiYWNrOiAobmV3VmFsdWU6IHVua25vd24sIG9sZFZhbHVlOiB1bmtub3duKSA9PiB2b2lkKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IF9pZCA9IGBsaXN0ZW5lcl8keysrdGhpcy5saXN0ZW5lcklkQ291bnRlcn1gO1xyXG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaCh7IGlkOiBfaWQsIHBhdGgsIGNhbGxiYWNrIH0pO1xyXG5cclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdTdGF0ZSBsaXN0ZW5lciBhZGRlZCcsIHsgaWQ6IF9pZCwgcGF0aCB9KTtcclxuICAgIHJldHVybiBfaWQ7XHJcbiAgfVxyXG5cclxuICB1bnN1YnNjcmliZShsaXN0ZW5lcklkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IF9pbmRleCA9IHRoaXMubGlzdGVuZXJzLmZpbmRJbmRleChsID0+IGwuaWQgPT09IGxpc3RlbmVySWQpO1xyXG4gICAgaWYgKF9pbmRleCA+PSAwKSB7XHJcbiAgICAgIHRoaXMubGlzdGVuZXJzLnNwbGljZShfaW5kZXgsIDEpO1xyXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnU3RhdGUgbGlzdGVuZXIgcmVtb3ZlZCcsIHsgbGlzdGVuZXJJZCB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgbm90aWZ5TGlzdGVuZXJzKGNoYW5nZWRQYXRoOiBzdHJpbmcsIG5ld1ZhbHVlOiB1bmtub3duLCBvbGRWYWx1ZTogdW5rbm93bik6IHZvaWQge1xyXG4gICAgZm9yIChjb25zdCBfbGlzdGVuZXIgb2YgdGhpcy5saXN0ZW5lcnMpIHtcclxuICAgICAgaWYgKHRoaXMucGF0aE1hdGNoZXMoY2hhbmdlZFBhdGgsIF9saXN0ZW5lci5wYXRoKSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBfbGlzdGVuZXIuY2FsbGJhY2sobmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1N0YXRlIGxpc3RlbmVyIGVycm9yJywge1xyXG4gICAgICAgICAgICBsaXN0ZW5lcklkOiBfbGlzdGVuZXIuaWQsXHJcbiAgICAgICAgICAgIHBhdGg6IF9saXN0ZW5lci5wYXRoLFxyXG4gICAgICAgICAgICBlcnJvcixcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXRoTWF0Y2hlcyhjaGFuZ2VkUGF0aDogc3RyaW5nLCBsaXN0ZW5lclBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgLy8gRXhhY3QgbWF0Y2hcclxuICAgIGlmIChjaGFuZ2VkUGF0aCA9PT0gbGlzdGVuZXJQYXRoKSByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgICAvLyBQYXJlbnQgcGF0aCBjaGFuZ2UgYWZmZWN0cyBjaGlsZCBsaXN0ZW5lcnNcclxuICAgIGlmIChjaGFuZ2VkUGF0aC5sZW5ndGggPCBsaXN0ZW5lclBhdGgubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBsaXN0ZW5lclBhdGguc3RhcnRzV2l0aChjaGFuZ2VkUGF0aCArICcuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hpbGQgcGF0aCBjaGFuZ2UgYWZmZWN0cyBwYXJlbnQgbGlzdGVuZXJzXHJcbiAgICBpZiAoY2hhbmdlZFBhdGgubGVuZ3RoID4gbGlzdGVuZXJQYXRoLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gY2hhbmdlZFBhdGguc3RhcnRzV2l0aChsaXN0ZW5lclBhdGggKyAnLicpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGdldFN0YXRlKCk6IFN0YXRlRGF0YSB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnN0YXRlKSk7XHJcbiAgfVxyXG5cclxuICBzZXRTdGF0ZShuZXdTdGF0ZTogU3RhdGVEYXRhKTogdm9pZCB7XHJcbiAgICBjb25zdCBfb2xkU3RhdGUgPSB0aGlzLnN0YXRlO1xyXG4gICAgdGhpcy5zdGF0ZSA9IG5ld1N0YXRlO1xyXG5cclxuICAgIC8vIE5vdGlmeSBhbGwgbGlzdGVuZXJzIHRoYXQgcm9vdCBzdGF0ZSBjaGFuZ2VkXHJcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygnJywgbmV3U3RhdGUsIF9vbGRTdGF0ZSk7XHJcbiAgICB0aGlzLmxvZ2dlci5pbmZvKCdGdWxsIHN0YXRlIHJlcGxhY2VkJyk7XHJcbiAgfVxyXG5cclxuICByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZURlZmF1bHRTdGF0ZSgpO1xyXG4gICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcclxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ1N0YXRlIHJlc2V0IHRvIGRlZmF1bHRzJyk7XHJcbiAgfVxyXG5cclxuICBwZXJzaXN0KCk6IHZvaWQge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3NlcmlhbGl6ZWRTdGF0ZSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuc3RhdGUpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXBwX3N0YXRlJywgX3NlcmlhbGl6ZWRTdGF0ZSk7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdTdGF0ZSBwZXJzaXN0ZWQgdG8gbG9jYWxTdG9yYWdlJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHBlcnNpc3Qgc3RhdGUnLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXN0b3JlKCk6IHZvaWQge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3NlcmlhbGl6ZWRTdGF0ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhcHBfc3RhdGUnKTtcclxuICAgICAgaWYgKF9zZXJpYWxpemVkU3RhdGUpIHtcclxuICAgICAgICBjb25zdCBfcmVzdG9yZWRTdGF0ZSA9IEpTT04ucGFyc2UoX3NlcmlhbGl6ZWRTdGF0ZSk7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShfcmVzdG9yZWRTdGF0ZSk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnU3RhdGUgcmVzdG9yZWQgZnJvbSBsb2NhbFN0b3JhZ2UnKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXN0b3JlIHN0YXRlJywgZXJyb3IpO1xyXG4gICAgICB0aGlzLmluaXRpYWxpemVEZWZhdWx0U3RhdGUoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFVuaWZpZWRTdGF0ZVNlcnZpY2U7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsWUFBQSxHQUFBQyxPQUFBO0FBQTRDLElBQUFDLG9CQUFBO0FBWXJDLE1BQU1DLG1CQUFtQixTQUFTQyx3QkFBVyxDQUFDO0VBTXpDQyxXQUFXQSxDQUFBLEVBQUc7SUFDdEI7SUFDQSxLQUFLLENBQUMscUJBQXFCLENBQUM7SUFBQyxLQU52QkMsS0FB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