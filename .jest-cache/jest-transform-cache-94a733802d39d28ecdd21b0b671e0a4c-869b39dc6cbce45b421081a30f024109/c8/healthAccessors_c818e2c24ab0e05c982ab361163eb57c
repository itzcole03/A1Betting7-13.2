b0c52991833fa3f02599528b3b5a26a1
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.debugHealthStructure = debugHealthStructure;
exports.getCacheHitRate = getCacheHitRate;
exports.getCacheType = getCacheType;
exports.hasPerformanceSection = hasPerformanceSection;
exports.safeIterateCacheMetrics = safeIterateCacheMetrics;
/**
 * Unified health data accessors to prevent runtime errors from hit_rate variations
 * Handles legacy field mappings and provides safe defaults
 * 
 * @module healthAccessors
 */

/**
 * Unified health data accessors to prevent runtime errors from hit_rate variations
 * Handles legacy field mappings and provides safe defaults
 * 
 * @module healthAccessors
 */

// Health-like object types for better type safety

// Module-scoped warning flags to prevent spam
let hasWarnedLegacyHitRate = false;
let hasWarnedFlatHitRate = false;
let hasWarnedInfrastructure = false;

/**
 * Safely extract cache hit rate from various health/metrics object structures
 * 
 * Priority order:
 * 1. obj?.performance?.cache_hit_rate (canonical)
 * 2. obj?.performance?.hit_rate (legacy mapping)
 * 3. obj?.infrastructure?.cache?.hit_rate_percent (Phase 3 structure)
 * 4. obj?.cache_performance?.hit_rate (metrics structure)
 * 5. obj?.hit_rate (flat legacy)
 * 6. Default: 0
 */
function getCacheHitRate(obj) {
  if (!obj || typeof obj !== 'object') {
    return 0;
  }
  const healthObj = obj;

  // Priority 1: Canonical cache_hit_rate
  if (typeof healthObj?.performance?.cache_hit_rate === 'number') {
    return healthObj.performance.cache_hit_rate;
  }

  // Priority 2: Legacy performance.hit_rate
  if (typeof healthObj?.performance?.hit_rate === 'number') {
    if (!hasWarnedLegacyHitRate && process.env.NODE_ENV === 'development') {
      hasWarnedLegacyHitRate = true;
      // eslint-disable-next-line no-console
      console.warn('[HealthCompat] Using legacy performance.hit_rate, consider migrating to cache_hit_rate');
    }
    return healthObj.performance.hit_rate;
  }

  // Priority 3: Phase 3 infrastructure structure
  if (typeof healthObj?.infrastructure?.cache?.hit_rate_percent === 'number') {
    if (!hasWarnedInfrastructure && process.env.NODE_ENV === 'development') {
      hasWarnedInfrastructure = true;
      // eslint-disable-next-line no-console
      console.warn('[HealthCompat] Using infrastructure.cache.hit_rate_percent, consider migrating to performance.cache_hit_rate');
    }
    return healthObj.infrastructure.cache.hit_rate_percent;
  }

  // Priority 4: Metrics structure (for PerformanceMonitoringDashboard)
  if (typeof healthObj?.cache_performance?.hit_rate === 'number') {
    return healthObj.cache_performance.hit_rate;
  }

  // Priority 5: Flat legacy structure
  if (typeof healthObj?.hit_rate === 'number') {
    if (!hasWarnedFlatHitRate && process.env.NODE_ENV === 'development') {
      hasWarnedFlatHitRate = true;
      // eslint-disable-next-line no-console
      console.warn('[HealthCompat] Using flat hit_rate, consider migrating to performance.cache_hit_rate');
    }
    return healthObj.hit_rate;
  }

  // Default: 0
  return 0;
}

/**
 * Check if object has a performance section (any variant)
 */
function hasPerformanceSection(obj) {
  if (!obj || typeof obj !== 'object') {
    return false;
  }
  const healthObj = obj;
  return !!(healthObj.performance || healthObj.infrastructure?.cache || healthObj.cache_performance || typeof healthObj.hit_rate === 'number');
}

/**
 * Safe iteration over cache metrics arrays
 * Filters out undefined/null entries and ensures hit_rate exists
 */
function safeIterateCacheMetrics(metrics, callback) {
  if (!Array.isArray(metrics)) {
    return [];
  }
  return metrics.filter(metric => {
    return metric != null && typeof metric === 'object' && typeof metric.hit_rate === 'number';
  }).map(callback);
}

/**
 * DEV-only diagnostic helper for debugging health data structures
 */
function debugHealthStructure(obj, label = 'Health') {
  if (process.env.NODE_ENV !== 'development') {
    return;
  }
  const cacheHitRate = getCacheHitRate(obj);
  const hasPerf = hasPerformanceSection(obj);
  const healthObj = obj;
  const rawPresence = {
    'performance.cache_hit_rate': typeof healthObj?.performance?.cache_hit_rate === 'number',
    'performance.hit_rate': typeof healthObj?.performance?.hit_rate === 'number',
    'infrastructure.cache.hit_rate_percent': typeof healthObj?.infrastructure?.cache?.hit_rate_percent === 'number',
    'cache_performance.hit_rate': typeof healthObj?.cache_performance?.hit_rate === 'number',
    'flat.hit_rate': typeof healthObj?.hit_rate === 'number'
  };

  // eslint-disable-next-line no-console
  console.debug(`[HealthDiag] ${label}:`, {
    extractedCacheHitRate: cacheHitRate,
    hasPerformanceSection: hasPerf,
    rawPresence
  });
}

/**
 * Safely extract cache type from health/metrics objects with fallback
 */
function getCacheType(obj) {
  if (!obj || typeof obj !== 'object') {
    return 'Unknown';
  }
  const healthObj = obj;

  // Try performance.cache_type first
  if (typeof healthObj?.performance?.cache_type === 'string') {
    return healthObj.performance.cache_type;
  }

  // Fall back to flat cache_type
  if (typeof healthObj?.cache_type === 'string') {
    return healthObj.cache_type;
  }
  return 'Unknown';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoYXNXYXJuZWRMZWdhY3lIaXRSYXRlIiwiaGFzV2FybmVkRmxhdEhpdFJhdGUiLCJoYXNXYXJuZWRJbmZyYXN0cnVjdHVyZSIsImdldENhY2hlSGl0UmF0ZSIsIm9iaiIsImhlYWx0aE9iaiIsInBlcmZvcm1hbmNlIiwiY2FjaGVfaGl0X3JhdGUiLCJoaXRfcmF0ZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImNvbnNvbGUiLCJ3YXJuIiwiaW5mcmFzdHJ1Y3R1cmUiLCJjYWNoZSIsImhpdF9yYXRlX3BlcmNlbnQiLCJjYWNoZV9wZXJmb3JtYW5jZSIsImhhc1BlcmZvcm1hbmNlU2VjdGlvbiIsInNhZmVJdGVyYXRlQ2FjaGVNZXRyaWNzIiwibWV0cmljcyIsImNhbGxiYWNrIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwibWV0cmljIiwibWFwIiwiZGVidWdIZWFsdGhTdHJ1Y3R1cmUiLCJsYWJlbCIsImNhY2hlSGl0UmF0ZSIsImhhc1BlcmYiLCJyYXdQcmVzZW5jZSIsImRlYnVnIiwiZXh0cmFjdGVkQ2FjaGVIaXRSYXRlIiwiZ2V0Q2FjaGVUeXBlIiwiY2FjaGVfdHlwZSJdLCJzb3VyY2VzIjpbImhlYWx0aEFjY2Vzc29ycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVW5pZmllZCBoZWFsdGggZGF0YSBhY2Nlc3NvcnMgdG8gcHJldmVudCBydW50aW1lIGVycm9ycyBmcm9tIGhpdF9yYXRlIHZhcmlhdGlvbnNcclxuICogSGFuZGxlcyBsZWdhY3kgZmllbGQgbWFwcGluZ3MgYW5kIHByb3ZpZGVzIHNhZmUgZGVmYXVsdHNcclxuICogXHJcbiAqIEBtb2R1bGUgaGVhbHRoQWNjZXNzb3JzXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIFVuaWZpZWQgaGVhbHRoIGRhdGEgYWNjZXNzb3JzIHRvIHByZXZlbnQgcnVudGltZSBlcnJvcnMgZnJvbSBoaXRfcmF0ZSB2YXJpYXRpb25zXHJcbiAqIEhhbmRsZXMgbGVnYWN5IGZpZWxkIG1hcHBpbmdzIGFuZCBwcm92aWRlcyBzYWZlIGRlZmF1bHRzXHJcbiAqIFxyXG4gKiBAbW9kdWxlIGhlYWx0aEFjY2Vzc29yc1xyXG4gKi9cclxuXHJcbi8vIEhlYWx0aC1saWtlIG9iamVjdCB0eXBlcyBmb3IgYmV0dGVyIHR5cGUgc2FmZXR5XHJcbmludGVyZmFjZSBIZWFsdGhMaWtlT2JqZWN0IHtcclxuICBwZXJmb3JtYW5jZT86IHtcclxuICAgIGNhY2hlX2hpdF9yYXRlPzogbnVtYmVyO1xyXG4gICAgaGl0X3JhdGU/OiBudW1iZXI7XHJcbiAgfTtcclxuICBpbmZyYXN0cnVjdHVyZT86IHtcclxuICAgIGNhY2hlPzoge1xyXG4gICAgICBoaXRfcmF0ZV9wZXJjZW50PzogbnVtYmVyO1xyXG4gICAgfTtcclxuICB9O1xyXG4gIGNhY2hlX3BlcmZvcm1hbmNlPzoge1xyXG4gICAgaGl0X3JhdGU/OiBudW1iZXI7XHJcbiAgfTtcclxuICBoaXRfcmF0ZT86IG51bWJlcjtcclxufVxyXG5cclxuLy8gTW9kdWxlLXNjb3BlZCB3YXJuaW5nIGZsYWdzIHRvIHByZXZlbnQgc3BhbVxyXG5sZXQgaGFzV2FybmVkTGVnYWN5SGl0UmF0ZSA9IGZhbHNlO1xyXG5sZXQgaGFzV2FybmVkRmxhdEhpdFJhdGUgPSBmYWxzZTtcclxubGV0IGhhc1dhcm5lZEluZnJhc3RydWN0dXJlID0gZmFsc2U7XHJcblxyXG4vKipcclxuICogU2FmZWx5IGV4dHJhY3QgY2FjaGUgaGl0IHJhdGUgZnJvbSB2YXJpb3VzIGhlYWx0aC9tZXRyaWNzIG9iamVjdCBzdHJ1Y3R1cmVzXHJcbiAqIFxyXG4gKiBQcmlvcml0eSBvcmRlcjpcclxuICogMS4gb2JqPy5wZXJmb3JtYW5jZT8uY2FjaGVfaGl0X3JhdGUgKGNhbm9uaWNhbClcclxuICogMi4gb2JqPy5wZXJmb3JtYW5jZT8uaGl0X3JhdGUgKGxlZ2FjeSBtYXBwaW5nKVxyXG4gKiAzLiBvYmo/LmluZnJhc3RydWN0dXJlPy5jYWNoZT8uaGl0X3JhdGVfcGVyY2VudCAoUGhhc2UgMyBzdHJ1Y3R1cmUpXHJcbiAqIDQuIG9iaj8uY2FjaGVfcGVyZm9ybWFuY2U/LmhpdF9yYXRlIChtZXRyaWNzIHN0cnVjdHVyZSlcclxuICogNS4gb2JqPy5oaXRfcmF0ZSAoZmxhdCBsZWdhY3kpXHJcbiAqIDYuIERlZmF1bHQ6IDBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYWNoZUhpdFJhdGUob2JqOiB1bmtub3duKTogbnVtYmVyIHtcclxuICBpZiAoIW9iaiB8fCB0eXBlb2Ygb2JqICE9PSAnb2JqZWN0Jykge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG5cclxuICBjb25zdCBoZWFsdGhPYmogPSBvYmogYXMgSGVhbHRoTGlrZU9iamVjdDtcclxuXHJcbiAgLy8gUHJpb3JpdHkgMTogQ2Fub25pY2FsIGNhY2hlX2hpdF9yYXRlXHJcbiAgaWYgKHR5cGVvZiBoZWFsdGhPYmo/LnBlcmZvcm1hbmNlPy5jYWNoZV9oaXRfcmF0ZSA9PT0gJ251bWJlcicpIHtcclxuICAgIHJldHVybiBoZWFsdGhPYmoucGVyZm9ybWFuY2UuY2FjaGVfaGl0X3JhdGU7XHJcbiAgfVxyXG5cclxuICAvLyBQcmlvcml0eSAyOiBMZWdhY3kgcGVyZm9ybWFuY2UuaGl0X3JhdGVcclxuICBpZiAodHlwZW9mIGhlYWx0aE9iaj8ucGVyZm9ybWFuY2U/LmhpdF9yYXRlID09PSAnbnVtYmVyJykge1xyXG4gICAgaWYgKCFoYXNXYXJuZWRMZWdhY3lIaXRSYXRlICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgIGhhc1dhcm5lZExlZ2FjeUhpdFJhdGUgPSB0cnVlO1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxyXG4gICAgICBjb25zb2xlLndhcm4oJ1tIZWFsdGhDb21wYXRdIFVzaW5nIGxlZ2FjeSBwZXJmb3JtYW5jZS5oaXRfcmF0ZSwgY29uc2lkZXIgbWlncmF0aW5nIHRvIGNhY2hlX2hpdF9yYXRlJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGVhbHRoT2JqLnBlcmZvcm1hbmNlLmhpdF9yYXRlO1xyXG4gIH1cclxuXHJcbiAgLy8gUHJpb3JpdHkgMzogUGhhc2UgMyBpbmZyYXN0cnVjdHVyZSBzdHJ1Y3R1cmVcclxuICBpZiAodHlwZW9mIGhlYWx0aE9iaj8uaW5mcmFzdHJ1Y3R1cmU/LmNhY2hlPy5oaXRfcmF0ZV9wZXJjZW50ID09PSAnbnVtYmVyJykge1xyXG4gICAgaWYgKCFoYXNXYXJuZWRJbmZyYXN0cnVjdHVyZSAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICBoYXNXYXJuZWRJbmZyYXN0cnVjdHVyZSA9IHRydWU7XHJcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXHJcbiAgICAgIGNvbnNvbGUud2FybignW0hlYWx0aENvbXBhdF0gVXNpbmcgaW5mcmFzdHJ1Y3R1cmUuY2FjaGUuaGl0X3JhdGVfcGVyY2VudCwgY29uc2lkZXIgbWlncmF0aW5nIHRvIHBlcmZvcm1hbmNlLmNhY2hlX2hpdF9yYXRlJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGVhbHRoT2JqLmluZnJhc3RydWN0dXJlLmNhY2hlLmhpdF9yYXRlX3BlcmNlbnQ7XHJcbiAgfVxyXG5cclxuICAvLyBQcmlvcml0eSA0OiBNZXRyaWNzIHN0cnVjdHVyZSAoZm9yIFBlcmZvcm1hbmNlTW9uaXRvcmluZ0Rhc2hib2FyZClcclxuICBpZiAodHlwZW9mIGhlYWx0aE9iaj8uY2FjaGVfcGVyZm9ybWFuY2U/LmhpdF9yYXRlID09PSAnbnVtYmVyJykge1xyXG4gICAgcmV0dXJuIGhlYWx0aE9iai5jYWNoZV9wZXJmb3JtYW5jZS5oaXRfcmF0ZTtcclxuICB9XHJcblxyXG4gIC8vIFByaW9yaXR5IDU6IEZsYXQgbGVnYWN5IHN0cnVjdHVyZVxyXG4gIGlmICh0eXBlb2YgaGVhbHRoT2JqPy5oaXRfcmF0ZSA9PT0gJ251bWJlcicpIHtcclxuICAgIGlmICghaGFzV2FybmVkRmxhdEhpdFJhdGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgaGFzV2FybmVkRmxhdEhpdFJhdGUgPSB0cnVlO1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxyXG4gICAgICBjb25zb2xlLndhcm4oJ1tIZWFsdGhDb21wYXRdIFVzaW5nIGZsYXQgaGl0X3JhdGUsIGNvbnNpZGVyIG1pZ3JhdGluZyB0byBwZXJmb3JtYW5jZS5jYWNoZV9oaXRfcmF0ZScpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhlYWx0aE9iai5oaXRfcmF0ZTtcclxuICB9XHJcblxyXG4gIC8vIERlZmF1bHQ6IDBcclxuICByZXR1cm4gMDtcclxufVxyXG5cclxuLyoqXHJcbiAqIENoZWNrIGlmIG9iamVjdCBoYXMgYSBwZXJmb3JtYW5jZSBzZWN0aW9uIChhbnkgdmFyaWFudClcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBoYXNQZXJmb3JtYW5jZVNlY3Rpb24ob2JqOiB1bmtub3duKTogYm9vbGVhbiB7XHJcbiAgaWYgKCFvYmogfHwgdHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGhlYWx0aE9iaiA9IG9iaiBhcyBIZWFsdGhMaWtlT2JqZWN0O1xyXG5cclxuICByZXR1cm4gISEoXHJcbiAgICBoZWFsdGhPYmoucGVyZm9ybWFuY2UgfHxcclxuICAgIGhlYWx0aE9iai5pbmZyYXN0cnVjdHVyZT8uY2FjaGUgfHxcclxuICAgIGhlYWx0aE9iai5jYWNoZV9wZXJmb3JtYW5jZSB8fFxyXG4gICAgdHlwZW9mIGhlYWx0aE9iai5oaXRfcmF0ZSA9PT0gJ251bWJlcidcclxuICApO1xyXG59XHJcblxyXG4vKipcclxuICogU2FmZSBpdGVyYXRpb24gb3ZlciBjYWNoZSBtZXRyaWNzIGFycmF5c1xyXG4gKiBGaWx0ZXJzIG91dCB1bmRlZmluZWQvbnVsbCBlbnRyaWVzIGFuZCBlbnN1cmVzIGhpdF9yYXRlIGV4aXN0c1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVJdGVyYXRlQ2FjaGVNZXRyaWNzPFQ+KFxyXG4gIG1ldHJpY3M6IFRbXSB8IHVuZGVmaW5lZCB8IG51bGwsXHJcbiAgY2FsbGJhY2s6IChtZXRyaWM6IFQgJiB7IGhpdF9yYXRlOiBudW1iZXIgfSwgaW5kZXg6IG51bWJlcikgPT4gdW5rbm93blxyXG4pOiB1bmtub3duW10ge1xyXG4gIGlmICghQXJyYXkuaXNBcnJheShtZXRyaWNzKSkge1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG1ldHJpY3NcclxuICAgIC5maWx0ZXIoKG1ldHJpYyk6IG1ldHJpYyBpcyBUICYgeyBoaXRfcmF0ZTogbnVtYmVyIH0gPT4ge1xyXG4gICAgICByZXR1cm4gbWV0cmljICE9IG51bGwgJiYgXHJcbiAgICAgICAgICAgICB0eXBlb2YgbWV0cmljID09PSAnb2JqZWN0JyAmJiBcclxuICAgICAgICAgICAgIHR5cGVvZiAobWV0cmljIGFzIHsgaGl0X3JhdGU/OiBudW1iZXIgfSkuaGl0X3JhdGUgPT09ICdudW1iZXInO1xyXG4gICAgfSlcclxuICAgIC5tYXAoY2FsbGJhY2spO1xyXG59XHJcblxyXG4vKipcclxuICogREVWLW9ubHkgZGlhZ25vc3RpYyBoZWxwZXIgZm9yIGRlYnVnZ2luZyBoZWFsdGggZGF0YSBzdHJ1Y3R1cmVzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGVidWdIZWFsdGhTdHJ1Y3R1cmUob2JqOiB1bmtub3duLCBsYWJlbDogc3RyaW5nID0gJ0hlYWx0aCcpOiB2b2lkIHtcclxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNhY2hlSGl0UmF0ZSA9IGdldENhY2hlSGl0UmF0ZShvYmopO1xyXG4gIGNvbnN0IGhhc1BlcmYgPSBoYXNQZXJmb3JtYW5jZVNlY3Rpb24ob2JqKTtcclxuICBjb25zdCBoZWFsdGhPYmogPSBvYmogYXMgSGVhbHRoTGlrZU9iamVjdDtcclxuICBcclxuICBjb25zdCByYXdQcmVzZW5jZSA9IHtcclxuICAgICdwZXJmb3JtYW5jZS5jYWNoZV9oaXRfcmF0ZSc6IHR5cGVvZiBoZWFsdGhPYmo/LnBlcmZvcm1hbmNlPy5jYWNoZV9oaXRfcmF0ZSA9PT0gJ251bWJlcicsXHJcbiAgICAncGVyZm9ybWFuY2UuaGl0X3JhdGUnOiB0eXBlb2YgaGVhbHRoT2JqPy5wZXJmb3JtYW5jZT8uaGl0X3JhdGUgPT09ICdudW1iZXInLFxyXG4gICAgJ2luZnJhc3RydWN0dXJlLmNhY2hlLmhpdF9yYXRlX3BlcmNlbnQnOiB0eXBlb2YgaGVhbHRoT2JqPy5pbmZyYXN0cnVjdHVyZT8uY2FjaGU/LmhpdF9yYXRlX3BlcmNlbnQgPT09ICdudW1iZXInLFxyXG4gICAgJ2NhY2hlX3BlcmZvcm1hbmNlLmhpdF9yYXRlJzogdHlwZW9mIGhlYWx0aE9iaj8uY2FjaGVfcGVyZm9ybWFuY2U/LmhpdF9yYXRlID09PSAnbnVtYmVyJyxcclxuICAgICdmbGF0LmhpdF9yYXRlJzogdHlwZW9mIGhlYWx0aE9iaj8uaGl0X3JhdGUgPT09ICdudW1iZXInXHJcbiAgfTtcclxuXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcclxuICBjb25zb2xlLmRlYnVnKGBbSGVhbHRoRGlhZ10gJHtsYWJlbH06YCwge1xyXG4gICAgZXh0cmFjdGVkQ2FjaGVIaXRSYXRlOiBjYWNoZUhpdFJhdGUsXHJcbiAgICBoYXNQZXJmb3JtYW5jZVNlY3Rpb246IGhhc1BlcmYsXHJcbiAgICByYXdQcmVzZW5jZVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2FmZWx5IGV4dHJhY3QgY2FjaGUgdHlwZSBmcm9tIGhlYWx0aC9tZXRyaWNzIG9iamVjdHMgd2l0aCBmYWxsYmFja1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhY2hlVHlwZShvYmo6IHVua25vd24pOiBzdHJpbmcge1xyXG4gIGlmICghb2JqIHx8IHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSB7XHJcbiAgICByZXR1cm4gJ1Vua25vd24nO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaGVhbHRoT2JqID0gb2JqIGFzIEhlYWx0aExpa2VPYmplY3QgJiB7IFxyXG4gICAgcGVyZm9ybWFuY2U/OiB7IGNhY2hlX3R5cGU/OiBzdHJpbmcgfTtcclxuICAgIGNhY2hlX3R5cGU/OiBzdHJpbmc7XHJcbiAgfTtcclxuXHJcbiAgLy8gVHJ5IHBlcmZvcm1hbmNlLmNhY2hlX3R5cGUgZmlyc3RcclxuICBpZiAodHlwZW9mIGhlYWx0aE9iaj8ucGVyZm9ybWFuY2U/LmNhY2hlX3R5cGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICByZXR1cm4gaGVhbHRoT2JqLnBlcmZvcm1hbmNlLmNhY2hlX3R5cGU7XHJcbiAgfVxyXG5cclxuICAvLyBGYWxsIGJhY2sgdG8gZmxhdCBjYWNoZV90eXBlXHJcbiAgaWYgKHR5cGVvZiBoZWFsdGhPYmo/LmNhY2hlX3R5cGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICByZXR1cm4gaGVhbHRoT2JqLmNhY2hlX3R5cGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gJ1Vua25vd24nO1xyXG59Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFpQkE7QUFDQSxJQUFJQSxzQkFBc0IsR0FBRyxLQUFLO0FBQ2xDLElBQUlDLG9CQUFvQixHQUFHLEtBQUs7QUFDaEMsSUFBSUMsdUJBQXVCLEdBQUcsS0FBSzs7QUFFbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLFNBQVNDLGVBQWVBLENBQUNDLEdBQVksRUFBVTtFQUNwRCxJQUFJLENBQUNBLEdBQUcsSUFBSSxPQUFP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