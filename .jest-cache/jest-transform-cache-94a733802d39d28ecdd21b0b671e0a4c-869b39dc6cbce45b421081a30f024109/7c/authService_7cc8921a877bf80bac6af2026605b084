9429a5555e5e3698dc0fe3ac6f8f924e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports._authService = void 0;
var _axios = _interopRequireDefault(require("axios"));
// frontend/src/services/AuthService.ts

const _API_URL = 'http://localhost:8000/api/auth';
class AuthService {
  constructor() {
    this.user = null;
    this.token = null;
    this.requiresPasswordChangeFlag = false;
    this.loadFromLocalStorage();
  }
  loadFromLocalStorage() {
    const _token = localStorage.getItem('token');
    const _user = localStorage.getItem('user');
    if (_token && _user) {
      this.token = _token;
      this.user = JSON.parse(_user);
      _axios.default.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
    }
  }
  saveToLocalStorage(token, user) {
    this.token = token;
    this.user = user;
    localStorage.setItem('token', token);
    localStorage.setItem('user', JSON.stringify(user));
    _axios.default.defaults.headers.common['Authorization'] = `Bearer ${token}`;
  }
  clearLocalStorage() {
    this.token = null;
    this.user = null;
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    delete _axios.default.defaults.headers.common['Authorization'];
  }
  isAuthenticated() {
    return !!this.token;
  }
  getUser() {
    return this.user;
  }
  isAdmin() {
    return this.user?.role === 'admin';
  }
  requiresPasswordChange() {
    return this.requiresPasswordChangeFlag;
  }
  async login(email, password) {
    try {
      const _response = await _axios.default.post(`${_API_URL}/login`, {
        email,
        password
      }, {
        headers: {
          'Content-Type': 'application/json'
        }
      });
      if (_response.data.access_token) {
        const _user = {
          id: '1',
          email,
          role: 'admin'
        };
        this.saveToLocalStorage(_response.data.access_token, _user);
        return {
          success: true,
          user: _user,
          requiresPasswordChange: false
        };
      }
      return {
        success: false,
        message: 'Invalid credentials'
      };
    } catch (error) {
      console.error('Login API error:', error);
      return {
        success: false,
        message: error.message || 'Login failed due to API error'
      };
    }
  }
  async logout() {
    this.clearLocalStorage();
    return Promise.resolve();
  }
  async changePassword(data) {
    try {
      console.log(`Changing password for user ${data.userId}`);
      this.requiresPasswordChangeFlag = false;
      return {
        success: true
      };
    } catch (error) {
      console.error('Change password API error:', error);
      return {
        success: false,
        message: error.message || 'Password change failed due to API error'
      };
    }
  }
}
const _authService = exports._authService = new AuthService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9BUElfVVJMIiwiQXV0aFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInVzZXIiLCJ0b2tlbiIsInJlcXVpcmVzUGFzc3dvcmRDaGFuZ2VGbGFnIiwibG9hZEZyb21Mb2NhbFN0b3JhZ2UiLCJfdG9rZW4iLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiX3VzZXIiLCJKU09OIiwicGFyc2UiLCJheGlvcyIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInNhdmVUb0xvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJjbGVhckxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJpc0F1dGhlbnRpY2F0ZWQiLCJnZXRVc2VyIiwiaXNBZG1pbiIsInJvbGUiLCJyZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlIiwibG9naW4iLCJlbWFpbCIsInBhc3N3b3JkIiwiX3Jlc3BvbnNlIiwicG9zdCIsImRhdGEiLCJhY2Nlc3NfdG9rZW4iLCJpZCIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nb3V0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJjaGFuZ2VQYXNzd29yZCIsImxvZyIsInVzZXJJZCIsIl9hdXRoU2VydmljZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJhdXRoU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBmcm9udGVuZC9zcmMvc2VydmljZXMvQXV0aFNlcnZpY2UudHNcclxuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcclxuXHJcbmNvbnN0IF9BUElfVVJMID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9hcGkvYXV0aCc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFVzZXIge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICByb2xlOiBzdHJpbmc7XHJcbiAgcGVybWlzc2lvbnM/OiBzdHJpbmdbXTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQYXNzd29yZENoYW5nZVJlcXVlc3Qge1xyXG4gIHVzZXJJZDogc3RyaW5nO1xyXG4gIG9sZFBhc3N3b3JkPzogc3RyaW5nO1xyXG4gIG5ld1Bhc3N3b3JkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXNwb25zZSB7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICB1c2VyPzogVXNlcjtcclxuICBtZXNzYWdlPzogc3RyaW5nO1xyXG4gIHJlcXVpcmVzUGFzc3dvcmRDaGFuZ2U/OiBib29sZWFuO1xyXG59XHJcblxyXG5jbGFzcyBBdXRoU2VydmljZSB7XHJcbiAgcHJpdmF0ZSB1c2VyOiBVc2VyIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgcHJpdmF0ZSByZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlRmxhZyA9IGZhbHNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMubG9hZEZyb21Mb2NhbFN0b3JhZ2UoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9hZEZyb21Mb2NhbFN0b3JhZ2UoKSB7XHJcbiAgICBjb25zdCBfdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKTtcclxuICAgIGNvbnN0IF91c2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKTtcclxuICAgIGlmIChfdG9rZW4gJiYgX3VzZXIpIHtcclxuICAgICAgdGhpcy50b2tlbiA9IF90b2tlbjtcclxuICAgICAgdGhpcy51c2VyID0gSlNPTi5wYXJzZShfdXNlcik7XHJcbiAgICAgIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7dGhpcy50b2tlbn1gO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzYXZlVG9Mb2NhbFN0b3JhZ2UodG9rZW46IHN0cmluZywgdXNlcjogVXNlcikge1xyXG4gICAgdGhpcy50b2tlbiA9IHRva2VuO1xyXG4gICAgdGhpcy51c2VyID0gdXNlcjtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlbicsIHRva2VuKTtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgSlNPTi5zdHJpbmdpZnkodXNlcikpO1xyXG4gICAgYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9IGBCZWFyZXIgJHt0b2tlbn1gO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjbGVhckxvY2FsU3RvcmFnZSgpIHtcclxuICAgIHRoaXMudG9rZW4gPSBudWxsO1xyXG4gICAgdGhpcy51c2VyID0gbnVsbDtcclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXInKTtcclxuICAgIGRlbGV0ZSBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddO1xyXG4gIH1cclxuXHJcbiAgaXNBdXRoZW50aWNhdGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICEhdGhpcy50b2tlbjtcclxuICB9XHJcblxyXG4gIGdldFVzZXIoKTogVXNlciB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlcjtcclxuICB9XHJcblxyXG4gIGlzQWRtaW4oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyPy5yb2xlID09PSAnYWRtaW4nO1xyXG4gIH1cclxuXHJcbiAgcmVxdWlyZXNQYXNzd29yZENoYW5nZSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnJlcXVpcmVzUGFzc3dvcmRDaGFuZ2VGbGFnO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgbG9naW4oZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8QXV0aFJlc3BvbnNlPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBfcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFxyXG4gICAgICAgIGAke19BUElfVVJMfS9sb2dpbmAsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICBwYXNzd29yZCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKF9yZXNwb25zZS5kYXRhLmFjY2Vzc190b2tlbikge1xyXG4gICAgICAgIGNvbnN0IF91c2VyOiBVc2VyID0geyBpZDogJzEnLCBlbWFpbCwgcm9sZTogJ2FkbWluJyB9O1xyXG4gICAgICAgIHRoaXMuc2F2ZVRvTG9jYWxTdG9yYWdlKF9yZXNwb25zZS5kYXRhLmFjY2Vzc190b2tlbiwgX3VzZXIpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVzZXI6IF91c2VyLCByZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlOiBmYWxzZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnSW52YWxpZCBjcmVkZW50aWFscycgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0xvZ2luIEFQSSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIHx8ICdMb2dpbiBmYWlsZWQgZHVlIHRvIEFQSSBlcnJvcicsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2dvdXQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0aGlzLmNsZWFyTG9jYWxTdG9yYWdlKCk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjaGFuZ2VQYXNzd29yZChkYXRhOiBQYXNzd29yZENoYW5nZVJlcXVlc3QpOiBQcm9taXNlPEF1dGhSZXNwb25zZT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coYENoYW5naW5nIHBhc3N3b3JkIGZvciB1c2VyICR7ZGF0YS51c2VySWR9YCk7XHJcbiAgICAgIHRoaXMucmVxdWlyZXNQYXNzd29yZENoYW5nZUZsYWcgPSBmYWxzZTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQ2hhbmdlIHBhc3N3b3JkIEFQSSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIHx8ICdQYXNzd29yZCBjaGFuZ2UgZmFpbGVkIGR1ZSB0byBBUEkgZXJyb3InLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IF9hdXRoU2VydmljZSA9IG5ldyBBdXRoU2VydmljZSgpO1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQSxJQUFBQSxNQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFEQTs7QUFHQSxNQUFNQyxRQUFRLEdBQUcsZ0NBQWdDO0FBc0JqRCxNQUFNQyxXQUFXLENBQUM7RUFLaEJDLFdBQVdBLENBQUEsRUFBRztJQUFBLEtBSk5DLElBQUksR0FBZ0IsSUFBSTtJQUFBLEtBQ3hCQyxLQUFLLEdBQWtCLElBQUk7SUFBQSxLQUMzQkMsMEJBQTBCLEdBQUcsS0FBSztJQUd4QyxJQUFJLENBQUNDLG9CQUFvQixDQUFDLENBQUM7RUFDN0I7RUFF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