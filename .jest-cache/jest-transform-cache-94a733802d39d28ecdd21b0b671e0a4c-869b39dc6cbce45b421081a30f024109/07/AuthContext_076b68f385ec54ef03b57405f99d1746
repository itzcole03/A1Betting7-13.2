284c70c6aaba331a7552d93f65d736c0
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useAuth = exports._AuthProvider = exports._AuthContext = void 0;
var _react = _interopRequireWildcard(require("react"));
var _authService = require("../services/authService");
var _logger = require("../utils/logger");
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
/**
 * Authentication context and provider for managing user authentication state and actions.
 *
 * Provides login, logout, registration, and password management for the app.
 *
 * @module contexts/AuthContext
 */

/**
 * AuthContextType
 * Provides authentication state and actions for the app.
 */

// Stub register method for test compatibility
const register = async (_email, _password) => {
  // In a real implementation, this would call an API endpoint
  return Promise.resolve();
};

/**
 * React context for authentication state and actions.
 */
const _AuthContext = exports._AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);

/**
 * AuthProvider component.
 * Wrap your app with this provider to enable authentication state and actions.
 * @param {object} props - React children.
 * @returns {JSX.Element} The provider component.
 */
/**
 * useAuthState
 * Custom hook to encapsulate authentication state logic for modularity and testability.
 */
function useAuthState() {
  const [user, setUser] = (0, _react.useState)(null);
  const [loading, setLoading] = (0, _react.useState)(false);
  const [error, setError] = (0, _react.useState)(null);
  const [isAdmin, setIsAdmin] = (0, _react.useState)(false);
  const [isAuthenticated, setIsAuthenticated] = (0, _react.useState)(false);
  const [requiresPasswordChange, setRequiresPasswordChange] = (0, _react.useState)(false);
  (0, _react.useEffect)(() => {
    // Skip auth restoration if bootstrap already handled it
    const globalState = window;
    if (typeof window !== 'undefined' && globalState.__A1_AUTH_RESTORED) {
      return;
    }
    const _initializeAuth = () => {
      if (_authService._authService.isAuthenticated()) {
        const _storedUser = _authService._authService.getUser();
        if (_storedUser) {
          setUser(_storedUser);
          setIsAdmin(_authService._authService.isAdmin());
          setIsAuthenticated(true);
          setRequiresPasswordChange(_authService._authService.requiresPasswordChange());

          // Mark as restored to prevent duplicate logs
          if (typeof window !== 'undefined') {
            globalState.__A1_AUTH_RESTORED = true;
          }

          // Structured logging for audit (only if not already restored by bootstrap)
          _logger.logger.info('🔐 Authentication restored', {
            email: _storedUser.email,
            role: _storedUser.role,
            userId: _storedUser.id
          }, 'Auth');
        }
      }
    };
    // In tests we want immediate auth restoration to avoid timing flakiness
    if (process.env.NODE_ENV === 'test') {
      _initializeAuth();
    } else {
      setTimeout(_initializeAuth, 100);
    }
  }, []);
  const login = async (email, password) => {
    setLoading(true);
    setError(null);
    try {
      const _response = await _authService._authService.login(email, password);
      if (_response.success && _response.user) {
        setUser(_response.user);
        setIsAdmin(_response.user.role === 'admin' || _response.user.permissions?.includes('admin') || false);
        setIsAuthenticated(true);
        setRequiresPasswordChange(_response.requiresPasswordChange || false);
      } else {
        throw new Error(_response.message || 'Login failed');
      }
    } catch (e) {
      setError(e.message || 'Login failed');
      throw e;
    } finally {
      setLoading(false);
    }
  };
  const logout = async () => {
    setLoading(true);
    setError(null);
    try {
      await _authService._authService.logout();
      setUser(null);
      setIsAdmin(false);
      setIsAuthenticated(false);
      setRequiresPasswordChange(false);
    } catch (e) {
      setError(e.message || 'Logout failed');
    } finally {
      setLoading(false);
    }
  };
  const changePassword = async data => {
    setLoading(true);
    setError(null);
    try {
      const _response = await _authService._authService.changePassword(data);
      if (_response.success) {
        const _updatedUser = _authService._authService.getUser();
        if (_updatedUser) {
          setUser(_updatedUser);
          setRequiresPasswordChange(false);
        }
      } else {
        throw new Error(_response.message || 'Password change failed');
      }
    } catch (e) {
      setError(e.message || 'Password change failed');
      throw e;
    } finally {
      setLoading(false);
    }
  };
  const clearError = () => {
    setError(null);
  };
  return {
    user,
    loading,
    error,
    isAdmin,
    isAuthenticated,
    requiresPasswordChange,
    login,
    logout,
    changePassword,
    clearError,
    register
  };
}

/**
 * AuthProvider component.
 * Wrap your app with this provider to enable authentication state and actions.
 * Uses useAuthState for modularity and testability.
 * @param {object} props - React children.
 * @returns {JSX.Element} The provider component.
 */
const AuthProvider = ({
  children
}) => {
  const contextValue = useAuthState();
  return /*#__PURE__*/(0, _jsxRuntime.jsx)(_AuthContext.Provider, {
    value: contextValue,
    children: children
  });
};
const _AuthProvider = exports._AuthProvider = AuthProvider;

/**
 * useAuth
 * Access the authentication context in any component.
 */
const useAuth = () => {
  const ctx = (0, _react.useContext)(_AuthContext);
  if (!ctx) throw new Error('useAuth must be used within AuthProvider');
  return ctx;
};
exports.useAuth = useAuth;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfYXV0aFNlcnZpY2UiLCJfbG9nZ2VyIiwiX2pzeFJ1bnRpbWUiLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJyZWdpc3RlciIsIl9lbWFpbCIsIl9wYXNzd29yZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiX0F1dGhDb250ZXh0IiwiZXhwb3J0cyIsImNyZWF0ZUNvbnRleHQiLCJ1bmRlZmluZWQiLCJ1c2VBdXRoU3RhdGUiLCJ1c2VyIiwic2V0VXNlciIsInVzZVN0YXRlIiwibG9hZGluZyIsInNldExvYWRpbmciLCJlcnJvciIsInNldEVycm9yIiwiaXNBZG1pbiIsInNldElzQWRtaW4iLCJpc0F1dGhlbnRpY2F0ZWQiLCJzZXRJc0F1dGhlbnRpY2F0ZWQiLCJyZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlIiwic2V0UmVxdWlyZXNQYXNzd29yZENoYW5nZSIsInVzZUVmZmVjdCIsImdsb2JhbFN0YXRlIiwid2luZG93IiwiX19BMV9BVVRIX1JFU1RPUkVEIiwiX2luaXRpYWxpemVBdXRoIiwiYXV0aFNlcnZpY2UiLCJfc3RvcmVkVXNlciIsImdldFVzZXIiLCJsb2dnZXIiLCJpbmZvIiwiZW1haWwiLCJyb2xlIiwidXNlcklkIiwiaWQiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJzZXRUaW1lb3V0IiwibG9naW4iLCJwYXNzd29yZCIsIl9yZXNwb25zZSIsInN1Y2Nlc3MiLCJwZXJtaXNzaW9ucyIsImluY2x1ZGVzIiwiRXJyb3IiLCJtZXNzYWdlIiwibG9nb3V0IiwiY2hhbmdlUGFzc3dvcmQiLCJkYXRhIiwiX3VwZGF0ZWRVc2VyIiwiY2xlYXJFcnJvciIsIkF1dGhQcm92aWRlciIsImNoaWxkcmVuIiwiY29udGV4dFZhbHVlIiwianN4IiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIl9BdXRoUHJvdmlkZXIiLCJ1c2VBdXRoIiwiY3R4IiwidXNlQ29udGV4dCJdLCJzb3VyY2VzIjpbIkF1dGhDb250ZXh0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQXV0aGVudGljYXRpb24gY29udGV4dCBhbmQgcHJvdmlkZXIgZm9yIG1hbmFnaW5nIHVzZXIgYXV0aGVudGljYXRpb24gc3RhdGUgYW5kIGFjdGlvbnMuXHJcbiAqXHJcbiAqIFByb3ZpZGVzIGxvZ2luLCBsb2dvdXQsIHJlZ2lzdHJhdGlvbiwgYW5kIHBhc3N3b3JkIG1hbmFnZW1lbnQgZm9yIHRoZSBhcHAuXHJcbiAqXHJcbiAqIEBtb2R1bGUgY29udGV4dHMvQXV0aENvbnRleHRcclxuICovXHJcbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVDb250ZXh0LCBSZWFjdE5vZGUsIHVzZUNvbnRleHQsIHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7XHJcbiAgQXV0aFJlc3BvbnNlLFxyXG4gIF9hdXRoU2VydmljZSBhcyBhdXRoU2VydmljZSxcclxuICBQYXNzd29yZENoYW5nZVJlcXVlc3QsXHJcbiAgVXNlcixcclxufSBmcm9tICcuLi9zZXJ2aWNlcy9hdXRoU2VydmljZSc7XHJcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XHJcblxyXG4vKipcclxuICogQXV0aENvbnRleHRUeXBlXHJcbiAqIFByb3ZpZGVzIGF1dGhlbnRpY2F0aW9uIHN0YXRlIGFuZCBhY3Rpb25zIGZvciB0aGUgYXBwLlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBBdXRoQ29udGV4dFR5cGUge1xyXG4gIHVzZXI6IFVzZXIgfCBudWxsO1xyXG4gIGxvYWRpbmc6IGJvb2xlYW47XHJcbiAgZXJyb3I6IHN0cmluZyB8IG51bGw7XHJcbiAgaXNBZG1pbjogYm9vbGVhbjtcclxuICBpc0F1dGhlbnRpY2F0ZWQ6IGJvb2xlYW47XHJcbiAgcmVxdWlyZXNQYXNzd29yZENoYW5nZTogYm9vbGVhbjtcclxuICBsb2dpbjogKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XHJcbiAgbG9nb3V0OiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG4gIGNoYW5nZVBhc3N3b3JkOiAoZGF0YTogUGFzc3dvcmRDaGFuZ2VSZXF1ZXN0KSA9PiBQcm9taXNlPHZvaWQ+O1xyXG4gIGNsZWFyRXJyb3I6ICgpID0+IHZvaWQ7XHJcbiAgcmVnaXN0ZXI6IChlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG59XHJcbi8vIFN0dWIgcmVnaXN0ZXIgbWV0aG9kIGZvciB0ZXN0IGNvbXBhdGliaWxpdHlcclxuY29uc3QgcmVnaXN0ZXIgPSBhc3luYyAoX2VtYWlsOiBzdHJpbmcsIF9wYXNzd29yZDogc3RyaW5nKSA9PiB7XHJcbiAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGNhbGwgYW4gQVBJIGVuZHBvaW50XHJcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJlYWN0IGNvbnRleHQgZm9yIGF1dGhlbnRpY2F0aW9uIHN0YXRlIGFuZCBhY3Rpb25zLlxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IF9BdXRoQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8QXV0aENvbnRleHRUeXBlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xyXG5cclxuLyoqXHJcbiAqIEF1dGhQcm92aWRlciBjb21wb25lbnQuXHJcbiAqIFdyYXAgeW91ciBhcHAgd2l0aCB0aGlzIHByb3ZpZGVyIHRvIGVuYWJsZSBhdXRoZW50aWNhdGlvbiBzdGF0ZSBhbmQgYWN0aW9ucy5cclxuICogQHBhcmFtIHtvYmplY3R9IHByb3BzIC0gUmVhY3QgY2hpbGRyZW4uXHJcbiAqIEByZXR1cm5zIHtKU1guRWxlbWVudH0gVGhlIHByb3ZpZGVyIGNvbXBvbmVudC5cclxuICovXHJcbi8qKlxyXG4gKiB1c2VBdXRoU3RhdGVcclxuICogQ3VzdG9tIGhvb2sgdG8gZW5jYXBzdWxhdGUgYXV0aGVudGljYXRpb24gc3RhdGUgbG9naWMgZm9yIG1vZHVsYXJpdHkgYW5kIHRlc3RhYmlsaXR5LlxyXG4gKi9cclxuZnVuY3Rpb24gdXNlQXV0aFN0YXRlKCk6IEF1dGhDb250ZXh0VHlwZSB7XHJcbiAgY29uc3QgW3VzZXIsIHNldFVzZXJdID0gdXNlU3RhdGU8VXNlciB8IG51bGw+KG51bGwpO1xyXG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xyXG4gIGNvbnN0IFtpc0FkbWluLCBzZXRJc0FkbWluXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbaXNBdXRoZW50aWNhdGVkLCBzZXRJc0F1dGhlbnRpY2F0ZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG4gIGNvbnN0IFtyZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlLCBzZXRSZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIC8vIFNraXAgYXV0aCByZXN0b3JhdGlvbiBpZiBib290c3RyYXAgYWxyZWFkeSBoYW5kbGVkIGl0XHJcbiAgICBjb25zdCBnbG9iYWxTdGF0ZSA9IHdpbmRvdyBhcyB0eXBlb2Ygd2luZG93ICYgeyBfX0ExX0FVVEhfUkVTVE9SRUQ/OiBib29sZWFuIH07XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsU3RhdGUuX19BMV9BVVRIX1JFU1RPUkVEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBfaW5pdGlhbGl6ZUF1dGggPSAoKSA9PiB7XHJcbiAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgICAgIGNvbnN0IF9zdG9yZWRVc2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xyXG4gICAgICAgIGlmIChfc3RvcmVkVXNlcikge1xyXG4gICAgICAgICAgc2V0VXNlcihfc3RvcmVkVXNlcik7XHJcbiAgICAgICAgICBzZXRJc0FkbWluKGF1dGhTZXJ2aWNlLmlzQWRtaW4oKSk7XHJcbiAgICAgICAgICBzZXRJc0F1dGhlbnRpY2F0ZWQodHJ1ZSk7XHJcbiAgICAgICAgICBzZXRSZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlKGF1dGhTZXJ2aWNlLnJlcXVpcmVzUGFzc3dvcmRDaGFuZ2UoKSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIE1hcmsgYXMgcmVzdG9yZWQgdG8gcHJldmVudCBkdXBsaWNhdGUgbG9nc1xyXG4gICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGdsb2JhbFN0YXRlLl9fQTFfQVVUSF9SRVNUT1JFRCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIFN0cnVjdHVyZWQgbG9nZ2luZyBmb3IgYXVkaXQgKG9ubHkgaWYgbm90IGFscmVhZHkgcmVzdG9yZWQgYnkgYm9vdHN0cmFwKVxyXG4gICAgICAgICAgbG9nZ2VyLmluZm8oXHJcbiAgICAgICAgICAgICfwn5SQIEF1dGhlbnRpY2F0aW9uIHJlc3RvcmVkJyxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIGVtYWlsOiBfc3RvcmVkVXNlci5lbWFpbCxcclxuICAgICAgICAgICAgICByb2xlOiBfc3RvcmVkVXNlci5yb2xlLFxyXG4gICAgICAgICAgICAgIHVzZXJJZDogX3N0b3JlZFVzZXIuaWQsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdBdXRoJ1xyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBJbiB0ZXN0cyB3ZSB3YW50IGltbWVkaWF0ZSBhdXRoIHJlc3RvcmF0aW9uIHRvIGF2b2lkIHRpbWluZyBmbGFraW5lc3NcclxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnKSB7XHJcbiAgICAgIF9pbml0aWFsaXplQXV0aCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0VGltZW91dChfaW5pdGlhbGl6ZUF1dGgsIDEwMCk7XHJcbiAgICB9XHJcbiAgfSwgW10pO1xyXG5cclxuICBjb25zdCBsb2dpbiA9IGFzeW5jIChlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKSA9PiB7XHJcbiAgICBzZXRMb2FkaW5nKHRydWUpO1xyXG4gICAgc2V0RXJyb3IobnVsbCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBfcmVzcG9uc2U6IEF1dGhSZXNwb25zZSA9IGF3YWl0IGF1dGhTZXJ2aWNlLmxvZ2luKGVtYWlsLCBwYXNzd29yZCk7XHJcbiAgICAgIGlmIChfcmVzcG9uc2Uuc3VjY2VzcyAmJiBfcmVzcG9uc2UudXNlcikge1xyXG4gICAgICAgIHNldFVzZXIoX3Jlc3BvbnNlLnVzZXIpO1xyXG4gICAgICAgIHNldElzQWRtaW4oXHJcbiAgICAgICAgICBfcmVzcG9uc2UudXNlci5yb2xlID09PSAnYWRtaW4nIHx8IF9yZXNwb25zZS51c2VyLnBlcm1pc3Npb25zPy5pbmNsdWRlcygnYWRtaW4nKSB8fCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgc2V0SXNBdXRoZW50aWNhdGVkKHRydWUpO1xyXG4gICAgICAgIHNldFJlcXVpcmVzUGFzc3dvcmRDaGFuZ2UoX3Jlc3BvbnNlLnJlcXVpcmVzUGFzc3dvcmRDaGFuZ2UgfHwgZmFsc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihfcmVzcG9uc2UubWVzc2FnZSB8fCAnTG9naW4gZmFpbGVkJyk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGU6IHVua25vd24pIHtcclxuICAgICAgc2V0RXJyb3IoKGUgYXMgRXJyb3IpLm1lc3NhZ2UgfHwgJ0xvZ2luIGZhaWxlZCcpO1xyXG4gICAgICB0aHJvdyBlO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbG9nb3V0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgIHNldEVycm9yKG51bGwpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgYXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICAgIHNldFVzZXIobnVsbCk7XHJcbiAgICAgIHNldElzQWRtaW4oZmFsc2UpO1xyXG4gICAgICBzZXRJc0F1dGhlbnRpY2F0ZWQoZmFsc2UpO1xyXG4gICAgICBzZXRSZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlKGZhbHNlKTtcclxuICAgIH0gY2F0Y2ggKGU6IHVua25vd24pIHtcclxuICAgICAgc2V0RXJyb3IoKGUgYXMgRXJyb3IpLm1lc3NhZ2UgfHwgJ0xvZ291dCBmYWlsZWQnKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNoYW5nZVBhc3N3b3JkID0gYXN5bmMgKGRhdGE6IFBhc3N3b3JkQ2hhbmdlUmVxdWVzdCkgPT4ge1xyXG4gICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgIHNldEVycm9yKG51bGwpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX3Jlc3BvbnNlOiBBdXRoUmVzcG9uc2UgPSBhd2FpdCBhdXRoU2VydmljZS5jaGFuZ2VQYXNzd29yZChkYXRhKTtcclxuICAgICAgaWYgKF9yZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgY29uc3QgX3VwZGF0ZWRVc2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xyXG4gICAgICAgIGlmIChfdXBkYXRlZFVzZXIpIHtcclxuICAgICAgICAgIHNldFVzZXIoX3VwZGF0ZWRVc2VyKTtcclxuICAgICAgICAgIHNldFJlcXVpcmVzUGFzc3dvcmRDaGFuZ2UoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX3Jlc3BvbnNlLm1lc3NhZ2UgfHwgJ1Bhc3N3b3JkIGNoYW5nZSBmYWlsZWQnKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZTogdW5rbm93bikge1xyXG4gICAgICBzZXRFcnJvcigoZSBhcyBFcnJvcikubWVzc2FnZSB8fCAnUGFzc3dvcmQgY2hhbmdlIGZhaWxlZCcpO1xyXG4gICAgICB0aHJvdyBlO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY2xlYXJFcnJvciA9ICgpID0+IHtcclxuICAgIHNldEVycm9yKG51bGwpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICB1c2VyLFxyXG4gICAgbG9hZGluZyxcclxuICAgIGVycm9yLFxyXG4gICAgaXNBZG1pbixcclxuICAgIGlzQXV0aGVudGljYXRlZCxcclxuICAgIHJlcXVpcmVzUGFzc3dvcmRDaGFuZ2UsXHJcbiAgICBsb2dpbixcclxuICAgIGxvZ291dCxcclxuICAgIGNoYW5nZVBhc3N3b3JkLFxyXG4gICAgY2xlYXJFcnJvcixcclxuICAgIHJlZ2lzdGVyLFxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBdXRoUHJvdmlkZXIgY29tcG9uZW50LlxyXG4gKiBXcmFwIHlvdXIgYXBwIHdpdGggdGhpcyBwcm92aWRlciB0byBlbmFibGUgYXV0aGVudGljYXRpb24gc3RhdGUgYW5kIGFjdGlvbnMuXHJcbiAqIFVzZXMgdXNlQXV0aFN0YXRlIGZvciBtb2R1bGFyaXR5IGFuZCB0ZXN0YWJpbGl0eS5cclxuICogQHBhcmFtIHtvYmplY3R9IHByb3BzIC0gUmVhY3QgY2hpbGRyZW4uXHJcbiAqIEByZXR1cm5zIHtKU1guRWxlbWVudH0gVGhlIHByb3ZpZGVyIGNvbXBvbmVudC5cclxuICovXHJcbmNvbnN0IEF1dGhQcm92aWRlcjogUmVhY3QuRkM8eyBjaGlsZHJlbjogUmVhY3ROb2RlIH0+ID0gKHsgY2hpbGRyZW4gfSkgPT4ge1xyXG4gIGNvbnN0IGNvbnRleHRWYWx1ZSA9IHVzZUF1dGhTdGF0ZSgpO1xyXG4gIHJldHVybiA8X0F1dGhDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXtjb250ZXh0VmFsdWV9PntjaGlsZHJlbn08L19BdXRoQ29udGV4dC5Qcm92aWRlcj47XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgX0F1dGhQcm92aWRlciA9IEF1dGhQcm92aWRlcjtcclxuXHJcbi8qKlxyXG4gKiB1c2VBdXRoXHJcbiAqIEFjY2VzcyB0aGUgYXV0aGVudGljYXRpb24gY29udGV4dCBpbiBhbnkgY29tcG9uZW50LlxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHVzZUF1dGggPSAoKSA9PiB7XHJcbiAgY29uc3QgY3R4ID0gdXNlQ29udGV4dChfQXV0aENvbnRleHQpO1xyXG4gIGlmICghY3R4KSB0aHJvdyBuZXcgRXJyb3IoJ3VzZUF1dGggbXVzdCBiZSB1c2VkIHdpdGhpbiBBdXRoUHJvdmlkZXInKTtcclxuICByZXR1cm4gY3R4O1xyXG59O1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQU9BLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFlBQUEsR0FBQUQsT0FBQTtBQU1BLElBQUFFLE9BQUEsR0FBQUYsT0FBQTtBQUF5QyxJQUFBRyxXQUFBLEdBQUFILE9BQUE7QUFBQSxTQUFBRCx3QkFBQUssQ0FBQSxFQUFBQyxDQUFBLDZCQUFBQyxPQUFBLE1BQUFDLENBQUEsT0FB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